var ngMap={services:{},directives:{}};ngMap.services.Attr2Options=function($parse){function camelCase(e){return e.replace(SPECIAL_CHARS_REGEXP,function(e,t,r,n){return n?r.toUpperCase():r}).replace(MOZ_HACK_REGEXP,"Moz$1")}var SPECIAL_CHARS_REGEXP=/([\:\-\_]+(.))/g,MOZ_HACK_REGEXP=/^moz([A-Z])/,toOptionValue=function(input,options){var output,key=options.key,scope=options.scope;try{var num=Number(input);if(isNaN(num))throw"Not a number";output=num}catch(err){try{if(output=JSON.parse(input),output instanceof Array){if(!(output[0]instanceof Array))return new google.maps.LatLng(output[0],output[1]);output=output.map(function(e){return new google.maps.LatLng(e[0],e[1])})}}catch(err2){if(input.match(/^[A-Z][a-zA-Z0-9]+\(.*\)$/))try{var exp="new google.maps."+input;output=eval(exp)}catch(e){output=input}else if(input.match(/^[A-Z][a-zA-Z0-9]+\.[A-Z]+$/))try{output=scope.$eval("google.maps."+input)}catch(e){output=input}else if(input.match(/^[A-Z]+$/))try{var capitializedKey=key.charAt(0).toUpperCase()+key.slice(1);output=scope.$eval("google.maps."+capitializedKey+"."+input)}catch(e){output=input}else output=input}}return output};return{filter:function(e){var t={};for(var r in e)r.match(/^\$/)||(t[r]=e[r]);return t},getOptions:function(e,t){var r={};for(var n in e)if(e[n]){if(n.match(/^on[A-Z]/))continue;if(n.match(/ControlOptions$/))continue;r[n]=toOptionValue(e[n],{scope:t,key:n})}return r},getEvents:function(e,t){var r={},n=function(e){return"_"+e.toLowerCase()},a=function(t){var r=t.match(/([^\(]+)\(([^\)]*)\)/),n=r[1],a=r[2].replace(/event[ ,]*/,""),o=e.$eval("["+a+"]");return function(t){e[n].apply(this,[t].concat(o))}};for(var o in t)if(t[o]){if(!o.match(/^on[A-Z]/))continue;var i=o.replace(/^on/,"");i=i.charAt(0).toLowerCase()+i.slice(1),i=i.replace(/([A-Z])/g,n);var s=t[o];r[i]=new a(s)}return r},getControlOptions:function(e){var t={};if("object"!=typeof e)return!1;for(var r in e)if(e[r]){if(!r.match(/(.*)ControlOptions$/))continue;var n=e[r],a=n.replace(/'/g,'"');a=a.replace(/([^"]+)|("[^"]+")/g,function(e,t,r){return t?t.replace(/([a-zA-Z0-9]+?):/g,'"$1":'):r});try{var o=JSON.parse(a);for(var i in o)if(o[i]){var s=o[i];if("string"==typeof s?s=s.toUpperCase():"mapTypeIds"===i&&(s=s.map(function(e){return google.maps.MapTypeId[e.toUpperCase()]})),"style"===i){var p=r.charAt(0).toUpperCase()+r.slice(1),c=p.replace(/Options$/,"")+"Style";o[i]=google.maps[c][s]}else o[i]="position"===i?google.maps.ControlPosition[s]:s}t[r]=o}catch(u){}}return t},getAttrsToObserve:function(e){for(var t=e[0].attributes,r=[],n=0;n<t.length;n++){var a=t[n];a.value&&a.value.match(/\{\{.*\}\}/)&&r.push(camelCase(a.name))}return r},toOptionValue:toOptionValue,camelCase:camelCase}},ngMap.services.GeoCoder=function(e){return{geocode:function(t){var r=e.defer(),n=new google.maps.Geocoder;return n.geocode(t,function(e,t){t==google.maps.GeocoderStatus.OK?r.resolve(e):r.reject("Geocoder failed due to: "+t)}),r.promise}}},ngMap.services.GeoCoder.$inject=["$q"],ngMap.services.NavigatorGeolocation=function(e){return{getCurrentPosition:function(){var t=e.defer();return navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){t.resolve(e)},function(e){t.reject(e)}):t.reject("Browser Geolocation service failed."),t.promise},watchPosition:function(){return"TODO"},clearWatch:function(){return"TODO"}}},ngMap.services.NavigatorGeolocation.$inject=["$q"],ngMap.services.StreetView=function(e){return{getPanorama:function(t,r){r=r||t.getCenter();var n=e.defer(),a=new google.maps.StreetViewService;return a.getPanoramaByLocation(r||t.getCenter,100,function(e,t){n.resolve(t===google.maps.StreetViewStatus.OK?e.location.pano:!1)}),n.promise},setPanorama:function(e,t){var r=new google.maps.StreetViewPanorama(e.getDiv(),{enableCloseButton:!0});r.setPano(t)}}},ngMap.services.StreetView.$inject=["$q"],ngMap.directives.map=function(e){var t=e;return{restrict:"AE",controller:ngMap.directives.MapController,link:function(e,r,n,a){e.google=google;var o=document.createElement("div");o.style.width="100%",o.style.height="100%",r.prepend(o);var i=t.filter(n),s=t.getOptions(i,e),p=t.getControlOptions(i),c=t.getEvents(e,i),u=angular.extend(s,p);u.zoom=u.zoom||15,a.initMap(o,u,c),a.initMarkers(),a.initShapes(),a.initMarkerClusterer();for(var l=t.getAttrsToObserve(r),g=0;g<l.length;g++){var v=l[g];n.$observe(v,function(e){var r=t.camelCase("set-"+v),n=t.toOptionValue(e,{key:v});a.map[r]&&a.map[r](n)})}e.maps=e.maps||{},e.maps[s.id||Object.keys(e.maps).length]=a.map,e.$emit("mapsInitialized",e.maps)}}},ngMap.directives.map.$inject=["Attr2Options"],ngMap.directives.MapController=function(e,t,r){this.map=null,this.controls={},this.markers=[],this.shapes=[],this.markerClusterer=null,this.initMap=function(e,n,a){this.map=new google.maps.Map(e,{});var o=n.center;o instanceof google.maps.LatLng||delete n.center;var i=this;"string"==typeof o?r.geocode({address:o}).then(function(e){i.map.setCenter(e[0].geometry.location)}):o||t.getCurrentPosition().then(function(e){var t=e.coords.latitude,r=e.coords.longitude;i.map.setCenter(new google.maps.LatLng(t,r))},function(){if(n.geoFallbackCenter instanceof Array){var e=n.geoFallbackCenter[0],t=n.geoFallbackCenter[1];i.map.setCenter(new google.maps.LatLng(e,t))}else this.map.setCenter(new google.maps.LatLng(0,0))}),this.map.setOptions(n);for(var s in a)s&&google.maps.event.addListener(this.map,s,a[s])},this.addMarker=function(e){e.setMap(this.map),e.centered&&this.map.setCenter(e.position);var t=Object.keys(this.map.markers).length;this.map.markers[e.id||t]=e},this.initMarkers=function(){this.map.markers={};for(var e=0;e<this.markers.length;e++){var t=this.markers[e];this.addMarker(t)}},this.addShape=function(e){e.setMap(this.map);var t=Object.keys(this.map.shapes).length;this.map.shapes[e.id||t]=e},this.initShapes=function(){this.map.shapes={};for(var e=0;e<this.shapes.length;e++){var t=this.shapes[e];this.addShape(t)}},this.initMarkerClusterer=function(){this.markerClusterer&&(this.map.markerClusterer=new MarkerClusterer(this.map,this.markerClusterer.data,this.markerClusterer.options))}},ngMap.directives.MapController.$inject=["$scope","NavigatorGeolocation","GeoCoder"],ngMap.directives.marker=function(e,t,r){var n=e;return{restrict:"AE",require:"^map",link:function(e,a,o,i){var s=n.filter(o);e.google=google;var p=n.getOptions(s,e),c=n.getEvents(e,s),u=function(e,t){var r=new google.maps.Marker(e);Object.keys(t).length>0;for(var i in t)i&&google.maps.event.addListener(r,i,t[i]);for(var s=n.getAttrsToObserve(a),p=0;p<s.length;p++){var c=s[p];o.$observe(c,function(e){var t=n.camelCase("set-"+c),a=n.toOptionValue(e,{key:c});r[t]&&r[t](a)})}return r};if(p.position instanceof google.maps.LatLng){var l=u(p,c);p.ngRepeat?i.addMarker(l):i.markers.push(l)}else if("string"==typeof p.position){var g=p.position;g.match(/^current/i)?r.getCurrentPosition().then(function(e){var t=e.coords.latitude,r=e.coords.longitude;p.position=new google.maps.LatLng(t,r);var n=u(p,c);i.addMarker(n)}):t.geocode({address:p.position}).then(function(e){var t=e[0].geometry.location;p.position=t;var r=u(p,c);i.addMarker(r)})}}}},ngMap.directives.marker.$inject=["Attr2Options","GeoCoder","NavigatorGeolocation"],ngMap.directives.markerClusterer=function(e){var t=e;return{restrict:"AE",require:"^map",link:function(e,r,n,a){var o=e.$eval(n.markers);delete n.markers;for(var i=t.filter(n),s=[],p=0;p<o.length;p++){var c=o[p],u=c.position[0],l=c.position[1];c.position=new google.maps.LatLng(u,l);var g=new google.maps.Marker(c),v=t.getEvents(e,c);for(var m in v)m&&google.maps.event.addListener(g,m,v[m]);s.push(g)}a.markers=s,a.markerClusterer={data:s,options:i}}}},ngMap.directives.markerClusterer.$inject=["Attr2Options"],ngMap.directives.shape=function(e){var t=e,r=function(e){return new google.maps.LatLngBounds(e[0],e[1])},n=function(e,t){switch(e){case"circle":return new google.maps.Circle(t);case"polygon":return new google.maps.Polygon(t);case"polyline":return new google.maps.Polyline(t);case"rectangle":return t.bounds=r(t.bounds),new google.maps.Rectangle(t);case"groundOverlay":case"image":var n=t.url,a=r(t.bounds),o={opacity:t.opacity,clickable:t.clickable,id:t.id};return new google.maps.GroundOverlay(n,a,o)}return null};return{restrict:"AE",require:"^map",link:function(e,r,a,o){var i=t.filter(a),s=i.name;delete i.name;var p=t.getOptions(i),c=n(s,p);p.ngRepeat?o.addShape(c):c&&o.shapes.push(c);var u=t.getEvents(e,i);for(var l in u)u[l]&&google.maps.event.addListener(c,l,u[l])}}},ngMap.directives.shape.$inject=["Attr2Options"];var ngMapModule=angular.module("ngMap",[]);for(var key in ngMap.services)ngMapModule.service(key,ngMap.services[key]);for(var key in ngMap.directives)"MapController"!=key&&ngMapModule.directive(key,ngMap.directives[key]);