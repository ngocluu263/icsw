<script type="text/ng-template" id="icsw/main/user/account.html">
    <div ng-controller="icswUserAccountCtrl" ng-model="cur_user">
        <div ng-controller="icswUserPasswordCtrl">
            <account-detail user="edit_obj"></account-detail>
        </div>
        <hr/>
        <h2>Permissions</h2>
        <permissions object="edit_obj" type="user"></permissions>
        <h2>Quota info</h2>
        <quotasettings object='edit_obj' type='user'></quotasettings>
    </div>
</script>

<script type="text/ng-template" id="icsw/main/user/tree.html">
    <div ng-controller="user_tree">
        <h2>
            User / Group tree ({{ group_list.length }} groups, {{ user_list.length }} users)
        </h2>
        <div class="col-sm-4">
            <div class="row">
                <input type="text" class="form-control" ng-model="filterstr" placeholder="filter ..." ng-change="update_filter()"></input>
            </div>
            <div class="row">
                <icsw-tools-button type="create" value="create group" ng-click="create_group()" ng-disabled="!user_list"></icsw-tools-button>&nbsp;
                <icsw-tools-button type="create" value="create user" ng-click="create_user()" ng-disabled="!user_list"></icsw-tools-button>&nbsp;
                <icsw-tools-button type="submit" value="sync users" ng-click="sync_users()" ng-disabled="!user_list"></icsw-tools-button>
            </div>
            <div class="row">
                <tree treeconfig="tree"></tree>
            </div>
        </div>
        <div class="col-sm-8">
            <div icsw-user-group-show ng-if="_edit_mode == 'g' && modal_active" class="well well-sm">
            </div>
            <div ng-controller="icswUserPasswordCtrl">
                <div icsw-user-user-show ng-if="_edit_mode == 'u' && modal_active" class="well well-sm">
                </div>
            </div>
        </div>
    </div>
</script>

<script type="text/ng-template" id="icsw.user.vdu.overview">
    <!-- vnc viewer mode -->
    <div ng-if="show_single_vdus && ips_loaded">
        <vnc host="{{ ips_for_devices[single_vdus.device] }}" port="{{ single_vdus.websockify_effective_port  }}" is-connected="show_single_vdus" password="{{ single_vdus.password }}" ></vnc>
    </div>
    <!-- dashboard mode -->
    <div ng-if="virtual_desktop_sessions.length == 0">
        No virtual desktop sessions
    </div>
    <div ng-if="(!show_single_vdus) && ips_loaded">
        <div class="panel panel-success" ng-repeat="vdus in virtual_desktop_sessions">
            <div class="panel-heading">
                <h4 class="ng-binding panel-title">
                    {{ get_virtual_desktop_protocol(vdus.virtual_desktop_protocol).description }} session on {{ get_device_by_index(vdus.device).name }} ({{ips_for_devices[vdus.device]}}:{{vdus.effective_port }}) running {{ get_window_manager(vdus.window_manager).description }}
                </h4>
            </div>
            <div class="panel-body">

                <table class="table">
                    <tr>
                        <td>Status</td>
                        <td ng-class="(vdus.state == 1) && 'text-danger'">{{ vdus.state_description }}</td>
                    </tr>
                    <tr>
                        <td>Server</td>
                        <td>{{ips_for_devices[vdus.device]}}:{{ vdus.effective_port }}</td>
                    </tr>
                    <tr>
                        <td>Password</td>
                        <td>{{ vdus.password }}</td>
                    </tr>
                    <tr>
                        <td>Command line</td>
                        <td>{{ vdus.viewer_cmd_line }}</td>
                    </tr>

                    <tr ng-if="vdus.state != 1">
                        <td colspan="2">
                            <button type="button" ng-click="open_vdus_in_new_tab(vdus)" class="btn btn-default">Open in new tab</button>
                            <button type="button" ng-click="download_vdus_start_script(vdus)" class="btn btn-default">Download .vnc configuration file</button>
                        </td>
                    </tr>
                </table>
                <table>
                    <!--
                        <tr>
                            <td>
                                <button type="button" ng-click="show_viewer_command_line(vdus)" class="btn btn-default" data-toggle="button">Show viewer command line</button>
                                <div class="well well-sm" ng-if="vdus.show_viewer_command_line">
                                    {{vdus.viewer_cmd_line}}
                                </div>
                            </td>
                        </tr>
                    -->
                    <tr ng-if="vdus.state != 1">
                        <td>
                        </td>
                        <td colspan="2">

                            <uib-accordion close-others="false">
                               <uib-accordion-group is-open="web_viewer">
                                   <uib-accordion-heading>
                                       Web viewer
                                       <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': web_viewer, 'glyphicon-chevron-right': !web_viewer}"></i>
                                   </uib-accordion-heading>
                                   <div ng-if="web_viewer">
                                       <!--
                                       ie10 warns about leaving the page if a vnc directive is in the dom, this way it is only the case if the user has explicitly opened it
                                       -->
                                       <vnc host="{{ ips_for_devices[vdus.device] }}" port="{{ vdus.websockify_effective_port  }}" is-connected="true" password="{{ vdus.password }}" display="{width:1024,height:768,fitTo:'width',}"></vnc>
                                   </div>
                               </uib-accordion-group>
                           </uib-accordion>
                        </td>
                    </tr>
                </table>

            </div>
       </div>
    </div>
</script>

<script type="text/ng-template" id="icsw.user.vdu.settings">
    <fieldset>
        <legend>Virtual Desktops</legend>
        <div ng-show="!virtual_desktop_device_available()">
            <p>No device supporting a virtual desktop protocol and a window manager found</p>
        </div>
        <div class="form-group" ng_show="virtual_desktop_device_available()">
            <label class="control-label col-sm-2">
               Device
            </label>
            <div class="controls col-sm-8">
                <div class='input-group' style='max-width:400px; min-width:240px;'>
                    <ui-select ng-model='_edit_obj.device' ng-change="on_device_change()">
                        <ui-select-match class="ui-select-match" placeholder='Select a device'>{{ $select.selected.name }}</ui-select-match>
                        <ui-select-choices class="ui-select-choices" repeat='value.idx as value in virtual_desktop_devices()' group-by='&#39;model_name&#39;'>
                            <div ng-bind-html='value.name | highlight: $select.search'></div>
                        </ui-select-choices>
                    </ui-select>
                    <span class='input-group-btn'>
                        <button type="button" ng-click="_edit_obj.device = undefined" class="btn btn-default">
                            <span class="glyphicon glyphicon-trash"/>
                        </button>
                    </span>
                </div>
            </div>
        </div>
        <div class="form-group " ng_show="_edit_obj.device" >
            <label class="control-label col-sm-2">
                Virtual desktop protocol
            </label>
            <div class="controls col-sm-8">
                <ui-select ng-model='_edit_obj.virtual_desktop_protocol' style='max-width:400px; min-width:240px;'>
                    <ui-select-match class="ui-select-match" placeholder='Select an virtual desktop protocol'>{{ $select.selected.description }}</ui-select-match>
                    <ui-select-choices class="ui-select-choices" repeat='value.idx as value in get_available_virtual_desktop_protocols(_edit_obj.device)' group-by='model_name'>
                        <div ng-bind-html='value.description | highlight: $select.search'></div>
                    </ui-select-choices>
                </ui-select>
            </div>
        </div>
        <div class="form-group" ng_show="_edit_obj.device" >
            <label class="control-label col-sm-2">
                Port
             </label>
            <div class="controls col-sm-8">
                <input class="numberinput form-control" max="65535" min="0" name="port" ng-model="_edit_obj.port" placeholder="0" type="number"/>
            </div>
        </div>
        <div class="form-group " ng_show="_edit_obj.device" >
            <label class="control-label col-sm-2">
                Web VNC Port
            </label>
            <div class="controls col-sm-8">
                <input class="numberinput form-control" max="65535" min="0" name="port" ng-model="_edit_obj.websockify_port" placeholder="0" type="number" />
            </div>
        </div>
        <div class="form-group " ng_show="_edit_obj.device">
            <label class="control-label col-sm-2">
                Window manager
            </label>
            <div class="controls col-sm-8">
                <ui-select ng-model='_edit_obj.window_manager' style='max-width:400px; min-width:240px;'>
                    <ui-select-match class="ui-select-match" placeholder='Select a wm'>{{ $select.selected.description }}</ui-select-match>
                    <ui-select-choices class="ui-select-choices" repeat='value.idx as value in get_available_window_managers(_edit_obj.device)' group-by='model_name'>
                        <div ng-bind-html='value.description | highlight: $select.search'></div>
                    </ui-select-choices>
                </ui-select>
            </div>
        </div>
        <div class="form-group " ng_show="_edit_obj.device" >
            <label class="control-label col-sm-2">
                Screen size
            </label>
            <div class="controls col-sm-8">
                <ui-select ng-model='_edit_obj.screen_size' style='max-width:400px; min-width:240px;'>
                    <ui-select-match class="ui-select-match" placeholder='...'>{{ $select.selected.name }}</ui-select-match>
                    <ui-select-choices class="ui-select-choices" repeat='value as value in available_screen_sizes'>
                        <div ng-bind-html='value.name | highlight: $select.search'></div>
                    </ui-select-choices>
                </ui-select>
            </div>
        </div>
        <div>
            <div class="controls form-inline" ng_show="_edit_obj.device && _edit_obj.screen_size.manual">
                <input class="numberinput form-control" type="number" min="200", max="6000" ng-model="_edit_obj.manual_screen_size_x"/> x
                <input class="numberinput form-control" type="number" min="200", max="6000" ng-model="_edit_obj.manual_screen_size_y"/>
            </div>
        </div>
        <div  ng-show="_edit_obj.device">
            <!--<div  class="control-label col-sm-2" > &nbsp; </div>-->
            <div class="form-group row">
                <div class="control-label col-sm-6">
                    Enabled (Check to make sure the server is always running)
                </div>
                <div class="controls col-sm-2">
                    <icsw-tools-yes-no flag="_edit_obj.start_automatically"></icsw-tools-yes-no>
                </div>
            </div>
        </div>
        <input type="button" name="" value="{{ get_virtual_desktop_submit_mode() }}" class="btn btn btn-sm btn-success" id="button-id-" ng-click="create_virtual_desktop_user_setting()" ng-show="_edit_obj.device" />
        <input type="button" name="" value="cancel" class="btn btn btn-sm btn-danger" id="button-id-" ng-click="cancel_virtual_desktop_user_setting()" ng-show="_edit_obj.device" />
    </fieldset>

    <table class="table table-condensed table-hover table-striped" style="width:100%;">
        <thead>
            <tr>
                <th>Device</th>
                <th>Protocol</th>
                <th>Port</th>
                <th>Web VNC Port</th>
                <th>Window<br/>manager</th>
                <th>Screen size</th>
                <th>Enabled</th>
                <th>State</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            <tr ng-repeat="vdus in get_virtual_desktop_user_setting_of_user(_edit_obj)">
                <td> {{ get_device_by_index(vdus.device).name }} </td>
                <td> {{ get_virtual_desktop_protocol_by_index(vdus.virtual_desktop_protocol).description }} </td>
                <td> {{ vdus.port }} </td>
                <td> {{ vdus.websockify_port }} </td>
                <td> {{ get_window_manager_by_index(vdus.window_manager).description }} </td>
                <td> {{ vdus.screen_size }} </td>
                <td> {{ vdus.is_running | yesno2 }} </td>
                <td> {{ vdus.state_description }} </td>
                <td>
                    <button type="button" popover-placement="top" popover-title="Viewer command line" popover="{{ vdus.viewer_cmd_line }}" class="btn btn-xs btn-info">info</button>
                    <button type="button" class="btn btn-xs btn-success" value="modify" ng-click="modify_virtual_desktop_user_setting(vdus)">modify</button>
                    <button type="button" class="btn btn-xs btn-danger" value="delete" ng-click="delete_virtual_desktop_user_setting(vdus)">delete</button>
                </td>
            </tr>
        </tbody>
    </table>
</script>

<script type="text/ng-template" id="icsw.user.job.info">
    <table class="table table-hover table-bordered table-condensed" style="width:100%;" ng-show="jobinfo_valid">
        <thead>
            <tr>
                <th></th>
                <th>Number of jobs</th>
                <th>Job ids</th>
            </tr>
        </thead>

        <tbody>
            <tr>
                <td> Jobs waiting </td>
                <td> {{ jobs_waiting.length }} </td>
                <td> {{ longListToString(jobs_waiting) }} </td>
            </tr>
            <tr>
                <td> Jobs running </td>
                <td> {{ jobs_running.length }} </td>
                <td> {{ longListToString(jobs_running) }} </td>
            </tr>
            <tr>
                <td>
                    Jobs finished in
                    <div class="btn-group">
                        <button type="button" class="btn btn-xs btn-primary dropdown-toggle" data-toggle="dropdown">
                            <span class="glyphicon glyphicon-dashboard"></span>
                            {{ last_jobinfo_timedelta.name }} <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu">
                            <li ng-repeat="ts in all_timedeltas" ng-click="set_jobinfo_timedelta(ts)">
                                <a>{{ ts.name }}</a>
                            </li>
                        </ul>
                     </div>
                </td>
                <td>{{ jobs_finished.length }}</td>
                <td>{{ longListToString(jobs_finished) }}</td>
            </tr>
        </tbody>
    </table>
    <h4 ng-show="!jobinfo_valid">waiting for jobinfo ...</h4>
</script>

<script type="text/ng-template" id="icsw.user.disk.usage">
    <h4>{{ scan_run_info() }}<span ng-show="current_scan_run">, </span><input ng-show="current_scan_run" type="button" class="btn btn-xs" ng-class="show_dots && 'btn-success'" value="show dot dirs" ng-click="toggle_dots()"></input></h4>
    <div ng-show="current_scan_run">
        <tree treeconfig="du_tree"></tree>
    </div>
</script>

<script type="text/ng-template" id="icsw.user.quota.settings">
    <table class="table table-hover table-bordered table-condensed table-striped" style="width:100%;" ng-show="quota_settings.length">
        <thead>
            <tr>
                <th>Device</th>
                <th>Path</th>
                <th>Size</th>
                <th>Flags</th>
                <th>Bytes Graph</th>
                <th>Bytes used</th>
                <th>Bytes limit</th>
                <th>INode Graph</th>
                <th>INodes used</th>
                <th>INodes limit</th>
            </tr>
        </thead>
        <tbody>
            <tr ng-repeat="qs in quota_settings" ng-class="get_line_class(qs)">
                <td>{{ qs.qcb.device.full_name }}</td>
                <td>{{ qs.qcb.mount_path }}</td>
                <td>{{ qs.qcb.size | get_size:1:1024 }}</td>
                <td class="center">{{ qs.quota_flags }}</td>
                <td style="width:300px;">
                    <div class="row">
                        <div class="col-xs-2">
                            <span class="label label-primary" ng_click="qs.show_abs = !qs.show_abs"><span ng-show="qs.show_abs">Total:</span><span ng-show="!qs.show_abs">Relative:</span></span>
                        </div>
                        <div class="col-xs-10">
                            <progress ng-show="qs.bytes_quota && qs.show_abs">
                                <bar ng-repeat="stack in qs.bytes_stacked_abs track by $index" value="stack.value" title="{{ stack.title }}" type="{{ stack.type }}">{{ stack.out }}</bar>
                            </progress>
                            <progress ng-show="qs.bytes_quota && !qs.show_abs">
                                <bar ng-repeat="stack in qs.bytes_stacked_rel track by $index" value="stack.value" title="{{ stack.title }}" type="{{ stack.type }}">{{ stack.out }}</bar>
                            </progress>
                        </div>
                    </div>
                </td>
                <td class="text-center">{{ qs.bytes_used | get_size:1:1024 }}</td>
                <td class="text-center">{{ get_bytes_limit(qs) }}</td>
                <td style="width:120px;">
                    <progress ng-show="qs.files_quota">
                        <bar ng-repeat="stack in qs.files_stacked track by $index" value="stack.value" title="{{ stack.title }}" type="{{ stack.type }}">{{ stack.out }}</bar>
                    </progress>
                </td>
                <td class="text-center">{{ qs.files_used | get_size:1:1000:'' }}</td>
                <td class="text-center">{{ get_files_limit(qs) }}</td>
            </tr>
        </tbody>
    </table>
    <h4 ng-show="!quota_settings.length">no quota info</h4>
</script>

<script type="text/ng-template" id="icsw.user.permissions">
    <table class="table table-condensed table-hover table-striped" style="width:100%;">
        <thead>
            <tr>
                <th>Type</th>
                <th>Name</th>
                <th>Code</th>
                <th>Level</th>
                <th>Object</th>
                <th>Application</th>
                <th>Model</th>
                <th ng-show="action">Action</th>
            </tr>
        </thead>
        <tbody>
            <tr ng-repeat="perm in get_permission_set()">
                <td>global</td>
                <td>{{ perm.csw_permission | array_lookup:csw_permission_list:'name' }}</td>
                <td>{{ perm.csw_permission | array_lookup:csw_permission_list:'codename' }}</td>
                <td>{{ get_perm_level(perm) }}</td>
                <td>&nbsp;</td>
                <td>{{ get_perm_app(perm) }}</td>
                <td>{{ get_perm_model(perm) }}</td>
                <td ng-show="action"><input type="button" class="btn btn-xs btn-danger" value="delete" ng-click="delete_permission(perm)"></input></td>
            </tr>
            <tr ng-repeat="perm in get_object_permission_set()">
                <td>local</td>
                <td>{{ perm.csw_object_permission.csw_permission | array_lookup:csw_permission_list:'name' }}</td>
                <td>{{ perm.csw_object_permission.csw_permission | array_lookup:csw_permission_list:'codename' }}</td>
                <td>{{ get_perm_level(perm) }}</td>
                <td>{{ get_perm_object(perm) }}</td>
                <td>{{ get_perm_app(perm.csw_object_permission) }}</td>
                <td>{{ get_perm_model(perm.csw_object_permission) }}</td>
                <td ng-show="action"><input type="button" class="btn btn-xs btn-danger" value="delete" ng-click="delete_object_permission(perm)"></input></td>
            </tr>
        </tbody>
    </table>
</script>

<script type="text/ng-template" id="user.detail.form">
    <form id="form" class="form-horizontal" ng-submit="user_edit.modify()" name="form">
        <h2>Details for user '{{ _edit_obj.login }}'</h2>

        <div class="row">
            <div class="col-md-6">
                <fieldset>
                    <legend>Base data</legend>
                    <div class="form-group">
                        <label class="control-label col-sm-2 requiredField">
                            Login<span class="asteriskField">*</span>
                        </label>
                        <div class="controls col-sm-8">
                            <input class="textinput textInput form-control" maxlength="255" name="login" ng-model="_edit_obj.login" required="True" type="text"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-2 requiredField">
                            Uid<span class="asteriskField">*</span>
                        </label>
                        <div class="controls col-sm-8">
                            <input class="numberinput form-control" name="uid" ng-model="_edit_obj.uid" required="True" type="number"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-2">
                            First name
                        </label>
                        <div class="controls col-sm-8">
                            <input class="textinput textInput form-control" maxlength="765" name="first_name" ng-model="_edit_obj.first_name" placeholder="first name" type="text"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-2">
                            Last name
                        </label>
                        <div class="controls col-sm-8">
                            <input class="textinput textInput form-control" maxlength="765" name="last_name" ng-model="_edit_obj.last_name" placeholder="last name" type="text"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-2">
                            Shell
                        </label>
                        <div class="controls col-sm-8">
                            <input class="textinput textInput form-control" maxlength="765" name="shell" ng-model="_edit_obj.shell" placeholder="shell to use" type="text" value="/bin/bash"/>
                        </div>
                    </div>
                </fieldset>
            </div>
            <div class="col-md-6">
                <fieldset>
                    <legend>Additional data</legend>
                    <div class="form-group">
                        <label class="control-label col-sm-2">
                            Title
                        </label>
                        <div class="controls col-sm-8">
                            <input class="textinput textInput form-control" maxlength="765" name="title" ng-model="_edit_obj.title" placeholder="title" type="text"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-2">
                            Email
                        </label>
                        <div class="controls col-sm-8">
                            <input class="textinput textInput form-control" maxlength="765" name="email" ng-model="_edit_obj.email" placeholder="email address" type="text"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-2">
                            Mobile phone number
                        </label>
                        <div class="controls col-sm-8">
                            <input class="textinput textInput form-control" maxlength="765" name="pager" ng-model="_edit_obj.pager" placeholder="mobile number" type="text"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-2">
                            Telefon number
                        </label>
                        <div class="controls col-sm-8">
                            <input class="textinput textInput form-control" maxlength="765" name="tel" ng-model="_edit_obj.tel" placeholder="telefon number" type="text"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-2">
                            Comment
                        </label>
                        <div class="controls col-sm-8">
                            <input class="textinput textInput form-control" maxlength="765" name="comment" ng-model="_edit_obj.comment" placeholder="comment" type="text"/>
                        </div>
                    </div>
                </fieldset>
            </div>
        </div>
        <fieldset>
            <legend>Flags</legend>
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group controls row">
                        <div class="col-sm-8 control-label">
                            Active
                        </div>
                        <div class="controls col-sm-4">
                            <icsw-tools-yes-no flag="_edit_obj.active"></icsw-tools-yes-no>
                        </div>
                    </div>
                    <div class="form-group controls row">
                        <div class="control-label col-sm-8">
                            Is superuser
                        </div>
                        <div class="controls col-sm-4">
                            <icsw-tools-yes-no flag="_edit_obj.is_superuser"></icsw-tools-yes-no>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group controls row">
                        <div class="control-label col-sm-8">
                            Database is authoritative for password
                        </div>
                        <div class="controls col-sm-4">
                            <icsw-tools-yes-no flag="_edit_obj.db_is_auth_for_password"></icsw-tools-yes-no>
                        </div>
                    </div>
                    <div class="form-group controls row">
                        <div class="col-sm-8 control-label">
                            Only for webfrontend (== no system user)
                        </div>
                        <div class="controls col-sm-4">
                            <icsw-tools-yes-no flag="_edit_obj.only_webfrontend"></icsw-tools-yes-no>
                        </div>
                    </div>
                </div>
            </div>
        </fieldset>
        <fieldset>
            <legend>Groups / export entry</legend>
            <div class="form-group">
                <label class="control-label col-sm-2 requiredField">
                    Group<span class="asteriskField">*</span>
                </label>
                <div class="controls col-sm-8">
                    <select class="select form-control" name="group" ng-model="_edit_obj.group" ng-options="value.idx as value.groupname for value in group_list" required="True"></select>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-2">
                    Secondary groups
                </label>
                <div class="controls col-sm-8">
                    <ui-select multiple="multiple" ng-model="_edit_obj.secondary_groups" style="max-width:400px; min-width:240px;">
                        <ui-select-match class="ui-select-match" placeholder="Select secondary groups">{{ $item.groupname }}</ui-select-match>
                        <ui-select-choices class="ui-select-choices" repeat="value.idx as value in group_list| props_filter:{groupname:$select.search}">
                            <div ng-bind-html="value.groupname | highlight: $select.search"></div>
                        </ui-select-choices>
                    </ui-select>
                </div>
            </div>
            <div class="form-group" ng_show="!_edit_obj.only_webfrontend">
                <label class="control-label col-sm-2">
                    Export
                </label>
                <div class="controls col-sm-8">
                    <select class="select form-control" id="id_export" name="export" ng-model="_edit_obj.export" ng-options="value.idx as value.home_info_string for value in get_export_list()">
                        <option value="" selected>None</option>
                    </select>
                </div>
            </div>
            <div class="form-group" ng-show="!_edit_obj.only_webfrontend">
                <label class="control-label col-sm-2">
                    Homedir status
                </label>
                <div class="col-sm-8">
                    <input type="button" ng-disabled="!_edit_obj.home_dir_created" ng-class="get_home_dir_created_class(_edit_obj)" ng-value="get_home_dir_created_value(_edit_obj)" ng-click="clear_home_dir_created(_edit_obj)"/>
                </div>
            </div>
            <div class="form-group" ng-show="!_edit_obj.only_webfrontend">
                <label class="control-label col-sm-2">
                    Home
                </label>
                <div class="controls col-sm-8">
                    <input class="textinput textInput form-control" maxlength="128" name="home" ng-model="_edit_obj.home" type="text"/>
                </div>
            </div>
        </fieldset>
        <fieldset>
            <legend>Aliases</legend>
            <div class="form-group">
                <label class="control-label col-sm-2">
                    Aliases
                </label>
                <div class="controls col-sm-8">
                    <textarea class="textarea form-control" cols="40" id="id_aliases" name="aliases" ng-model="_edit_obj.aliases" rows="3"></textarea>
                </div>
            </div>
        </fieldset>
        <fieldset ng-show="_edit_obj.user_quota_setting_set.length &amp;&amp; !_edit_obj.only_webfrontend">
            <legend>Quota settings</legend>
            <div class="form-group">
                <div class="col-sm-12">
                    <icsw-user-quota-settings object="_edit_obj" type="user"></icsw-user-quota-settings>
                </div>
            </div>
        </fieldset>
        <fieldset ng-show="!_edit_obj.only_webfrontend &amp;&amp; _edit_obj.export">
            <legend>/home scan settings</legend>
            <div class="form-group">
                <label class="control-label col-sm-2">Scan Home dir</label>
                <div class="controls col-sm-8">
                    <input type="button" ng-class='_edit_obj.scan_user_home &amp;&amp; "btn btn-sm btn-success" || "btn btn-sm"' ng-click="_edit_obj.scan_user_home = !_edit_obj.scan_user_home" ng-value='_edit_obj.scan_user_home &amp;&amp; "yes" || "no"'></input>
                </div>
            </div>
            <div class="form-group" ng_show="_edit_obj.scan_user_home">
                <label class="control-label col-sm-2 requiredField">
                    Scan depth<span class="asteriskField">*</span>
                </label>
                <div class="controls col-sm-8">
                    <input class="numberinput form-control" max="5" min="1" name="scan_depth" ng-model="_edit_obj.scan_depth" required="True" type="number" value="2"/>
                </div>
            </div>
        </fieldset>
        <fieldset>
            <legend>Permissions</legend>
            <div class="form-group">
                <label class="control-label col-sm-2">
                    Allowed device groups
                </label>
                <div class="controls col-sm-8">
                    <ui-select multiple="multiple" ng-model="_edit_obj.allowed_device_groups" style="max-width:400px; min-width:240px;">
                        <ui-select-match class="ui-select-match" placeholder="Select one or more device groups">{{$item.name}}</ui-select-match>
                        <ui-select-choices class="ui-select-choices" repeat="value.idx as value in valid_device_groups()| props_filter:{name:$select.search}">
                            <div ng-bind-html="value.name | highlight: $select.search"></div>
                        </ui-select-choices>
                    </ui-select>
                </div>
            </div>
            <div class="form-group" ng_show="!create_mode">
                <label class="control-label col-sm-2">
                    Permission
                </label>
                <div class="controls col-sm-8">
                    <div class="input-group" style="max-width:400px; min-width:240px;">
                        <ui-select ng-model="_edit_obj.permission">
                            <ui-select-match class="ui-select-match" placeholder="Select a permission">{{$select.selected.info}}
                            </ui-select-match>
                            <ui-select-choices class="ui-select-choices" repeat="value.idx as value in valid_user_csw_perms()| props_filter:{info:$select.search}" group-by="'model_name'">
                                <div ng-bind-html="value.info | highlight: $select.search"></div>
                            </ui-select-choices>
                        </ui-select>
                        <span class="input-group-btn">
                            <button type="button" ng-click="_edit_obj.permission = undefined" class="btn btn-default">
                                <span class="glyphicon glyphicon-trash"/>
                            </button>
                        </span>
                    </div>
                </div>
            </div>
            <div class="form-group" ng_show="!create_mode &amp;&amp; _edit_obj.permission">
                <label class="control-label col-sm-2">
                    Object
                </label>
                <div class="controls col-sm-8">
                    <div class="input-group" style="max-width:400px; min-width:240px;">
                        <ui-select ng-model="_edit_obj.object">
                            <ui-select-match class="ui-select-match" placeholder="Select an object">{{$select.selected.name}}</ui-select-match>
                            <ui-select-choices class="ui-select-choices" repeat="value.idx as value in object_list()| props_filter:{name:$select.search}" group-by="'group'">
                                <div ng-bind-html="value.name | highlight: $select.search"></div>
                            </ui-select-choices>
                        </ui-select>
                        <span class="input-group-btn">
                            <button type="button" ng-click="_edit_obj.object = undefined" class="btn btn-default">
                                <span class="glyphicon glyphicon-trash"/>
                            </button>
                        </span>
                    </div>
                </div>
            </div>
            <div class="form-group" ng_show="!create_mode">
                <label class="control-label col-sm-2">
                    Permission level
                </label>
                <div class="controls col-sm-8">
                    <ui-select ng-model="_edit_obj.permission_level" style="max-width:400px; min-width:240px;">
                        <ui-select-match class="ui-select-match" placeholder="Select a permission mode">{{ $select.selected.info }}</ui-select-match>
                        <ui-select-choices class="ui-select-choices" repeat="value.level as value in ac_levels">
                            <div ng-bind-html="value.info | highlight: $select.search"></div>
                        </ui-select-choices>
                    </ui-select>
                </div>
            </div>
            <input type="button" name="" value="create global permission" class="btn btn btn-sm btn-success" id="button-id-" ng-click="create_permission()" ng-show="!create_mode &amp;&amp; _edit_obj.permission"></input>
            &#160;<input type="button" name="" value="create object permission" class="btn btn btn-sm btn-primary" id="button-id-" ng-click="create_object_permission()" ng-show="!create_mode &amp;&amp; _edit_obj.permission &amp;&amp; _edit_obj.object"></input>
            <div class="col-sm-12">
                <div icsw-user-permissions="" ng_if="!create_mode" object="_edit_obj" type="user" action="true"></div>
            </div>
        </fieldset>
        <div class="form-group" ng-show="has_valid_license('virtual_desktop')">
            <div class="col-sm-12">
                <icsw-user-virtual-desktop-settings object="_edit_obj"></icsw-user-virtual-desktop-settings>
            </div>
        </div>
        <div class="form-actions">
            <input type="submit" name="modify" value="modify" class="btn btn-primary btn-success" id="submit-id-modify" ng-show="!create_mode"></input> <input type="submit" name="create" value="create" class="btn btn-primary btn-success" id="submit-id-create" ng-disabled="!_edit_obj.password" ng-show="create_mode"></input>
            &#160;<input type="button" name="close" value="close" class="btn btn-primary" id="button-id-close" ng-click="user_edit.close_modal()" ng-show="!create_mode"></input>
            &#160;<input type="button" name="delete" value="delete" class="btn btn-danger" id="button-id-delete" ng-click="user_edit.delete_obj(_edit_obj)" ng-show="!create_mode"></input>
            &#160;<input type="button" name="change-password" value="change password" class="btn btn-warning" id="button-id-change-password" ng-click="change_password()" ng-show="!create_mode"></input> <input type="button" name="set-password" value="set password" class="btn btn-warning" id="button-id-set-password" ng-click="change_password()" ng-show="create_mode &amp;&amp; !_edit_obj.password"></input> <input type="button" name="change-password" value="change password" class="btn btn-warning" id="button-id-change-password" ng-click="change_password()" ng-show="create_mode &amp;&amp; _edit_obj.password"></input>
        </div>
    </form>
</script>

<script type="text/ng-template" id="group.detail.form">
    <form id="form" class="form-horizontal" ng-submit="group_edit.modify(this)" name="form">
        <h2>Details for group '{{ _edit_obj.groupname }}'</h2>
        <div class="row">
            <div class="col-md-6">
                <fieldset>
                    <legend>Basic data</legend>
                    <div class="form-group ng-class:group_edit.form_error('groupname')">
                        <label class="control-label col-sm-2 requiredField">
                            Groupname<span class="asteriskField">*</span>
                        </label>
                        <div class="controls col-sm-8">
                            <input class="textinput textInput form-control" maxlength="48" name="groupname" ng-model="_edit_obj.groupname" ng-pattern="/^.+$/" required="True" type="text"/>
                        </div>
                    </div>
                    <div class="form-group ng-class:group_edit.form_error('gid')">
                        <label class="control-label col-sm-2 requiredField">
                            Gid<span class="asteriskField">*</span>
                        </label>
                        <div class="controls col-sm-8">
                            <input class="numberinput form-control" name="gid" ng-model="_edit_obj.gid" ng-pattern="/^\d+$/" required="True" type="number"/>
                        </div>
                    </div>
                    <div class="form-group ng-class:group_edit.form_error('homestart')">
                        <label class="control-label col-sm-2 requiredField">
                            Homestart<span class="asteriskField">*</span>
                        </label>
                        <div class="controls col-sm-8">
                            <input class="textinput textInput form-control" name="homestart" ng-model="_edit_obj.homestart" ng-pattern="/^\/.*/" required="True" type="text"/>
                        </div>
                    </div>
                    <div class="form-actions">
                        <div class="form-group">
                            <div class="checkbox">
                                <div class="controls col-lg-offset-0 col-sm-8">
                                    <label>
                                        <input checked="checked" class="checkboxinput checkbox" name="active" ng-model="_edit_obj.active" type="checkbox"/>
                                        Active
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </div>
            <div class="col-md-6">
                <fieldset>
                    <legend>Additional data</legend>
                    <div class="form-group">
                        <label class="control-label col-sm-2">
                            Email
                        </label>
                        <div class="controls col-sm-8">
                            <input class="textinput textInput form-control" maxlength="765" name="email" ng-model="_edit_obj.email" placeholder="email address" type="text"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-2">
                            Mobile
                        </label>
                        <div class="controls col-sm-8">
                            <input class="textinput textInput form-control" maxlength="765" name="pager" ng-model="_edit_obj.pager" placeholder="mobile number" type="text"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-2">
                            Tel
                        </label>
                        <div class="controls col-sm-8">
                            <input class="textinput textInput form-control" maxlength="765" name="tel" ng-model="_edit_obj.tel" placeholder="telefon number" type="text"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-2">
                            Comment
                        </label>
                        <div class="controls col-sm-8">
                            <input class="textinput textInput form-control" maxlength="765" name="comment" ng-model="_edit_obj.comment" placeholder="comment" type="text"/>
                        </div>
                    </div>
                </fieldset>
            </div>
        </div>
        <fieldset>
            <legend>Permissions</legend>
            <div class="form-group" ng_show="!create_mode">
                <label class="control-label col-sm-2">
                    Parent group
                </label>
                <div class="controls col-sm-8">
                    <div class="input-group" style="max-width:400px; min-width:240px;">
                        <ui-select ng-model="_edit_obj.parent_group">
                            <ui-select-match class="ui-select-match" placeholder="Select a parent group">{{ $select.selected.groupname }}</ui-select-match>
                            <ui-select-choices class="ui-select-choices" repeat="value.idx as value in parent_groups[_edit_obj.idx]| props_filter:{groupname:$select.search}">
                                <div ng-bind-html="value.groupname | highlight: $select.search"></div>
                            </ui-select-choices>
                        </ui-select>
                        <span class="input-group-btn">
                            <button type="button" ng-click="_edit_obj.parent_group = undefined" class="btn btn-default">
                                <span class="glyphicon glyphicon-trash"/>
                            </button>
                        </span>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-2">
                    Allowed device groups
                </label>
                <div class="controls col-sm-8">
                    <ui-select multiple="multiple" ng-model="_edit_obj.allowed_device_groups" style="max-width:400px; min-width:240px;">
                        <ui-select-match class="ui-select-match" placeholder="Select one or more device groups">{{ $item.name }}</ui-select-match>
                        <ui-select-choices class="ui-select-choices" repeat="value.idx as value in valid_device_groups()| props_filter:{name:$select.search}">
                            <div ng-bind-html="value.name | highlight: $select.search"></div>
                        </ui-select-choices>
                    </ui-select>
                </div>
            </div>
            <div class="form-group" ng_show="!create_mode">
                <label class="control-label col-sm-2">
                    Permission
                </label>
                <div class="controls col-sm-8">
                    <div class="input-group" style="max-width:400px; min-width:240px;">
                        <ui-select ng-model="_edit_obj.permission">
                            <ui-select-match class="ui-select-match" placeholder="Select a permission">{{ $select.selected.info }}</ui-select-match>
                            <ui-select-choices class="ui-select-choices" repeat="value.idx as value in valid_group_csw_perms(_edit_obj)| props_filter:{info:$select.search}" group-by="'model_name'">
                                <div ng-bind-html="value.info | highlight: $select.search"></div>
                            </ui-select-choices>
                        </ui-select>
                        <span class="input-group-btn">
                            <button type="button" ng-click="_edit_obj.permission = undefined" class="btn btn-default">
                                <span class="glyphicon glyphicon-trash"/>
                            </button>
                        </span>
                    </div>
                </div>
            </div>
            <div class="form-group" ng_show="!create_mode &amp;&amp; _edit_obj.permission">
                <label class="control-label col-sm-2">
                    Object
                </label>
                <div class="controls col-sm-8">
                    <div class="input-group" style="max-width:400px; min-width:240px;">
                        <ui-select ng-model="_edit_obj.object">
                            <ui-select-match class="ui-select-match" placeholder="Select an object">{{ $select.selected.name }}</ui-select-match>
                            <ui-select-choices class="ui-select-choices" repeat="value.idx as value in object_list()| props_filter:{name:$select.search}" group-by="'group'">
                                <div ng-bind-html="value.name | highlight: $select.search"></div>
                            </ui-select-choices>
                        </ui-select>
                        <span class="input-group-btn">
                            <button type="button" ng-click="_edit_obj.object = undefined" class="btn btn-default">
                                <span class="glyphicon glyphicon-trash"/>
                            </button>
                        </span>
                    </div>
                </div>
            </div>
            <div class="form-group" ng_show="!create_mode">
                <label class="control-label col-sm-2">
                    Permission level
                </label>
                <div class="controls col-sm-8">
                    <ui-select ng-model="_edit_obj.permission_level" style="max-width:400px; min-width:240px;">
                        <ui-select-match class="ui-select-match" placeholder="Select a permission mode">{{ $select.selected.info }}</ui-select-match>
                        <ui-select-choices class="ui-select-choices" repeat="value.level as value in ac_levels">
                            <div ng-bind-html="value.info | highlight: $select.search"></div>
                        </ui-select-choices>
                    </ui-select>
                </div>
            </div>
            <input type="button" name="" value="create global permission" class="btn btn btn-sm btn-success" id="button-id-" ng-click="create_permission()" ng-show="!create_mode &amp;&amp; _edit_obj.permission"></input>
            &#160;<input type="button" name="" value="create object permission" class="btn btn btn-sm btn-primary" id="button-id-" ng-click="create_object_permission()" ng-show="!create_mode &amp;&amp; _edit_obj.permission &amp;&amp; _edit_obj.object"></input>
            <div class="col-sm-12">
                <div icsw-user-permissions="" ng_if="!create_mode" object="_edit_obj" type="group" action="true"></div>
            </div>
        </fieldset>
        <div class="form-actions">
            <input type="submit" name="modify" value="Modify" class="btn btn-primary btn-success" id="submit-id-modify" ng-show="!create_mode"></input> <input type="submit" name="create" value="Create" class="btn btn-primary btn-success" id="submit-id-create" ng-show="create_mode"></input>
            &#160;<input type="button" name="close" value="close" class="btn btn-primary" id="button-id-close" ng-click="group_edit.close_modal()" ng-show="!create_mode"></input>
            &#160;<input type="button" name="delete" value="delete" class="btn btn-danger" id="button-id-delete" ng-click="group_edit.delete_obj(_edit_obj)" ng-show="!create_mode"></input>
        </div>
    </form>
</script>
