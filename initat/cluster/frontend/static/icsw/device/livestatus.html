<script type="text/ng-template" id="icsw.device.livestatus.overview">
    <h3>
        <div class="btn-group">
            <button type="button" class="btn btn-primary btn-sm dropdown-toggle" data-toggle="dropdown">
                Layout ({{ struct.current_layout.icswData.short_name }}) <span class="caret"></span>
            </button>
            <ul class="dropdown-menu">
                <li ng-click="activate_layout(lo)" ng-repeat="lo in struct.layouts">
                    <a>{{ lo.icswData.short_name }}</a>
                </li>
            </ul>
        </div>
        <icsw-livestatus-filter-display
            icsw-livestatus-filter="struct.filter"
            icsw-changed-callback="filter_changed"
        ></icsw-livestatus-filter-display>
        <span ng-show="struct.updating" class="text-warning">Updating data...</span>
    </h3>
    <div class="container-fluid">
        <div ui-view></div>
    </div>
</script>

<script type="text/ng-template" id="icsw.device.livestatus.everything">
    <div class="row">
        <div class="col-md-6 col-xs-12 col-lg-4">
            <icsw-device-livestatus-maplist
                icsw-livestatus-filter="struct.filter"
                icsw-devices="struct.devices"
                icsw-monitoring-data="struct.monitoring_data"
            ></icsw-device-livestatus-maplist>
        </div>
        <div class="col-md-6 col-xs-12 col-lg-4">
            <icsw-config-category-location-show
                icsw-livestatus-filter="struct.filter"
                icsw-monitoring-data="struct.monitoring_data"
            ></icsw-config-category-location-show>
        </div>
        <div class="col-md-6 col-xs-12 col-lg-4">
            <icsw-device-livestatus-fullburst
                icsw-element-size="size"
                icsw-livestatus-filter="struct.filter"
                icsw-monitoring-data="struct.monitoring_data"
            ></icsw-device-livestatus-fullburst>
        </div>
        <div class="col-md-6 col-xs-12 col-lg-4">
            <icsw-category-tree-select
                icsw-livestatus-filter="struct.filter"
                icsw-monitoring-data="struct.monitoring_data"
                mode="'mon'"
            ></icsw-category-tree-select>
        </div>
        <div class="col-md-8 col-xs-12 col-lg-6">
            <icsw-device-livestatus-table-view
                icsw-livestatus-filter="struct.filter"
                icsw-monitoring-data="struct.monitoring_data"
            ></icsw-device-livestatus-table-view>
        </div>
    </div>
</script>

<script type="text/ng-template" id="icsw.device.livestatus.bursttable">
    <div class="row">
        <div class="col-md-12 col-xs-12 col-lg-12">
            <icsw-device-livestatus-fullburst
                icsw-element-size="size"
                icsw-livestatus-filter="struct.filter"
                icsw-monitoring-data="struct.monitoring_data"
            ></icsw-device-livestatus-fullburst>
        </div>
        <div class="col-md-6 col-xs-12 col-lg-8">
            <icsw-device-livestatus-table-view
                icsw-livestatus-filter="struct.filter"
                icsw-monitoring-data="struct.monitoring_data"
            ></icsw-device-livestatus-table-view>
        </div>
        <div class="col-md-6 col-xs-12 col-lg-4">
            <icsw-category-tree-select
                icsw-livestatus-filter="struct.filter"
                icsw-monitoring-data="struct.monitoring_data"
                mode="'mon'"
            ></icsw-category-tree-select>
        </div>
    </div>
</script>

<script type="text/ng-template" id="icsw.device.livestatus.onlytable">
    <div class="row">
        <div class="col-md-6 col-xs-12 col-lg-8">
            <icsw-device-livestatus-table-view
                icsw-livestatus-filter="struct.filter"
                icsw-monitoring-data="struct.monitoring_data"
            ></icsw-device-livestatus-table-view>
        </div>
        <div class="col-md-6 col-xs-12 col-lg-4">
            <icsw-category-tree-select
                icsw-livestatus-filter="struct.filter"
                icsw-monitoring-data="struct.monitoring_data"
                mode="'mon'"
            ></icsw-category-tree-select>
        </div>
    </div>
</script>

<script type="text/ng-template" id="icsw.device.livestatus.mapwithburst">
    <div class="row">
        <div class="col-md-12 col-xs-12 col-lg-12">
            <icsw-config-category-location-show
                icsw-livestatus-filter="struct.filter"
                icsw-monitoring-data="struct.monitoring_data"
            ></icsw-config-category-location-show>
        </div>
        <div class="col-md-12 col-xs-12 col-lg-12">
            <icsw-device-livestatus-fullburst
                icsw-element-size="size"
                icsw-livestatus-filter="struct.filter"
                icsw-monitoring-data="struct.monitoring_data"
            ></icsw-device-livestatus-fullburst>
        </div>
    </div>
    <div class="row">
        <div class="col-md-8 col-xs-12 col-lg-6">
            <icsw-device-livestatus-table-view
                icsw-livestatus-filter="struct.filter"
                icsw-monitoring-data="struct.monitoring_data"
            ></icsw-device-livestatus-table-view>
        </div>
        <div class="col-md-6 col-xs-12 col-lg-4">
            <icsw-category-tree-select
                icsw-livestatus-filter="struct.filter"
                icsw-monitoring-data="struct.monitoring_data"
                mode="'mon'"
            ></icsw-category-tree-select>
        </div>
    </div>
</script>

<script type="text/ng-template" id="icsw.device.livestatus.fullburst">
    <react-burst
        icsw-livestatus-filter="struct.filter"
        icsw-monitoring-data="struct.monitoring_data"
        icsw-draw-parameters="struct.draw_parameters"
    ></react-burst>
</script>

<script type="text/ng-template" id="icsw.device.livestatus.table.view">
    <h3 ng-show="!struct.monitoring_data.filtered_services.length">No checks</h3>
    <table
        st-table="entries_displayed"
        st-safe-src="struct.monitoring_data.filtered_services"
        class="table table-condensed table-hover table-striped"
        style="font-size:100%;width:auto;"
        ng-if="struct.monitoring_data.filtered_services.length"
    >
        <thead>
            <tr>
                <td colspan="99">
                    <span icsw-tools-pagination st-items-by-page="20" possible-items-by-page="20,50,100,200,500,1000"></span>
                    <input placeholder="filter..." st-search="search_str" class="form-control input-sm" type="search">
                    </input>
                </td>
            </tr>
            <tr>
                <td colspan="99">
                    <icsw-tools-show-hide-columns columns="state state_type flags description cats output" create-show-column="true"></icsw-tools-show-hide-columns>
                </td>
            </tr>
            <tr>
                <th st-sort="host_name" st-sort-default="true">device</th>
                <th ng-show="show_column.state" st-sort="state">state</th>
                <th ng-show="show_column.flags">flags</th>
                <th ng-show="show_column.description" st-sort="description">description</th>
                <th ng-show="show_column.cats">categories</th>
                <th st-sort="last_check">last check</th>
                <th st-sort="last_state_change">last change</th>
                <th ng-show="show_column.output" st-sort="plugin_output">result</th>
            </tr>
        </thead>
        <tbody>
            <tr icsw-device-livestatus-table-row
                ng-repeat="service in entries_displayed"
            >
            </tr>
        </tbody>
    </table>
</script>

<script type="text/ng-template" id="icsw.device.livestatus.table.row">
    <td ng-class="service.host.$$icswStateClass" class="text-nowrap">
        {{ service.host_name }}
        <span ng-show="service.host.$$icswShowAttemptInfo" ng-class="service.host.$$icswAttempLabelClass" class="label pull-right">{{ service.host.$$icswAttemptInfo }}</span>
        <span ng-show="service.host.$$icswPassiveCheck" title="host is passive checked" class="glyphicon glyphicon-download pull-right"></span>
    </td>
    <td class="text-nowrap" ng-show="show_column.state" class="label" ng-class="service.$$icswStateLabelClass">
        {{ service.$$icswStateString }}
        <span ng-show="show_column.state_type" class="pull-right badge">{{ service.$$icswStateTypeString }}</span>
    </td>
    <td class="text-nowrap" ng-show="show_column.flags">
        <span class="label pull-right" ng-class="service.$$icswAttemptLabelClass" title="attempt info">{{ service.$$icswAttemptInfo }}</span>
        <span class="pull-right fa fa-pencil" title="acknowledgment status" ng-show="service.acknowledged == '1'"></span>
        <span ng-show="service.$$icswPassiveCheck" title="service is passive checked" class="glyphicon glyphicon-download pull-right"></span>
    </td>
    <td class="text-nowrap" ng-show="show_column.description">{{ service.display_name }}</td>
    <td class="text-nowrap" ng-show="show_column.cats">{{ service.$$icswCategories }}</td>
    <td class="text-nowrap">{{ service.$$icswLastCheckString }}</td>
    <td class="text-nowrap">{{ service.$$icswLastStateChangeString }}</td>
    <td ng-show="show_column.output">{{ service.plugin_output }}</td>
</script>

<script type="text/ng-template" id="icsw.device.livestatus.location.map">
    <h4>{{ loc_gfx.name }}<span ng-show="loc_gfx.comment"> ({{ loc_gfx.comment }})</span></h4>
    <svg icsw-svg-set-viewbox="loc_gfx" ng-show="loc_gfx" ng-attr-width="{{ width }}" ng-attr-height="{{ height }}" preserveAspectRatio="xMidYMid meet">
        <g>
            <image
                xlink:href="{{ loc_gfx.image_url }}"
                ng-attr-width="{{ loc_gfx.width }}"
                ng-attr-height="{{ loc_gfx.height }}"
            >
            </image>
            <polyline icsw-svg-borderpoints="loc_gfx" style="fill:none; stroke:black; stroke-width:3;"></polyline>
            <icsw-device-livestatus-device-node dml="dml" ls-filter="ls_filter" ng-repeat="dml in loc_gfx.dml_list">
            </icsw-device-livestatus-device-node>
            <!--<g>
                <defs>
                    <linearGradient id="MyGradient">
                        <stop offset="0%" stop-color="#ff6000" />
                        <stop offset="100%" stop-color="#00ff0f" />
                    </linearGradient>
                    <marker id='start' orient='auto' markerWidth='30' markerHeight='30'
                        refX='15' refY='15'
                        markerUnits="userSpaceOnUse"
                    >
                        <path d='M0,0 L30,15 L0,30 Z' fill="#00ff0f"/>
                    </marker>
                    <marker id='starts' orient='auto' markerWidth='30' markerHeight='30'
                        refX='15' refY='15'
                        markerUnits="userSpaceOnUse"
                    >
                        <path d='M0,0 L30,15 L0,30 Z' fill="none" stroke="black" stroke-width="2"/>
                    </marker>
                </defs>
                <path
                    d="M10,20 S 200,100 300,300"
                    marker-end="url(#starts)"
                    stroke="black"
                    stroke-width="12"
                    stroke-linecap="round""
                    fill="none"
                />
                <path
                    d="M10,20 S 200,100 300,300"
                    marker-end="url(#start)"
                    stroke="url(#MyGradient)"
                    stroke-width="10"
                    stroke-linecap="round"
                    fill="none"
                />
                <g transform="translate(100,100)">
                    <rect x="-20" y="-10" width="40" height="20"
                        fill="none" stroke="black" stroke-width="2">
                    </rect>
                    <rect x="-20" y="-10" width="40" height="20"
                        fill="white">
                    </rect>
                    <text
                        text-anchor="middle"
                        alignment-baseline="middle"
                        fill="black"
                    >
                    in/out
                    </text>
                </g>
            </g>-->
        </g>
    </svg>
</script>

<script type="text/ng-template" id="icsw.device.livestatus.device.node">
    <g ng-attr-transform="{{ transform }}">
        <newburst
            ls-filter="ls_filter"
            device-pk="dml.device"
            innerradius="20"
            outerradius="50"
            showname="1"
            fontstroke="1"
            draw-all="1"
            zoom-level="d"
            noninteractive="true"
        ></newburst>
    </g>
</script>

<script type="text/ng-template" id="icsw.device.livestatus.maplist">
    <uib-alert type="warning" ng-show="!struct.data_valid">Loading data...</uib-alert>
    <div ng-if="struct.data_valid">
        <h3 ng-show="!struct.maps_present">No maps to show</h3>
        <h3 ng-show="struct.maps_present">
            {{ struct.loc_gfx_list.length }} Maps,
            <span ng-show="struct.cur_page_idx">
                showing map {{ struct.cur_page_idx }},
            </span>
            <span ng-show="struct.autorotate" class="label label-primary">autorotate</span>,
            <icsw-tools-button type="modify" size="xs" ng-click="show_settings()"></icsw-tools-button>
        </h3>
        <uib-tabset ng-if="struct.maps_present" active="struct.page_idx">
            <uib-tab ng-repeat="loc_gfx in struct.loc_gfx_list" select="set_page_idx(loc_gfx)">
                <uib-tab-heading>
                    {{ loc_gfx.name }} (<ng-pluralize count="loc_gfx.$$filtered_dml_list.length" when="{'1': '1 device', 'other' : '{} devices'}"></ng-pluralize>)
                </uib-tab-heading>
                <icsw-device-livestatus-location-map
                    icsw-livestatus-filter="struct.filter"
                    icsw-location-gfx="loc_gfx"
                    icsw-gfx-size="struct.cur_gfx_size"
                    icsw-monitoring-data="struct.monitoring_data"
                ></icsw-device-livestatus-location-map>
            </uib-tab>
        </uib-tabset>
    </div>
</script>

<script type="text/ng-template" id="icsw.device.livestatus.maplist.settings">
    <ng-form class="form-horizontal" name="form_data">
        <h3>Settings</h3>
        <fieldset>
            <legend>Graph settings</legend>
            <div class="form-group">
                <label class="control-label col-sm-3 requiredField">
                   Graph size
                </label>
                <div class="controls col-sm-7">
                    <ui-select ng-model="struct.cur_gfx_size" style="width:200px;">
                        <ui-select-match class="ui-select-match" placeholder="choose size ...">{{ $select.selected }}</ui-select-match>
                        <ui-select-choices class="ui-select-choices" repeat="value in struct.gfx_sizes">
                            <div ng-bind-html="value"></div>
                        </ui-select-choices>
                    </ui-select>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-3 requiredField">
                   Autorotate
                </label>
                <div class="controls col-sm-7">
                    <icsw-tools-button type="enable" is-enable="struct.autorotate" ng-click="toggle_autorotate()"></icsw-tools-button>
                </div>
            </div>
        </fieldset>
    </ng-form>
</script>

<script type="text/ng-template" id="icsw.device.livestatus.filter">
    <span ng-show="num_defined()">
        Number of hosts / checks : {{ get_total_num()[0] }} / {{ get_total_num()[1] }}
        <span ng-show="get_total_num()[1] != get_filtered_num()[1]">
            ({{ get_filtered_num()[1] }} shown)
        </span>
    </span>
    <span ng-show="get_num_maps()"> on
        <ng-pluralize count="get_num_maps()" when="{'1' : '1 map', 'other' : '{} maps'}"/>
    </span>
    , Filter options:
    <div class="btn-group">
        <input ng-repeat="entry in md_states" type="button"
            ng-class="get_mds_class(entry[0])"
            ng-value="entry[1]"
            ng-click="toggle_srv(entry[0])"
            title="{{ entry[3] }}"
        />
    </div>
    <div class="btn-group">
        <input ng-repeat="entry in sh_states" type="button"
            ng-class="get_shs_class(entry[0])"
            ng-value="entry[1]"
            ng-click="toggle_sh(entry[0])"
            title="{{ entry[3] }}"
        />
    </div>
</script>

<script type="text/ng-template" id="icsw.device.livestatus.brief">
    <react-burst
        icsw-livestatus-filter="struct.filter"
        icsw-monitoring-data="struct.monitoring_data"
        icsw-draw-parameters="struct.draw_parameters"
    ></react-burst>
</script>

<script type="text/ng-template" id="icsw.device.livestatus.map">
    <svg width="50" height="50" font-family="'Open-Sans', sans-serif" font-size="10pt">
        <g transform="translate(25,25)">
            <newburst
                ls-filter="ls_filter"
                device-pk="devicepk"
                innerradius="5"
                outerradius="25"
                noninteractive="true"
                draw-all="true"
                zoom-level="g"
                is-drawn="is_drawn"
            ></newburst>
        </g>
    </svg>
</script>

<script type="text/ng-template" id="icsw.device.livestatus.device.row">
    <td>
        <button class="btn btn-primary btn-xs" ng-click="expand_vt(obj)">
            <span ng_class="get_expand_class(obj)"/>
            <span ng-if="var_filter.length"> / {{ obj.num_filtered }} shown</span>
        </button>
    <td/>
    <td>{{ obj.full_name }}</td>
    <td>{{ obj.device_group_name }}</td>
    <td>{{ obj.comment }}</td>
    <td>hints : {{ obj.monitoring_hint_set.length }}</td>
</script>

<script type="text/ng-template" id="icsw.device.livestatus.network_graph">
    <g>
        <path
            ng-repeat="node in nodes track by $index"
            ng-attr-d="{{ node.path }}"
            stroke="black"
            ng-attr-fill="{{ get_fill_color(node) }}"
            ng-attr-fill-opacity="{{ get_fill_opacity(node) }}"
            stroke-width="0.5"
            ng-mouseenter="mouse_enter(node)"
            ng-mouseleave="mouse_leave(node)"
            ng-click="mouse_click(node)"
        >
        </path>
        <polyline
            ng-repeat="node in nodes track by $index"
            ng-attr-points="{{ node.legendpath }}"
            stroke="black"
            fill="none"
            stroke-width="0.5"
            ng-if="node.legend_show"
        >
        </polyline>
        <g ng-repeat="node in nodes track by $index">
            <text
                ng-attr-x="{{ node.legend_x }}"
                ng-attr-y="{{ node.legend_y }}"
                text-anchor="{{ node.legend_anchor }}"
                ng-if="node.legend_show && font_stroke"
                alignment-baseline="middle"
                stroke="white"
                stroke-width="3"
            >{{ node.name }}</text>

            <text
                ng-attr-x="{{ node.legend_x }}"
                ng-attr-y="{{ node.legend_y }}"
                text-anchor="{{ node.legend_anchor }}"
                ng-if="node.legend_show"
                alignment-baseline="middle"
            >{{ node.name }}</text>
        </g>
        <g ng-if="show_name">
            <text
                ng-if="font_stroke"
                text-anchor="middle"
                alignment-baseline="middle"
                font-weight="bold"
                fill="black"
                stroke="white"
                stroke-width="2"
            >{{ name }}</text>
            <text
                text-anchor="middle"
                alignment-baseline="middle"
                font-weight="bold"
                fill="black"
            >{{ name }}</text>
        </g>
    </g>
</script>
