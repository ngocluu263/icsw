<script type="text/ng-template" id="icsw.device.network.overview">
    <h3>
        Network config for {{ devices.length }} devices ({{ local_helper_obj.netdevice_list.length }} netdevices, {{ local_helper_obj.net_ip_list.length }} IPs, {{ local_helper_obj.peer_list.length }} peers)
    </h3>
    <uib-accordion close-others="no">
        <uib-accordion-group is-open="device_open">
            <uib-accordion-heading>
                <i class="glyphicon" ng-class="{'glyphicon-chevron-down': device_open, 'glyphicon-chevron-right': !device_open}"></i>
                {{ devices.length }} devices
            </uib-accordion-heading>
            <table ng-show="devices".length" class="table table-condensed table-hover table-striped" style="width:auto;">
                <thead>
                    <tr>
                        <th>Device</th>
                        <th>Coms</th>
                        <th>ScanInfo</th>
                        <th>BootInfo</th>
                        <th>#Ports</th>
                        <th>#IPs</th>
                        <th>#peers</th>
                        <th>SNMP schemes</th>
                        <th colspan="2">action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr icsw-device-network-device-row ng-repeat="ndip_obj in devices"></tr>
                </tbody>
            </table>
        </uib-accordion-group>
        <uib-accordion-group is-open="netdevice_open">
            <uib-accordion-heading>
                <i class="glyphicon" ng-class="{'glyphicon-chevron-down': netdevice_open, 'glyphicon-chevron-right': !netdevice_open}"></i>
                {{ local_helper_obj.netdevice_list.length }} netdevices
            </uib-accordion-heading>
            <icsw-tools-show-hide-columns ng-show="devices.length" columns="idx port ips peers bridge bond mac devtype mtu speed penalty flags status desired" create-show-column="true">
            </icsw-tools-show-hide-columns>
            <table ng-show="devices.length" class="table table-condensed table-hover table-striped" style="width:auto;">
                <thead>
                    <tr>
                        <th>Device</th>
                        <th ng-show="show_column.idx">idx</th>
                        <th ng-show="show_column.port">Port</th>
                        <th ng-show="show_column.ips">#IPs</th>
                        <th ng-show="show_column.peers">#peers</th>
                        <th ng-show="show_column.bridge">Bridge</th>
                        <th ng-show="show_column.bond">Bond</th>
                        <th ng-show="show_column.mac">MAC</th>
                        <th ng-show="show_column.devtype">Devtype</th>
                        <th ng-show="show_column.mtu">MTU</th>
                        <th ng-show="show_column.speed">speed</th>
                        <th ng-show="show_column.penalty">penalty</th>
                        <th ng-show="show_column.flags">flags</th>
                        <th ng-show="show_column.status">status</th>
                        <th ng-show="show_column.desired">desired</th>
                        <th colspan="4">action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr icsw-device-network-netdevice-row ng-repeat="ndip_obj in local_helper_obj.netdevice_list"></tr>
                </tbody>
            </table>
        </uib-accordion-group>
        <uib-accordion-group is-open="netip_open">
            <uib-accordion-heading>
                <i class="glyphicon" ng-class="{'glyphicon-chevron-down': netip_open, 'glyphicon-chevron-right': !netip_open}"></i>
                {{ local_helper_obj.net_ip_list.length }} IPs
            </uib-accordion-heading>
            <table ng-show="devices.length" class="table table-condensed table-hover table-striped" style="width:auto;">
                <thead>
                    <tr>
                        <th>Device</th>
                        <th>Port</th>
                        <th>IP</th>
                        <th>Network</th>
                        <th>DTN</th>
                        <th>alias</th>
                        <th colspan="2">action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr icsw-device-network-ip-row ng-repeat="ndip_obj in local_helper_obj.net_ip_list"></tr>
                </tbody>
            </table>
        </uib-accordion-group>
        <uib-accordion-group is-open="peer_open">
            <uib-accordion-heading>
                <i class="glyphicon" ng-class="{'glyphicon-chevron-down': peer_open, 'glyphicon-chevron-right': !peer_open}"></i>
                {{ local_helper_obj.peer_list.length }} peer connections
            </uib-accordion-heading>
            <table ng-show="devices.length" class="table table-condensed table-hover table-striped" style="width:auto;">
                <thead>
                    <tr>
                        <th>Device</th>
                        <th>Port</th>
                        <th>IPs</th>
                        <th>cost</th>
                        <th>Device</th>
                        <th>Port</th>
                        <th>IPs</th>
                        <th>type</th>
                        <th>Autocreated</th>
                        <th>Info</th>
                        <th colspan="2">action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr icsw-device-network-peer-row ng-repeat="ndip_obj in local_helper_obj.peer_list track by $index"></tr>
                </tbody>
            </table>
        </uib-accordion-group>
    </uib-accordion>
    <div class="input-group-btn" ng-show="devices.length > 1 && show_copy_button " ng-if="acl_create(null, 'backbone.device.change_network')">
        <div class="btn-group">
            <button type="button" class="btn btn-danger btn-md dropdown-toggle" data-toggle="dropdown">
                Copy network from<span class="caret"></span>
            </button>
            <ul class="dropdown-menu">
                <li ng-click="copy_network(obj, $event)" ng-repeat="obj in devices"><a>{{ obj.full_name }}</a></li>
            </ul>
            <input type="button" ng-class="copy_com_class()" ng-value="copy_com_value()" ng-click="toggle_copy_com()"></input>
        </div>
    </div>
</script>

<script type="text/ng-template" id="icsw.device.com.capabilities">
    <button type="button" class="btn btn-xs" ng-class="com_class()" ladda="pending" data-style="expand-left"></button>
</script>

<script type="text/ng-template" id="icsw.device.network.device.row">
    <td>
        {{ ndip_obj.full_name }}
    </td>
    <td>
        <icsw-device-com-capabilities device="ndip_obj"></icsw-device-com-capabilities>
    </td>
    <td>
        <button type="button" class="btn btn-xs btn-warning" data-spinner-size="12" ng-show="ndip_obj.active_scan" ladda="ndip_obj.active_scan" data-style="expand-left">
            <span>{{ ndip_obj.active_scan }}</span>
        </button>
    </td>
    <td>
        <input
            type="button"
            class="btn btn-xs"
            ng-class="get_bootdevice_info_class(ndip_obj)"
            ng-show="ndip_obj.num_boot_ips"
            ng-value="get_boot_value(ndip_obj)"
            ng-click="edit_boot_settings(ndip_obj, $event)">
        </input>
        <span ng-show="!ndip_obj.num_boot_ips">N/A</span>
    </td>
    <td>
        {{ ndip_obj.num_netdevices }}
    </td>
    <td>
        {{ ndip_obj.num_netips }}
    </td>
    <td>
        {{ ndip_obj.num_peers }}
    </td>
    <td>
        <span ng-repeat="obj in ndip_obj.snmp_schemes">
            <span class="label label-info">{{ obj.full_name }}</span>
        </span>
    </td>
    <td>
        <button type="button" class="btn btn-xs btn-success pull-right"
            uib-tooltip-placement="bottom"
            uib-tooltip-html="build_device_tooltip(ndip_obj)">
            <span class="glyphicon glyphicon-info-sign"></span>
        </button>
    </td>
    <td>
        <div ng-show="acl_create(ndip_obj, 'backbone.device.change_network') && !ndip_obj.active_scan">
            <div class="btn-group btn-xs">

                <button type="button" ng-attr-class="btn btn-xs dropdown-toggle {{ icswToolsButtonConfigService.get_css_class('create') }}" data-toggle="dropdown">
                    Create new <span class="caret"></span>
                </button>
                <ul class="dropdown-menu">
                    <li ng-click="edit_netdevice(ndip_obj, $event, true)"><a>Netdevice</a></li>
                    <li ng-show="create_netip_ok(ndip_obj)" ng-click="edit_netip(ndip_obj, 'dev', $event, true)"><a>IP Address</a></li>
                    <li ng-show="create_peer_ok(ndip_obj)" ng-click="edit_peer(ndip_obj, 'dev', $event, true)"><a>Network topology connection</a></li>
                </ul>
            </div>
            <icsw-tools-button type="reload" value="update network" size="xs"
                ng-show="acl_create(obj, 'backbone.device.change_network')"
                ng-click="scan_device_network(ndip_obj, $event)">
            </icsw-tools-button>
        </div>
    </td>
</script>

<script type="text/ng-template" id="icsw.device.network.netdevice.row">
    <td>
        {{ device_tree.all_lut[ndip_obj.device].full_name }}
    </td>
    <td ng-show="show_column.idx">
        <span ng-show="ndip_obj.snmp_idx">{{ ndip_obj.snmp_idx }}</span>
    <td ng-show="show_column.port">
        <span ng-show="ndip_obj.enabled">
            {{ get_netdevice_name(ndip_obj) }}
        </span>
        <span ng-show="!ndip_obj.enabled">
            <em><strike>{{ get_netdevice_name(ndip_obj) }}</strike></em>
        </span>
    </td>
    <td ng-show="show_column.ips">
        {{ ndip_obj.num_netips }}
    </td>
    <td ng-show="show_column.peers">
        {{ get_num_peers_nd(ndip_obj) }}
    </td>
    <td ng-show="show_column.bridge">{{ get_bridge_info(ndip_obj) }}</td>
    <td ng-show="show_column.bond">{{ get_bond_info(ndip_obj) }}</td>
    <td ng-show="show_column.mac">{{ ndip_obj.macaddr }}</td>
    <td ng-show="show_column.devtype">{{ get_network_type(ndip_obj) }}</td>
    <td ng-show="show_column.mtu" class="text-right">{{ ndip_obj.mtu }}</td>
    <td ng-if="show_column.speed && ndip_obj.ignore_netdevice_speed" style="text-decoration: line-through;">
        {{ get_netdevice_speed(ndip_obj) }}
    </td>
    <td ng-if="show_column.speed && !ndip_obj.ignore_netdevice_speed">
        {{ get_netdevice_speed(ndip_obj) }}
    </td>
    <td ng-show="show_column.penalty" class="text-right">{{ ndip_obj.penalty }}</td>
    <td ng-show="show_column.flags">{{ get_nd_flags(ndip_obj) }}</td>
    <td ng-show="show_column.status" ng-class="get_snmp_ao_status_class(ndip_obj)">{{ get_snmp_ao_status(ndip_obj) }}</td>
    <td ng-show="show_column.desired" class="text-center">{{ get_desired_status(ndip_obj) }}</td>
    <td>
        <button type="button" class="btn btn-xs btn-success"
         uib-tooltip-placement="right"
         uib-tooltip-html="build_netdevice_tooltip(ndip_obj)">
             <span class="glyphicon glyphicon-info-sign"></span>
         </button>
    </td>
    <td>
        <div ng-show="!dev_lut[ndip_obj.device].active_scan">
            <icsw-tools-button type="modify" ng-click="edit_netdevice(ndip_obj, $event, false)" size="xs"
                    ng-show="acl_modify(obj, 'backbone.device.change_network')"></icsw-tools-button>
        </div>
    </td>
    <td>
        <div ng-show="!dev_lut[ndip_obj.device].active_scan">
            <icsw-tools-button type="delete" size="xs" ng-click="delete_netdevice(ndip_obj, $event)" ng-show="acl_delete(obj, 'backbone.device.change_network')"/>
        </div>
    </td>
    <td>
        <div class="btn-group btn-xs" ng-show="acl_create(obj, 'backbone.device.change_network') && !dev_lut[ndip_obj.device].active_scan">
            <button type="button" class="btn {{ icswToolsButtonConfigService.get_css_class('create') }} btn-xs dropdown-toggle" data-toggle="dropdown">
                Create new <span class="caret"></span>
            </button>
            <ul class="dropdown-menu">
                <li ng-show="network_tree.nw_list.length" ng-click="edit_netip(ndip_obj, 'nd', $event, true)"><a>IP Address</a></li>
                <li ng-click="edit_peer(ndip_obj, 'nd', $event, true)"><a>Network topology connection</a></li>
            </ul>
        </div>
    </td>
</script>

<script type="text/ng-template" id="icsw.device.network.ip.row">
    <td>{{ get_devname_from_ip(ndip_obj) }}</td>
    <td>{{ get_netdevice_name_from_ip(ndip_obj) }}</td>
    <td>{{ ndip_obj.ip }}</td>
    <td>{{ get_network_name_from_ip(ndip_obj) }}</td>
    <td>{{ get_domain_tree_name_from_ip(ndip_obj) }}</td>
    <td>
        <span ng-show="ndip_obj.alias">{{ ndip_obj.alias }} <span ng-show="ndip_obj.alias_excl">( exclusive )</span></span>
    </td>
    <td>
        <div ng-show="!dev_lut[nd_lut[ndip_obj.netdevice].device].active_scan">
            <icsw-tools-button type="modify" size="xs" ng-click="edit_netip(ndip_obj, 'ip', $event, false)" ng-show="acl_modify(obj, 'backbone.device.change_network')"/>
        </div>
    </td>
    <td>
        <div ng-show="!dev_lut[nd_lut[ndip_obj.netdevice].device].active_scan">
            <icsw-tools-button type="delete" size="xs" ng-click="delete_netip(ndip_obj, $event)" ng-show="acl_delete(obj, 'backbone.device.change_network')"/>
        </div>
    </td>
</script>

<script type="text/ng-template" id="icsw.device.network.peer.row">
    <td ng-class="get_peer_class(ndip_obj, 's')">{{ get_devname_from_peer(ndip_obj, "s") }}</td>
    <td ng-class="get_peer_class(ndip_obj, 's')">{{ get_netdevice_name_from_peer(ndip_obj, "s") }}</td>
    <td ng-class="get_peer_class(ndip_obj, 's')">{{ get_ip_list_from_peer(ndip_obj, "s") }}</td>
    <td>
        with cost {{ ndip_obj.penalty }}
        &nbsp;<span class="label label-primary">{{ get_peer_cost(ndip_obj) }}</span>&nbsp;
    </td>
    <td ng-class="get_peer_class(ndip_obj, 'd')">{{ get_devname_from_peer(ndip_obj, "d") }}</td>
    <td ng-class="get_peer_class(ndip_obj, 'd')">{{ get_netdevice_name_from_peer(ndip_obj, "d") }}</td>
    <td ng-class="get_peer_class(ndip_obj, 'd')">{{ get_ip_list_from_peer(ndip_obj, "d") }}</td>
    <td>
        {{ get_peer_type(ndip_obj) }}
    </td>
    <td class="text-center">
        {{ ndip_obj.peer.autocreated | yesno2 }}
    </td>
    <td>
        {{ ndip_obj.peer.info }}
    </td>
    <td>
        <icsw-tools-button type="modify" size="xs" ng-click="edit_peer(ndip_obj, 'peer', $event, false)" ng-show="acl_modify(obj, 'backbone.device.change_network')"></icsw-tools-button>
    </td>
    <td>
        <icsw-tools-button type="delete" size="xs" ng-click="delete_peer(ndip_obj, $event)" ng-show="acl_delete(obj, 'backbone.device.change_network')"></icsw-tools-button>
    </td>
</script>

<script type="text/ng-template" id="icsw.device.network.cluster.info">
    <ul>
        <li ng-repeat="device in devices">
            {{ device.full_name }} ({{ device.device_group_name }})
        </li>
    </ul>
</script>

<script type="text/ng-template" id="icsw.device.network.host.node">
    <g class="node draggable" node_id="{{ node.id }}"
        ng-mouseenter="mouse_enter()"
        ng-mouseleave="mouse_leave()"
        ng-click="mouse_click()"
    >
        <circle r="18" fill="{{ fill_color }}" stroke-width="{{ stroke_width }}" stroke="{{ stroke_color }}" cursor="crosshair"></circle>
        <text text-anchor="middle" alignment-baseline="middle" cursor="crosshair">{{ node.name }}</text>
    </g>
</script>

<script type="text/ng-template" id="icsw.device.network.host.livestatus">
    <g class="node draggable" node_id="{{ node.id }}">
        <newburst
            ls-filter="ls_filter"
            device-pk="devicepk"
            innerradius="20"
            outerradius="30"
            noninteractive="true"
            zoom-level="d"
        ></newburst>
        <text text-anchor="middle" alignment-baseline="middle" cursor="crosshair">{{ node.name }}</text>
    </g>
</script>

<script type="text/ng-template" id="icsw.device.network.host.link">
    <line stroke="#ff7788" stroke-width="2" opacity="1">
    </line>
</script>

<script type="text/ng-template" id="icsw.device.network.graph">
    <div>
        <h4>{{ zoom.factor | number:2 }}@({{ offset.x | number:0 }}, {{ offset.y | number:0 }})</h4>
        <icsw-device-network-graph2 icsw-mouse-capture></icsw-device-network-graph2>
    </div>
</script>

<script type="text/ng-template" id="icsw.device.network.graph2">
    <svg
        class="draggable"
        ng-attr-width="{{ size.width }}"
        ng-attr-height="{{ size.height }}"
        ng-attr-viewBox="0 0 {{ size.width }} {{ size.height }}"
        preserveAspectRatio="xMidYMid"
        pointer-events="all"
        msd-wheel="mouse_wheel($event, $delta, $deltax, $deltay)"
        ng-mousedown="mouse_down($event)"
    >
        <!-- translate before scale: no need to scale offsets -->
        <rect style="stroke:black;stroke-width:2px;fill-opacity:0" x="0" y="0" ng-attr-width="{{ size.width }}" ng-attr-height="{{ size.height }}"></rect>
        <g ng-attr-transform="translate({{ offset.x }}, {{ offset.y }}) scale({{ zoom.factor }})">
            <icsw-device-network-host-link ng-repeat="link in links" link="link" redraw="redraw_nodes"></icsw-device-network-host-link>
            <icsw-device-network-host-livestatus
                ng-if="show_livestatus"
                devicepk="node.id"
                icsw-device-network-node-transform="node"
                icsw-device-network-node-dbl-click="node"
                ng-repeat="node in nodes"
                ls-filter="ls_filter"
                redraw="redraw_nodes"
                ng-dblclick="double_click($event)"
            ></icsw-device-network-host-livestatus>
            <icsw-device-network-host-node
                icsw-device-network-node-transform="node"
                icsw-device-network-node-dbl-click="node"
                ng-repeat="node in nodes"
                node="node"
                redraw="redraw_nodes"
                ng-dblclick="double_click($event)"
            ></icsw-device-network-host-node>
        </g>
    </svg>
</script>

<script type="text/ng-template" id="icsw.device.network.total">
    <uib-tabset icsw-tools-add-acl-functions>
        <uib-tab heading="Device settings">
            <icsw-device-network-overview icsw-sel-man="0" icsw-sel-man-sel-mode="d" show-copy-button="1">
            </icsw-device-network-overview>
        </uib-tab>

        <uib-tab heading="Network topology">
            <div ng-controller="icswDeviceNetworkGraphCtrl">
                <h3>
                    Network topology for {{ devices.length }} devices
                </h3>
                <form class="form-inline">
                    Show network topology for
                    <div class="form-group">
                        <select ng-model="graph_sel" class="form-control" ng-change="fetch_data()">
                            <option value="none">none</option>
                            <option value="all_with_peers" title="all devices with peers" ng-if="acl_read(null, 'backbone.network.show_clusters')">all peered</option>
                            <option value="all" title="all devices">all</option>
                            <option value="sel">selected</option>
                            <option value="selp1" ng-if="acl_read(null, 'backbone.network.show_clusters')">selected + 1 (next ring)</option>
                            <option value="selp2" ng-if="acl_read(null, 'backbone.network.show_clusters')">selected + 2</option>
                            <option value="selp3" ng-if="acl_read(null, 'backbone.network.show_clusters')">selected + 3</option>
                            <option value="core" ng-if="acl_read(null, 'backbone.network.show_clusters')">core (non-trivial)</option>
                        </select>, mode:
                    </div>
                    <div class="form-group">
                        <icsw-tools-button type="reload" value="Redraw" size="sm" ng-click="fetch_data()"></icsw-tools-button>
                    </div>
                    <div class="form-group">,
                        <icsw-tools-button type="show" value="Show Livestatus" size="sm" is-show="!show_livestatus" ng-click="show_livestatus = !show_livestatus">
                        </icsw-tools-button>
                        livestatus
                    </div>
                    <icsw-device-livestatus-filter ng-show="show_livestatus" ls-filter="ls_filter"></icsw-device-livestatus-filter>
                </form>
                <icsw-device-network-graph ls-filter="ls_filter"></icsw-device-network-graph>
            </div>
        </uib-tab>
        <uib-tab heading="Clusters" ng-if="acl_read(null, 'backbone.network.show_clusters')" select="select_tab('cluster')">
            <div ng-controller="icswDeviceNetworkClusterCtrl">
                <h3>Network clusters ({{ clusters.length }})</h3>
                <icsw-tools-button type="reload" value="reload" size="sm" ng-click="reload()"></icsw-tools-button>
                <table class="table table-condensed table-hover table-striped" style="width:auto;">
                    <thead>
                        <tr>
                            <th>Index</th>
                            <th>has netdevices</th>
                            <th>devices</th>
                            <th>netdevices</th>
                            <th>selected</th>
                            <th>action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="cluster in clusters">
                            <td>{{ $index + 1 }}</td>
                            <td>{{ cluster.with_netdevices | yesno2 }}</td>
                            <td class="text-right">{{ cluster.devices }}</td>
                            <td class="text-right">{{ cluster.net_devices }}</td>
                            <td class="text-center">{{ is_selected(cluster) }}</td>
                            <td>
                                <input type="button" class="btn btn-xs btn-primary" value="show" ng-click="show_cluster(cluster)"/>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </uib-tab>

        <uib-tab heading="Networks">
            <icsw-network-list></icsw-network-list>
        </uib-tab>

        <uib-tab heading="Network types">
            <icsw-tools-rest-table-new target-list="entries" config-service="icswNetworkTypeService">
                <h3>Network types ({{entries.length}} entries)</h3>
                <icsw-tools-button type="create" value="create new" ng-click="create($event)" size="sm"/>
                <table st-table="entries_displayed" st-safe-src="entries"
                       class="table table-hover table-condensed table-striped" style="width:auto;">
                    <thead>
                        <tr>
                            <th st-sort="identifier" st-sort-default="true">Type</th>
                            <th st-sort="description">Description</th>
                            <th colspan="2" class="text-center">action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="obj in entries_displayed">
                            <td>{{ config_service.resolve_type(obj.identifier) }} ({{ obj.identifier }})</td>
                            <td>{{ obj.description }}</td>
                            <td><icsw-tools-button type="modify" ng-click="edit($event, obj)" size="xs"></icsw-tools-button></td>
                            <td><icsw-tools-button type="delete" ng-click="delete(obj)" size="xs"></icsw-tools-button></td>
                        </tr>
                    </tbody>
                </table>
            </icsw-tools-rest-table-new>
        </uib-tab>

        <uib-tab heading="Network device types">
            <icsw-tools-rest-table-new target-list="entries" config-service="icswNetworkDeviceTypeService">
                <h3>Network device types ({{entries.length}} entries)</h3>
                <icsw-tools-button type="create" ng-click="create($event)" size="sm"/>
                <table st-table="entries_displayed" st-safe-src="entries"
                       class="table table-hover table-condensed table-striped" style="width:auto;">
                    <thead>
                        <tr>
                            <td colspan="99">
                                <div icsw-tools-pagination st-items-by-page="10" st-displayed-pages="11" possible-items-by-page="10,20,50,100,200,500,1000"></div>
                            </td>
                        </tr>
                        <tr>
                            <th st-sort="identifier" st-sort-default="true">Id</th>
                            <th st-sort="description">Description</th>
                            <th st-sort="name_re">RegExp</th>
                            <th st-sort="mac_bytes">MAC bytes</th>
                            <th st-sort="allow_virtual_interfaces">virtIF allowed</th>
                            <th st-sort="for_matching">for matching</th>
                            <th st-sort="auto_created">Autocreated</th>
                            <th colspan="2" class="text-center">action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="obj in entries_displayed">
                            <td>{{ obj.identifier }}</td>
                            <td>{{ obj.description  }}</td>
                            <td>{{ obj.name_re }}</td>
                            <td class="text-center">{{ obj.mac_bytes }}</td>
                            <td class="text-center">{{ obj.allow_virtual_interfaces | yesno1 }}</td>
                            <td class="text-center">{{ obj.for_matching | yesno2 }}</td>
                            <td class="text-center">{{ obj.auto_created | yesno2 }}</td>
                            <td><icsw-tools-button type="modify" ng-click="edit($event, obj)" size="xs"></icsw-tools-button></td>
                            <td><icsw-tools-button type="delete" ng-click="delete(obj)" size="xs"></icsw-tools-button></td>
                        </tr>
                    </tbody>
                </table>
            </icsw-tools-rest-table-new>
        </uib-tab>
    </uib-tabset>
</script>

<script type="text/ng-template" id="icsw.network.list">
    <icsw-tools-rest-table-new target-list="entries" config-service="icswNetworkListService">
        <h3>Networks ({{entries.length}} entries)</h3>
        <div class="btn-group">
            <icsw-tools-button type="create" ng-click="create($event)" size="sm"></icsw-tools-button>
            <icsw-tools-button type="reload" ng-click="config_service.reload_networks()" size="sm"></icsw-tools-button>
            <icsw-tools-button type="create" value="Scan networks" ng-if="!entries.length" ng-click="config_service.rescan_networks()" size="sm"></icsw-tools-button>
        </div>

        <table st-table="entries_displayed" st-safe-src="entries" ng-show="entries.length"
               class="table table-hover table-condensed table-striped" style="width:auto;">

            <thead>
                <tr>
                    <td colspan="99">
                        <div icsw-tools-pagination st-items-by-page="10" st-displayed-pages="11"
                             possible-items-by-page="10,20,50,100,200,500,1000">
                        </div>
                        <icsw-tools-show-hide-columns columns="network gateway autorange prefDTN" create-show-column="true">
                        </icsw-tools-show-hide-columns>
                    </td>
                </tr>
                <tr>
                    <th st-sort="identifier" st-sort-default="true">Id</th>
                    <th ng-show="show_column.network" st-sort="network">Network definition</th>
                    <th ng-show="show_column.gateway" st-sort="gateway">Gateway</th>
                    <th ng-show="show_column.gateway" st-sort="gw_pri">gw pri</th>
                    <th ng-show="show_column.autorange">AutoRange</th>
                    <th st-sort="num_ip">#IPs</th>
                    <th st-sort="penalty">Penalty</th>
                    <th st-sort="enforce_unique_ips">uniqueIP</th>
                    <th st-sort="network_type">Type</th>
                    <th st-sort="master_network">Master</th>
                    <th ng-show="show_column.prefDTN">preferred DTN</th>
                    <th st-sort="network_device_type">devtype(s)</th>
                    <th colspan="2" class="text-center">action</th>
                </tr>
            </thead>

            <tbody>
                <tr ng-repeat="obj in entries_displayed">
                    <td>{{ obj.identifier }}</td>
                    <td ng-show="show_column.network" style="font-family:monospace;">
                        <span style="background-color:#ededed;" ng-bind-html="obj.network | ip_fixed_width"></span> /
                        <span style="background-color:#ededed;" ng-bind-html="obj.netmask | ip_fixed_width"></span> /
                        <span style="background-color:#ededed;" ng-bind-html="obj.broadcast | ip_fixed_width"></span>
                    </td>
                    <td ng-show="show_column.gateway" style="font-family:monospace;">
                        <span style="background-color:#ededed;" ng-bind-html="obj.gateway | ip_fixed_width"></span>
                    </td>
                    <td ng-show="show_column.gateway" class="text-center">
                        <span class="badge">{{ obj.gw_pri }}</span>
                    </td>
                    <td ng-show="show_column.autorange" style="font-family:monospace;">
                        <span ng-switch="config_service.autorange_set(obj)">
                            <span ng-switch-when="true">
                                <span style="background-color:#ededed;" ng-bind-html="obj.start_range | ip_fixed_width"></span> -
                                <span style="background-color:#ededed;" ng-bind-html="obj.end_range | ip_fixed_width"></span>
                            </span>
                            <span ng-switch-default>
                                ----
                            </span>
                        </span>
                    </td>
                    <td class="text-right">{{ obj.num_ip }}</td>
                    <td class="text-center">{{ obj.penalty }}</td>
                    <td class="text-center">{{ obj.enforce_unique_ips | yesno1 }}</td>
                    <td>
                        {{ config_service.nw_tree().nw_type_lut[obj.network_type].description }}
                    </td>
                    <td>
                        {{ config_service.get_master_network_id(obj) }}
                    </td>
                    <td ng-show="show_column.prefDTN">
                        {{ config_service.preferred_dtn(obj) }}
                    </td>
                    <td>
                        {{ config_service.get_network_device_types(obj) }}
                    </td>
                    <td>
                        <icsw-tools-button type="modify" size="xs" ng-click="edit($event, obj)"/>
                    </td>
                    <td>
                        <icsw-tools-button type="delete" ng-show="obj.num_ip == 0" ng-click="delete(obj)" size="xs">
                        </icsw-tools-button>
                        <icsw-tools-button type="show" ng-show="obj.num_ip > 0" size="xs"
                                           is-show="config_service.network_display.active_network != obj "
                                           ng-click="config_service.show_network(obj)">
                        </icsw-tools-button>
                    </td>
                </tr>
            </tbody>
        </table>

        <div ng-show="config_service.network_display.active_network" >
            <h3>Network {{ config_service.network_display.active_network.identifier }}, {{ config_service.network_display.active_network.num_ip }} IP addresses</h3>
            <table st-table="network_entries_displayed" st-safe-src="config_service.network_display.iplist" class="table table-condensed table-hover" style="width:auto;">
                <thead>
                    <tr>
                        <td colspan="99">
                            <div icsw-tools-pagination st-items-by-page="10" st-displayed-pages="11" possible-items-by-page="10,20,50,100,200,500,1000"></div>
                        </td>
                    </tr>
                    <tr>
                        <th st-sort="ip">IP</th>
                        <th st-sort="netdevice_name">Netdevice</th>
                        <th st-sort="device_full_name">Device</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="obj in network_entries_displayed">
                       <td>{{ obj.ip }}</td>
                       <td>{{ obj.netdevice_name }}</td>
                       <td>{{ obj.device_full_name }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </icsw-tools-rest-table-new>
</script>

<script type="text/ng-template" id="network.device.type.form">
    <form id="form" class="form-horizontal" name="form_data">
        <fieldset>
            <legend>Base data</legend>
            <div class="form-group ng-class:form_error('identifier')">
                <label class="control-label col-sm-3 requiredField">
                    Identifier<span class="asteriskField">*</span></label>
                <div class="controls col-sm-7">
                    <input class="textinput textInput form-control" maxlength="48" ng-model="edit_obj.identifier" placeholder="Identifier" required="True" type="text"/>
                </div>
            </div>
            <div class="form-group ng-class:form_error('description')">
                <label class="control-label col-sm-3 requiredField">
                    Description<span class="asteriskField">*</span>
                </label>
                <div class="controls col-sm-7">
                    <input class="textinput textInput form-control" maxlength="192" ng-model="edit_obj.description" placeholder="Description" required="True" type="text"/>
                </div>
            </div>
            <div class="form-group ng-class:form_error('name_re')">
                <label class="control-label col-sm-3 requiredField">
                    Name regexp<span class="asteriskField">*</span></label>
                <div class="controls col-sm-7">
                    <input class="textinput textInput form-control" maxlength="128" ng-model="edit_obj.name_re" placeholder="Regular expression" required="True" type="text" value="^.*$"/>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-3 requiredField">
                    #MAC bytes<span class="asteriskField">*</span>
                </label>
                <div class="controls col-sm-7">
                    <input class="numberinput form-control" max="24" min="6" ng-model="edit_obj.mac_bytes" placeholder="MAC bytes" required="True" type="number" value="6"/>
                </div>
            </div>
        </fieldset>
        <fieldset>
            <legend>Flags</legend>
            <div class="form-group">
                <div class="checkbox">
                    <div class="controls col-sm-7">
                        <label>
                            <input checked="checked" class="checkboxinput checkbox" ng-model="edit_obj.allow_virtual_interfaces" type="checkbox"/>
                            Allow virtual interfaces
                        </label>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <div class="checkbox">
                    <div class="controls col-sm-7">
                        <label>
                            <input checked="checked" class="checkboxinput checkbox" ng-model="edit_obj.for_matching" type="checkbox"/>
                            Used for matching
                        </label>
                    </div>
                </div>
            </div>
        </fieldset>
    </form>
</script>

<script type="text/ng-template" id="icsw.netdevice.form">
    <form class="form-horizontal" name="form_data">
        <uib-tabset>
            <uib-tab heading="Basic settings">
                <fieldset>
                    <div class="form-group  ng-class:form_error('devname')">
                        <label class="control-label col-sm-3 requiredField">
                            Devname<span class="asteriskField">*</span>
                        </label>
                        <div class="controls col-sm-8">
                            <input class="textinput textInput form-control" maxlength="64" ng-model="edit_obj.devname" placeholder="devicename" required="True" type="text"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-3">
                            Description
                        </label>
                        <div class="controls col-sm-8">
                            <input class="textinput textInput form-control" maxlength="765" ng-model="edit_obj.description" type="text"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-3 requiredField">
                            MTU<span class="asteriskField">*</span>
                        </label>
                        <div class="controls col-sm-8">
                            <input class="numberinput form-control" ng-model="edit_obj.mtu" required="True" type="number" value="1500"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-3">
                            Netdevice speed
                        </label>
                        <div class="controls col-sm-8">
                            <ui-select ng-model="edit_obj.netdevice_speed" style="max-width:400px; min-width:240px;" ng-disabled="false">
                                <ui-select-match class="ui-select-match" placeholder="select a target netdevice speed">{{$select.selected.info_string}}</ui-select-match>
                                <ui-select-choices class="ui-select-choices" repeat="value.idx as value in network_tree.nw_speed_list">
                                    <div ng-bind-html="value.info_string | highlight: $select.search"></div>
                                </ui-select-choices>
                            </ui-select>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="checkbox">
                            <div class="controls col-lg-offset-0 col-sm-8">
                                <label>
                                    <input class="checkboxinput checkbox" ng-model="edit_obj.ignore_netdevice_speed" type="checkbox"/>
                                    Ignore netdevice speed
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="checkbox">
                            <div class="controls col-lg-offset-0 col-sm-8">
                                <label>
                                    <input class="checkboxinput checkbox" ng-model="edit_obj.enabled" type="checkbox"/>
                                    Enabled
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-3">
                            Desired status
                        </label>
                        <div class="controls col-sm-8">
                            <ui-select ng-model="edit_obj.desired_status" style="max-width:400px; min-width:240px;" ng-disabled="false">
                                <ui-select-match class="ui-select-match" placeholder="select the desired status">{{$select.selected.info_string}}</ui-select-match>
                                <ui-select-choices class="ui-select-choices" repeat="value.short as value in desired_stati">
                                    <div ng-bind-html="value.info_string | highlight: $select.search"></div>
                                </ui-select-choices>
                            </ui-select>
                        </div>
                    </div>
                </fieldset>
                <fieldset>
                    <legend>Routing settings</legend>
                    <div class="form-group">
                        <div class="checkbox">
                            <div class="controls col-lg-offset-0 col-sm-8">
                                <label>
                                    <input class="checkboxinput checkbox" ng-model="edit_obj.routing" type="checkbox"/>
                                    network topology central node
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-3">
                            Cost
                        </label>
                        <div class="controls col-sm-8">
                            <input class="numberinput form-control" max="128" min="1" name="penalty" ng-model="edit_obj.penalty" type="number" value="1"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="checkbox">
                            <div class="controls col-lg-offset-0 col-sm-8">
                                <label>
                                    <input class="checkboxinput checkbox" ng-model="edit_obj.inter_device_routing" type="checkbox"/>
                                    Inter device routing
                                </label>
                            </div>
                        </div>
                    </div>
                </fieldset>
                <fieldset ng-show="!edit_obj.is_bridge && !edit_obj.is_bond && !edit_obj.bond_master && !edit_obj.bridge_device && get_vlan_masters(edit_obj).length">
                    <legend>VLAN settings</legend>
                    <div class="form-group">
                        <label class="control-label col-sm-3">
                            Master device
                        </label>
                        <div class="controls col-sm-8">
                            <div class="input-group" style="max-width:400px; min-width:240px;">
                                <ui-select ng-model="_dit_obj.master_device" ng-disabled="false">
                                    <ui-select-match class="ui-select-match" placeholder="VLAN master device">{{$select.selected.devname}}</ui-select-match>
                                    <ui-select-choices class="ui-select-choices" repeat="value.idx as value in get_vlan_masters(edit_obj)">
                                        <div ng-bind-html="value.devname | highlight: $select.search"></div>
                                    </ui-select-choices>
                                </ui-select>
                                <span class="input-group-btn">
                                    <button type="button" ng-click="edit_obj.master_device = undefined" class="btn btn-default">
                                        <span class="glyphicon glyphicon-trash"></span>
                                    </button>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-3">
                            VLAN id
                        </label>
                        <div class="controls col-sm-8">
                            <input class="numberinput form-control" max="255" min="0" ng-model="edit_obj.vlan_id" type="number" value="0"/>
                        </div>
                    </div>
                </fieldset>
            </uib-tab>
            <uib-tab heading="Bridge / Bond">
                <fieldset ng-show="!edit_obj.vlan_id && !edit_obj.bond_master && !edit_obj.is_bond">
                    <legend>Bridge settings</legend>
                    <div class="form-group">
                        <div class="checkbox" ng_show="!edit_obj.bridge_device">
                            <div class="controls col-lg-offset-0 col-sm-8">
                                <label>
                                    <input class="checkboxinput checkbox" ng-disabled="has_bridge_slaves(edit_obj)" ng-model="edit_obj.is_bridge" type="checkbox"/>
                                    Is bridge device
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group" ng_show="!edit_obj.is_bridge && get_bridge_masters(edit_obj).length">
                        <label class="control-label col-sm-3">
                            Bridge device
                        </label>
                        <div class="controls col-sm-8">
                            <div class="input-group" style="max-width:400px; min-width:240px;">
                                <ui-select ng-model="edit_obj.bridge_device" style="max-width:400px; min-width:240px;" ng-disabled="false">
                                    <ui-select-match class="ui-select-match" placeholder="bridge master device">{{ $select.selected.devname }}</ui-select-match>
                                    <ui-select-choices class="ui-select-choices" repeat="value.idx as value in get_bridge_masters(edit_obj)">
                                        <div ng-bind-html="value.devname | highlight: $select.search"></div>
                                    </ui-select-choices>
                                </ui-select>
                                <span class="input-group-btn">
                                    <button type="button" ng-click="edit_obj.bridge_device = undefined" class="btn btn-default">
                                        <span class="glyphicon glyphicon-trash"></span>
                                    </button>
                                </span>
                            </div>
                        </div>
                    </div>
                </fieldset>
                <fieldset ng-show="!edit_obj.vlan_id && !edit_obj.bridge_device && !edit_obj.is_bridge">
                    <legend>Bond settings</legend>
                    <div class="form-group">
                        <div class="checkbox" ng_show="!edit_obj.bond_master">
                            <div class="controls col-lg-offset-0 col-sm-8">
                                <label>
                                    <input class="checkboxinput checkbox" ng-disabled="has_bond_slaves(edit_obj)" ng-model="_edit_obj.is_bond" type="checkbox"/>
                                    Is bond master
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group" ng_show="!edit_obj.is_bond && get_bond_masters(edit_obj).length">
                        <label class="control-label col-sm-3">
                            Bond master
                        </label>
                        <div class="controls col-sm-8">
                            <div class="input-group" style="max-width:400px; min-width:240px;">
                                <ui-select ng-model="edit_obj.bond_master" style="max-width:400px; min-width:240px;" ng-disabled="false">
                                    <ui-select-match class="ui-select-match" placeholder="bond master device">{{ $select.selected.devname }}</ui-select-match>
                                    <ui-select-choices class="ui-select-choices" repeat="value.idx as value in get_bond_masters(edit_obj)">
                                        <div ng-bind-html="value.devname | highlight: $select.search"></div>
                                    </ui-select-choices>
                                </ui-select>
                                <span class="input-group-btn">
                                    <button type="button" ng-click="edit_obj.bond_master = undefined" class="btn btn-default">
                                        <span class="glyphicon glyphicon-trash"></span>
                                    </button>
                                </span>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </uib-tab>
            <uib-tab heading="Hardware">
                <fieldset>
                    <div class="form-group">
                        <label class="control-label col-sm-3">
                            Driver
                        </label>
                        <div class="controls col-sm-8">
                            <input class="textinput textInput form-control" maxlength="384" ng-model="edit_obj.driver" type="text" value="e1000e"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-3">
                            Driver options
                        </label>
                        <div class="controls col-sm-8">
                            <input class="textinput textInput form-control" maxlength="672" ng-model="edit_obj.driver_options" type="text"/>
                        </div>
                    </div>
                </fieldset>
                <fieldset>
                    <legend>ethtool settings (for cluster boot)</legend>
                    <div class="form-group">
                        <label class="control-label col-sm-3 requiredField">
                            Ethtool autoneg<span class="asteriskField">*</span>
                        </label>
                        <div class="controls col-sm-8">
                            <select class="select form-control" ng-change="update_ethtool(edit_obj)" ng-model="edit_obj.ethtool_autoneg" ng-options="a.id as a.option for a in ethtool_autoneg">
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-3 requiredField">
                            Ethtool duplex<span class="asteriskField">*</span>
                        </label>
                        <div class="controls col-sm-8">
                            <select class="select form-control" ng-change="update_ethtool(edit_obj)" ng-model="edit_obj.ethtool_duplex" ng-options="a.id as a.option for a in ethtool_duplex">
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-3 requiredField">
                            Ethtool speed<span class="asteriskField">*</span>
                        </label>
                        <div class="controls col-sm-8">
                            <select class="select form-control" ng-change="update_ethtool(edit_obj)" ng-model="edit_obj.ethtool_speed" ng-options="a.id as a.option for a in ethtool_speed">
                            </select>
                        </div>
                    </div>
                </fieldset>
                <fieldset>
                    <legend>MAC Address settings</legend>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="control-label col-sm-3">
                                    MAC-Address
                                </label>
                                <div class="controls col-sm-8">
                                    <input class="textinput textInput form-control" maxlength="177" name="macaddr" ng-model="edit_obj.macaddr" type="text"/>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="control-label col-sm-3">
                                    Fake MAC-Address
                                </label>
                                <div class="controls col-sm-8">
                                    <input class="textinput textInput form-control" maxlength="177" name="fake_macaddr" ng-model="edit_obj.fake_macaddr" type="text"/>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="checkbox">
                            <div class="controls col-lg-offset-0 col-sm-8">
                                <label>
                                    <input class="checkboxinput checkbox" ng-model="edit_obj.dhcp_device" type="checkbox"/>
                                    force write DHCP address (greedy mode will not work)
                                </label>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </uib-tab>
        </uib-tabset>
    </form>
</script>

<script type="text/ng-template" id="network.form">
    <form id="form" class="form-horizontal" name="form_data">
        <uib-tabset>
            <uib-tab heading="Base data">
                <fieldset>
                    <legend>Base data</legend>
                    <div class="form-group ng-class:form_error('identifier')">
                        <label class="control-label col-sm-3 requiredField">
                            Identifier<span class="asteriskField">*</span>
                        </label>
                        <div class="controls col-sm-7">
                            <input class="textinput textInput form-control" maxlength="255" name="identifier" ng-model="edit_obj.identifier" placeholder="Identifier" required="True" type="text"/>
                        </div>
                    </div>
                    <div class="form-group  ng-class:form_error('network')">
                        <label class="control-label col-sm-3 requiredField">
                            Network<span class="asteriskField">*</span>
                        </label>
                        <div class="controls col-sm-7">
                            <input class="textinput textInput form-control" name="network" ng-blur="config_service.network_or_netmask_blur(edit_obj)" ng-model="edit_obj.network" ng-pattern="/^\d+\.\d+\.\d+\.\d+$/" placeholder="Network" required="True" type="text"/>
                        </div>
                    </div>
                    <div class="form-group  ng-class:form_error('netmask')">
                        <label class="control-label col-sm-3 requiredField">
                            Netmask<span class="asteriskField">*</span>
                        </label>
                        <div class="controls col-sm-7">
                            <input class="textinput textInput form-control" name="netmask" ng-blur="config_service.network_or_netmask_blur(edit_obj)" ng-model="edit_obj.netmask" ng-pattern="/^\d+\.\d+\.\d+\.\d+$/" placeholder="Netmask" required="True" type="text"/>
                        </div>
                    </div>
                    <div class="form-group  ng-class:form_error('broadcast')">
                        <label class="control-label col-sm-3 requiredField">
                            Broadcast<span class="asteriskField">*</span>
                        </label>
                        <div class="controls col-sm-7">
                            <input class="textinput textInput form-control" name="broadcast" ng-model="edit_obj.broadcast" ng-pattern="/^\d+\.\d+\.\d+\.\d+$/" placeholder="Broadcast" required="True" type="text"/>
                        </div>
                    </div>
                    <div class="form-group  ng-class:form_error('gateway')">
                        <label class="control-label col-sm-3 requiredField">
                            Gateway<span class="asteriskField">*</span>
                        </label>
                        <div class="controls col-sm-7">
                            <input class="textinput textInput form-control" name="gateway" ng-model="edit_obj.gateway" ng-pattern="/^\d+\.\d+\.\d+\.\d+$/" placeholder="Gateway" required="True" type="text"/>
                        </div>
                    </div>
                </fieldset>
                <fieldset>
                    <legend>Network type (master / slave)</legend>
                    <div class="form-group">
                        <label class="control-label col-sm-3 requiredField">
                            Network type<span class="asteriskField">*</span>
                        </label>
                        <div class="controls col-sm-7">
                            <ui-select ng-model="edit_obj.network_type" style="max-width:400px; min-width:240px;" ng-disabled="config_service.has_master_network(edit_obj)">
                                <ui-select-match class="ui-select-match" placeholder="network type">{{$select.selected.description}}</ui-select-match>
                                <ui-select-choices class="ui-select-choices" repeat="value.idx as value in config_service.nw_tree().nw_type_list | props_filter:{description:$select.search}">
                                    <div ng-bind-html="value.description | highlight: $select.search"></div>
                                </ui-select-choices>
                            </ui-select>
                        </div>
                    </div>
                    <div class="form-group" ng_show="config_service.is_slave_network(edit_obj.network_type)">
                        <label class="control-label col-sm-3">
                            Master network
                        </label>
                        <div class="controls col-sm-7">
                            <div class="input-group" style="max-width:400px; min-width:240px;">
                                <ui-select ng-model="edit_obj.master_network" ng-disabled="false">
                                    <ui-select-match class="ui-select-match" placeholder="master network">{{$select.selected.identifier}}
                                    </ui-select-match>
                                    <ui-select-choices class="ui-select-choices" repeat="value.idx as value in config_service.get_production_networks()| props_filter:{identifier:$select.search}">
                                        <div ng-bind-html="value.identifier | highlight: $select.search"></div>
                                    </ui-select-choices>
                                </ui-select>
                                <span class="input-group-btn">
                                    <button type="button" ng-click="edit_obj.master_network = null" class="btn btn-default">
                                        <span class="glyphicon glyphicon-trash"></span>
                                    </button>
                                </span>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </uib-tab>
            <uib-tab heading="Flags / Range">
                <fieldset>
                    <legend>Flags and priority</legend>
                    <div class="form-group">
                        <div class="checkbox">
                            <div class="controls col-lg-offset-0 col-sm-7">
                                <label>
                                    <input class="checkboxinput checkbox" ng-model="edit_obj.enforce_unique_ips" type="checkbox"/>
                                    Enforce unique ips
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-3">
                            Gw pri
                        </label>
                        <div class="controls col-sm-7">
                            <input class="numberinput form-control" name="gw_pri" ng-model="edit_obj.gw_pri" type="number" value="1"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-3">
                            Preferred domain tree node
                        </label>
                        <div class="controls col-sm-7">
                            <div class="input-group" style="max-width:400px; min-width:240px;">
                                <ui-select ng-model="edit_obj.preferred_domain_tree_node">
                                    <ui-select-match class="ui-select-match" placeholder="preferred DTN">{{ $select.selected.full_name }}</ui-select-match>
                                    <ui-select-choices
                                        repeat="value.idx as value in config_service.domain_tree().list | props_filter:{full_name:$select.search}"
                                    >
                                        <div ng-bind-html="value.full_name | highlight: $select.search"></div>
                                    </ui-select-choices>
                                </ui-select>
                                <span class="input-group-btn">
                                    <button type="button" ng-click="edit_obj.preferred_domain_tree_node = undefined" class="btn btn-default">
                                        <span class="glyphicon glyphicon-trash"></span>
                                    </button>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-3">
                            Network device type
                        </label>
                        <div class="controls col-sm-7">
                            <ui-select multiple="multiple" ng-model="edit_obj.network_device_type" style="max-width:400px; min-width:240px;" ng-disabled="false">
                                <ui-select-match class="ui-select-match" placeholder="network device types">{{$item.identifier}}</ui-select-match>
                                <ui-select-choices class="ui-select-choices" repeat="value.idx as value in config_service.nw_tree().nw_device_type_list | props_filter:{identifier:$select.search}">
                                    <div ng-bind-html="value.identifier | highlight: $select.search"></div>
                                </ui-select-choices>
                            </ui-select>
                        </div>
                    </div>
                </fieldset>
                <fieldset>
                    <legend>Range</legend>
                    <div class="form-group ng-class:form_error('start_range')">
                        <label class="control-label col-sm-3 requiredField">
                            Range Start (incl.)
                        </label>
                        <div class="controls col-sm-7">
                            <div class="input-group">
                                <input class="textinput textInput form-control" ng-focus="config_service.enter_range(edit_obj)" ng-blur="config_service.range_check(edit_obj)" ng-model="edit_obj.start_range" ng-pattern="/^\d+\.\d+\.\d+\.\d+$/" placeholder="Range start"  type="text"/>
                                <span class="input-group-btn">
                                    <button type="button" ng-click="config_service.clear_range(edit_obj)" class="btn btn-default">
                                        <span class="glyphicon glyphicon-trash"></span>
                                    </button>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group ng-class:form_error('end_range')">
                        <label class="control-label col-sm-3 requiredField">
                            Range End (incl.)
                        </label>
                        <div class="controls col-sm-7">
                            <div class="input-group">
                                <input class="textinput textInput form-control" ng-focus="config_service.enter_range(edit_obj)" ng-blur="config_service.range_check(edit_obj)" ng-model="edit_obj.end_range" ng-pattern="/^\d+\.\d+\.\d+\.\d+$/" placeholder="Range end" type="text"/>
                                <span class="input-group-btn">
                                    <button type="button" ng-click="config_service.clear_range(edit_obj)" class="btn btn-default">
                                        <span class="glyphicon glyphicon-trash"></span>
                                    </button>
                                </span>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </uib-tab>
        </uib-tabset>
    </form>
</script>

<script type="text/ng-template" id="network.type.form">
    <form id="form" class="form-horizontal" name="form_data">
        <fieldset>
            <legend>Base data</legend>
            <div class="form-group  ng-class:form_error('description')">
                <label class="control-label col-sm-3 requiredField">
                    Description<span class="asteriskField">*</span>
                </label>
                <div class="controls col-sm-7">
                    <input class="textinput textInput form-control" maxlength="192" ng-model="edit_obj.description" placeholder="Description" required="True" type="text"/>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-3 requiredField">
                    Identifier<span class="asteriskField">*</span>
                </label>
                <div class="controls col-sm-7">
                    <ui-select ng-model="edit_obj.identifier" style="max-width:400px; min-width:240px;" ng-disabled="false">
                        <ui-select-match class="ui-select-match" placeholder="network type type">{{$select.selected.name}}</ui-select-match>
                        <ui-select-choices class="ui-select-choices" repeat="value.value as value in config_service.network_types">
                            <div ng-bind-html="value.name | highlight: $select.search"></div>
                        </ui-select-choices>
                    </ui-select>
                </div>
            </div>
        </fieldset>
    </form>
</script>

<script type="text/ng-template" id="icsw.net.ip.form">
    <form class="form-horizontal" name="form_data">
        <fieldset>
            <legend>Basic settings</legend>
            <div class="form-group">
                <label class="control-label col-sm-4 requiredField">
                    Netdevice<span class="asteriskField">*</span>
                </label>
                <div class="controls col-sm-8">
                    <ui-select ng-model="edit_obj.netdevice" style="max-width:400px; min-width:240px;" ng-disabled="!create_mode">-->
                        <ui-select-match class="ui-select-match" placeholder="netdevice">{{$select.selected.devname}}</ui-select-match>
                        <ui-select-choices class="ui-select-choices" repeat="value.idx as value in device.netdevice_set">
                            <div ng-bind-html="value.devname | highlight: $select.search"></div>
                        </ui-select-choices>
                    </ui-select>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-4 requiredField">
                    Network<span class="asteriskField">*</span>
                </label>
                <div class="controls col-sm-8">
                    <ui-select ng-model="edit_obj.network" ng-change="network_changed(edit_obj)" style="max-width:400px; min-width:240px;" ng-disabled="false">
                        <ui-select-match class="ui-select-match" placeholder="network">{{$select.selected.info_string}}</ui-select-match>
                        <ui-select-choices class="ui-select-choices" repeat="value.idx as value in network_tree.nw_list | props_filter:{info_string:$select.search}" position="down">
                            <div ng-bind-html="value.info_string | highlight: $select.search"></div>
                        </ui-select-choices>
                    </ui-select>
                </div>
            </div>
            <div class="form-group  ng-class:form_error('devname')">
                <label class="control-label col-sm-4 requiredField">
                    IP<span class="asteriskField">*</span>
                </label>
                <div class="controls col-sm-8">
                    <div class="input-group" style="max-width:400px; min-width:240px;">
                        <input class="textinput textInput form-control" maxlength="16" name="ip" ng-model="edit_obj.ip" placeholder="IP address" required="True" type="text"/>
                        <icsw-tools-button type="create" value="Get free IP" size="sm" ng-click="get_free_ip(edit_obj)"></icsw-tools-button>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-4 requiredField">
                    Domain tree node<span class="asteriskField">*</span>
                </label>
                <div class="controls col-sm-8">
                    <ui-select ng-model="edit_obj.domain_tree_node" style="max-width:400px; min-width:240px;" ng-disabled="false">
                        <ui-select-match class="ui-select-match" placeholder="Domain tree node">{{$select.selected.tree_info}}</ui-select-match>
                        <ui-select-choices class="ui-select-choices" repeat="value.idx as value in domain_tree.list | props_filter:{tree_info:$select.search}">
                            <div ng-bind-html="value.tree_info | highlight: $select.search"></div>
                        </ui-select-choices>
                    </ui-select>
                </div>
            </div>
        </fieldset>
        <fieldset>
            <legend>Alias settings (will be written without node postfixes)</legend>
            <div class="form-group">
                <label class="control-label col-sm-4">
                    Alias
                </label>
                <div class="controls col-sm-8">
                    <input class="textinput textInput form-control" maxlength="765" name="alias" ng-model="edit_obj.alias" type="text"/>
                </div>
            </div>
            <div class="form-group">
                <div class="checkbox">
                    <div class="controls col-sm-offset-4 col-sm-7">
                        <label>
                            <input class="checkboxinput checkbox" name="alias_excl" ng-model="edit_obj.alias_excl" type="checkbox"/>
                            Alias is exclusive
                        </label>
                    </div>
                </div>
            </div>
        </fieldset>
    </form>
</script>

<script type="text/ng-template" id="icsw.peer.form">
    <form class="form-horizontal" name="form_data">
        <h2>
            Network topology connection (peer)
        </h2>
        <fieldset>
            <legend>Settings</legend>
            <div class="form-group">
                <label class="control-label col-sm-2 requiredField">
                    Cost<span class="asteriskField">*</span>
                </label>
                <div class="controls col-sm-9">
                    <input class="numberinput form-control" max="128" min="1" name="penalty" ng-model="edit_obj.penalty" required="True" type="number" value="0"/>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-2">
                    Source
                </label>

                <div class="col-sm-9">
                    <ui-select ng-model="edit_obj.s_netdevice">
                        <ui-select-match class="ui-select-match" placeholder="select a netdevice">
                            {{ $select.selected.info_string }}
                        </ui-select-match>
                        <ui-select-choices class="ui-select-choices" repeat="value.idx as value in source_helper.list | props_filter:{info_string:$select.search}" group-by="'device_group_name'">
                            <div ng-bind-html="value.info_string | highlight: $select.search"></div>
                        </ui-select-choices>
                    </ui-select>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-2">
                    Destination
                </label>
                <div class="col-sm-9">
                    <ui-select ng-model="edit_obj.d_netdevice">
                        <ui-select-match class="ui-select-match" placeholder="select a target device">
                            {{$select.selected.info_string}}
                        </ui-select-match>
                        <ui-select-choices class="ui-select-choices" repeat="value.idx as value in dest_helper.list | props_filter:{info_string:$select.search}" group-by="'device_group_name'">
                            <div ng-bind-html="value.info_string | highlight: $select.search"></div>
                        </ui-select-choices>
                    </ui-select>
                </div>
            </div>
            <div id="div_id_s_spec" class="form-group">
                <label for="id_s_spec" class="control-label col-sm-2">
                    Source spec
                </label>
                <div class="controls col-sm-9">
                    <input class="textinput textInput form-control" maxlength="128" name="s_spec" ng-model="edit_obj.s_spec" type="text"/>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-2">
                    Dest spec
                </label>
                <div class="controls col-sm-9">
                    <input class="textinput textInput form-control" maxlength="128" name="d_spec" ng-model="edit_obj.d_spec" type="text"/>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-2">
                    Info
                </label>
                <div class="controls col-sm-9">
                    <input class="textinput textInput form-control" maxlength="256" name="info" ng-model="edit_obj.info" type="text"/>
                </div>
            </div>
            <div class="form-group" ng-if="!create_mode">
                <label class="control-label col-sm-2">
                    Creation info
                </label>
                <div class="col-sm-9">
                    <span ng-show="edit_obj.autocreated" class="label label-warning">autocreated</span>
                    <span ng-show="!edit_obj.autocreated" class="label label-success">manually created</span>
                </div>
            </div>
        </fieldset>
    </form>
</script>

<script type="text/ng-template" id="device.network.scan.form">
    <form id="form" class="form-horizontal" ng-submit="cur_edit.modify(this)" name="form">
        <h2>Scan network of settings
            device {{ _current_dev.full_name }}</h2>
        <fieldset>
            <legend>Scan address, {{ _current_dev.ip_list.length }} non-local IPs defined</legend>
            <div>
                <ul class="list-group">
                    <li class="list-group-item" ng-repeat="name in _edit_obj.network_type_names">
                        {{ name }}:
                        <input ng-repeat="ip in _edit_obj.ip_dict[name]" type="button" class="btn btn-sm btn-primary" value="{{ ip }}" ng-click="_edit_obj.manual_address=ip"></input>
                    </li>
                    <li class="list-group-item">
                        IP: <input ng-model="_edit_obj.manual_address"></input>
                    </li>
                </ul>
            </div>
        </fieldset>
        <uib-tabset>
            <uib-tab heading="BaseScan" select='set_scan_mode("base")' active="_current_dev.scan_base_active"></uib-tab>
            <uib-tab ng-show='has_com_capability(_edit_obj, "hm")' heading="Hostmonitor" select='set_scan_mode("hm")' active="_current_dev.scan_hm_active">
                <fieldset>
                    <legend>Flags</legend>
                    <div class="form-group">
                        <div id="div_id_strict_mode" class="checkbox">
                            <div class="controls col-lg-offset-0 col-sm-7"><label for="id_strict_mode"><input class="checkboxinput checkbox" id="id_strict_mode" name="strict_mode" ng-model="_edit_obj.strict_mode" type="checkbox"></input>
                                all netdevices must be recognizable and all existing peers must be conserverd
                            </label></div>
                        </div>
                    </div>
                    <div class="form-group checkbox">
                        <div class="controls col-lg-offset-0 col-sm-7">
                            <label>
                                <input class="checkboxinput checkbox" ng-model="_edit_obj.modify_peering" type="checkbox"/>
                                Modify peering (dangerous)
                            </label>
                        </div>
                    </div>
                    <div class="alert alert-danger" ng-show="!_edit_obj.strict_mode && _edit_obj.modify_peering">attention: peers might get lost
                    </div>
                </fieldset>
            </uib-tab>
            <uib-tab ng-show='has_com_capability(_edit_obj, "snmp")' heading="SNMP" select='set_scan_mode("snmp")' active="_current_dev.scan_snmp_active">
                <fieldset>
                    <legend>SNMP Scan Settings</legend>
                    <div id="div_id_snmp_community" class="form-group">
                        <label for="id_snmp_community" class="control-label col-sm-3 requiredField">
                            SNMP community<span class="asteriskField">*</span>
                        </label>
                        <div class="controls col-sm-7"><input class="textinput textInput form-control" id="id_snmp_community" maxlength="128" name="snmp_community" ng-model="_edit_obj.snmp_community" required="True" type="text"></input></div>
                    </div>
                    <div id="div_id_snmp_version" class="form-group">
                        <label for="id_snmp_version" class="control-label col-sm-3 requiredField">
                            SNMP version<span class="asteriskField">*</span>
                        </label>
                        <div class="controls col-sm-7"><select class="select form-control" id="id_snmp_version" name="snmp_version" ng-model="_edit_obj.snmp_version" required="True">
                            <option value="1">1</option>
                            <option value="2c">2c</option>
                        </select></div>
                    </div>
                </fieldset>
                <fieldset>
                    <legend>Flags</legend>
                    <div class="form-group">
                        <div id="div_id_remove_not_found" class="checkbox">
                            <div class="controls col-lg-offset-0 col-sm-7">
                                <label for="id_remove_not_found">
                                    <input class="checkboxinput checkbox" id="id_remove_not_found" name="remove_not_found" ng-model="_edit_obj.remove_not_found" type="checkbox"/>
                                    Remove not found
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group checkbox">
                        <div class="controls col-lg-offset-0 col-sm-7">
                            <label>
                                <input class="checkboxinput checkbox" ng-model="_edit_obj.modify_peering" type="checkbox"/>
                                Modify peering (dangerous)
                            </label>
                        </div>
                    </div>
                </fieldset>
            </uib-tab>
            <uib-tab ng-show='has_com_capability(_edit_obj, "wmi")' heading="WMI" select='set_scan_mode("wmi")' active="_current_dev.scan_wmi_active">
                <fieldset>
                    <legend>WMI Scan Settings</legend>
                    <div id="div_id_wmi_username" class="form-group">
                        <label for="id_wmi_username" class="control-label col-sm-3">
                            Username
                        </label>
                        <div class="controls col-sm-7"><input class="textinput textInput form-control" id="id_wmi_username" maxlength="256" name="wmi_username" ng-model="_edit_obj.wmi_username" type="text"></input></div>
                    </div>
                    <div id="div_id_wmi_password" class="form-group">
                        <label for="id_wmi_password" class="control-label col-sm-3">
                            Password
                        </label>
                        <div class="controls col-sm-7"><input class="textinput textInput form-control" id="id_wmi_password" maxlength="256" name="wmi_password" ng-model="_edit_obj.wmi_password" type="password"></input></div>
                    </div>
                    <div class="form-group checkbox">
                        <div class="controls col-lg-offset-0 col-sm-7">
                            <label>
                                <input class="checkboxinput checkbox" ng-model="_edit_obj.wmi_discard_disabled_interfaces" type="checkbox"/>
                                Ignore disabled interfaces
                            </label>
                        </div>
                    </div>
                    <div class="form-group checkbox">
                        <div class="controls col-lg-offset-0 col-sm-7">
                            <label>
                                <input class="checkboxinput checkbox" ng-model="_edit_obj.modify_peering" type="checkbox"/>
                                Modify peering (dangerous)
                            </label>
                        </div>
                    </div>
                </fieldset>
            </uib-tab>
        </uib-tabset>
        <uib-alert type="warning" ng-show="!_current_dev.manual_address">Please enter or select an IP address</uib-alert>
        <div class="form-actions">
            <input type="button" name="scan" value="scan" class="btn btn btn-sm btn-primary" id="button-id-scan" ng-click="fetch_device_network()" ng-disabled="!_current_dev.manual_address"></input> <input type="submit" name="cancel" value="cancel" class="btn btn-primary btn btn-sm btn-warning" id="submit-id-cancel"></input>
        </div>
    </form>
</script>
