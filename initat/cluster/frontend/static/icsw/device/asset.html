<script type="text/ng-template" id="icsw/device/asset/overview">
    <icsw-device-asset-overview icsw-sel-man="0"></icsw-device-asset-overview>
</script>


<script type="text/ng-template" id="icsw.device.asset.overview">
    <uib-alert type="warning" ng-show="!struct.data_loaded">Fetching data from server ...</uib-alert>

    <div ng-if="struct.data_loaded">
        <h3>Asset Overview</h3>

        <uib-tabset>
            <uib-tab>
                <uib-tab-heading>
                    <span ng-show="$root.assets.length">Known Packages ({{ $root.assets_sf.length }})</span>
                    <span ng-show="!$root.assets.length">No known packages</span>
                </uib-tab-heading>

                <h3 ng-if="!$root.assets.length">
                    <span>No know Packages! Start an AssetRun to populate this list</span>
                </h3>

                <table
                    class="table table-condensed table-hover table-striped"
                    style="width:auto;"
                    ng-show="$root.assets_sf.length > 0"
                    st-table="$root.assets"
                    st-safe-src="$root.assets_sf"
                >
                    <thead>
                        <tr>
                            <th st-sort="name">Name</th>
                        </tr>
                        <th colspan="3">
                            <input st-search="" class="form-control" placeholder="global search ..." type="text"/>
                        </th>
                        <tr>
                            <td colspan="99">
                                <div
                                    icsw-tools-pagination
                                    st-items-by-page="10"
                                    st-displayed-pages="11"
                                    possible-items-by-page="10,20,50,100"
                                ></div>
                            </td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat-start="package in $root.assets">
                            <td>{{ package.name }}</td>
                            <td>
                                <icsw-tools-button size="xs" type="show" is-show="package.expanded" ng-click="package.expanded = !package.expanded"></icsw-tools-button>
                            </td>
                        </tr>

                        <tr ng-repeat-end ng-if="package.expanded">
                            <td colspan="99">
                                <table
                                    class="table table-condensed table-hover table-bordered"
                                    style="width:auto;"
                                    st-safe-src="package.version"
                                    st-table="versions_shown"
                                    ng-show="package.version.length"
                                >
                                    <tr>
                                        <td colspan="99">
                                            <div
                                                icsw-tools-pagination
                                                st-items-by-page="10"
                                                st-displayed-pages="11"
                                                possible-items-by-page="10,20,50,100"
                                            ></div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>Version</th>
                                        <th>Release</th>
                                        <th>Size</th>
                                        <th></th>
                                    </tr>
                                    <tr ng-repeat="obj in versions_shown">
                                        <td>{{ obj[1] }}</td>
                                        <td>{{ obj[2] }}</td>
                                        <td>{{ obj[3] }}</td>
                                        <td><icsw-tools-button type="reload" size="xs" ng-click="select_devices(obj)" value="Select Devices"/></td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </uib-tab>
            <uib-tab ng-repeat="dev in struct.devices">
                <uib-tab-heading>
                    {{ dev.full_name }}
                </uib-tab-heading>

                <h3>
                    <span ng-show="dev.assetrun_set_sf_src.length">
                        AssetRun Overview for {{ dev.full_name }}
                    </span>
                    <span ng-show="!dev.assetrun_set_sf_src.length">
                        No AssetRuns for this device.
                    </span>
                    <span ng-show="struct.num_selected">
                        , diff ({{ struct.num_selected }} selected)
                        <icsw-tools-button ng-if="struct.num_selected == 2" type="reload" size="xs" ng-click="assetchangeset(dev)" value="Asset Changeset"/>
                    </span>
                </h3>


                <button type="button" class="btn btn-xs btn-warning" data-style="slide-left" ladda="dev.$$asset_run" ng-click="run_now($event, dev)">Run now</button>

                <table
                    class="table table-condensed table-hover table-striped"
                    style="width:auto;"
                    ng-show="dev.assetrun_set_sf_src.length > 0"
                    st-table="dev.assetrun_set"
                    st-safe-src="dev.assetrun_set_sf_src"
                    st-set-filter="strictFilter"
                >
                    <thead>
                        <tr>
                            <th st-sort="run_index">Run Index</th>
                            <th st-sort="run_type">Run Type</th>
                            <th st-sort="run_start_time">Run Start</th>
                            <th st-sort="run_end_time">Run End</th>
                            <th st-sort="assets.length">Length</th>
                            <th colspan="2">Action</th>

                        </tr>
                        <tr>
                            <th colspan="8">
                                <input st-search="" class="form-control" placeholder="global search ..." type="text"/>
                            </th>
                        </tr>
                        <tr>
                            <th colspan="1">
                            </th>
                            <th colspan="1">
                                <input st-search="run_type" placeholder="filter by run_type" class="input-sm form-control" type="search"/>
                            </th>
                            <th colspan="1">
                                <input st-search="run_start_time" placeholder="search by start_time" class="input-sm form-control" type="search"/>
                            </th>
                            <th colspan="1">
                                <input st-search="run_end_time" placeholder="search by end_time" class="input-sm form-control" type="search"/>
                            </th>
                            <th colspan="3">&nbsp;</th>
                        </tr>
                        <tr>
                            <td colspan="99">
                                <div
                                    icsw-tools-pagination
                                    st-items-by-page="10"
                                    st-displayed-pages="11"
                                    possible-items-by-page="10,20,50,100"
                                ></div>
                            </td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-class="{'success': assetrun.$$selected}" ng-repeat-start="assetrun in dev.assetrun_set">
                            <td class="text-right">{{ assetrun.run_index }}</td>
                            <td>{{ resolve_asset_type(assetrun.run_type) }}</td>
                            <td>{{ assetrun.run_start_time }}</td>
                            <td>{{ assetrun.run_end_time }}</td>
                            <td class="text-right">{{ assetrun.assets.length }}</td>
                            <td>
                                <icsw-tools-button size="xs" type="show" is-show="assetrun.expanded" ng-click="assetrun.expanded = !assetrun.expanded"></icsw-tools-button>
                            </td>
                            <td>
                                <icsw-tools-button type="modify" size="xs" value="select" ng-click="select_asset($event, dev, assetrun)"></icsw-tools-button>
                            </td>

                        </tr>
                        <tr ng-repeat-end ng-if="assetrun.expanded">
                            <td colspan="99">
                                <table
                                    class="table table-condensed table-hover table-bordered"
                                    style="width:auto;"
                                    st-safe-src="assetrun.assets"
                                    st-table="assets_shown"
                                    ng-show="assetrun.assets.length"
                                >
                                    <tr>
                                        <td colspan="99">
                                            <div
                                                icsw-tools-pagination
                                                st-items-by-page="10"
                                                st-displayed-pages="11"
                                                possible-items-by-page="10,20,50,100"
                                            ></div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>Name</th>
                                    </tr>
                                    <tr ng-repeat="asset in assets_shown track by $index">
                                        <td>{{ asset }}</td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                    </tbody>
                </table>

            </uib-tab>
        </uib-tabset>
    </div>
</script>