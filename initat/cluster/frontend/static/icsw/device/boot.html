<script type="text/ng-template" id="icsw.device.boot.table">
    <h2>
        <span class="label label-danger" ng-show="conn_problems" title="number of connection problems">{{ conn_problems }}</span> Boot config for {{ devices.length }} devices<span ng-show="num_selected">, {{ num_selected }} selected</span>{{ get_global_bootserver_info() }}
    </h2>
    <form class="form-inline">
        <div class="btn-group">
            <input ng-repeat="entry in boot_options" type="button" ng-class="get_bo_class(entry[0])" value="{{ entry[1] }}" ng-click="toggle_bo(entry[0])"/>
        </div>
        <input class="form-control" ng-model="device_sel_filter" placeholder="selection..." ng-change="change_sel_filter()"/>
    </form>
    <table ng-show="devices.length" class="table table-condensed table-hover" style="width:auto;">
        <thead>
            <tr>
                <th>Group</th>
                <th>Device</th>
                <th class="center">sel</th>
                <th>state</th>
                <th>network</th>
                <th ng-repeat="entry in boot_options" ng-show="bo_enabled[entry[0]] && entry[2] < 3">
                    {{ entry[1] }}
                </th>
                <th ng-show="any_type_1_selected">
                    action
                </th>
                <th ng-show="any_type_3_selected">
                    log
                </th>
            </tr>
        </thead>
        <tbody>
            <tr icsw-device-boot-row ng-repeat-start="dev in devices" ng-class="get_row_class(dev)"></tr>
            <tr ng-repeat-end ng-show="bo_enabled['l'] && dev.show_log">
                <td colspan="100">
                    <icsw-device-boot-log-table></icsw-device-boot-log-table>
                </td>
            </tr>
        </tbody>
        <tfoot ng-show="devices.length > 1">
            <tr>
                <td colspan="2">Global actions</td>
                <td>
                    <div class="btn-group btn-group-xs">
                        <input type="button" class="btn btn-success" value="S" ng-click="toggle_gdev_sel(1)" title="select all devices"/>
                        <input type="button" class="btn btn-primary" value="T" ng-click="toggle_gdev_sel(0)" title="toggle device selection"/>
                        <input type="button" class="btn btn-warning" value="C" ng-click="toggle_gdev_sel(-1)" title="clear device selection"/>
                    </div>
                </td>
                <td></td>
                <td></td>
                <td ng-repeat="entry in type_1_options()" ng-show="bo_enabled[entry[0]]"></td>
                <td ng-show="bo_enabled['s']">
                    <div class="btn-group" ng-show="num_selected">
                        <button type="button" class="btn btn-warning btn-xs dropdown-toggle" data-toggle="dropdown">
                            action ({{ num_selected }})<span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu">
                            <li ng-click="soft_control('', 'reboot')"><a href="#">reboot</a></li>
                            <li ng-click="soft_control('', 'halt')"><a href="#">halt</a></li>
                            <li ng-click="soft_control('', 'poweroff')"><a href="#">poweroff</a></li>
                        </ul>
                    </div>
                </td>
                <td ng-show="bo_enabled['h']">
                    <div class="btn-group" ng-show="num_selected_hc()">
                        <button type="button" class="btn btn-xs btn-warning" data-toggle="dropdown">
                            control ({{ num_selected_hc() }}) <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu">
                            <li ng-click="hard_control('', 'cycle')"><a href="#">cycle</a></li>
                            <li ng-click="hard_control('', 'on')"><a href="#">on</a></li>
                            <li ng-click="hard_control('', 'off')"><a href="#">off</a></li>
                        </ul>
                    </div>
                </td>
                <td>
                    <icsw-tools-button type="modify" size="xs" ng-show="num_selected && any_type_1_selected" value="modify many" ng-click="modify_many($event)"></icsw-tools-button>
                </td>
            </tr>
        </tfoot>
    </table>
    <form class="form-inline">
        <icsw-tools-button type="display" size="sm" value="macbootlog" ng-click="toggle_show_mbl()"></icsw-tools-button>
    </form>
    <div ng-show="show_mbl">
        <div class="row">
            <div class="col-md-6">
                <h4>Showing {{ mbl_entries.length }} Macbootlog entries</h4>
                <table class="table table-condensed table-hover table-striped" style="width:auto;">
                    <thead>
                        <tr>
                            <th>Device</th>
                            <th>type</th>
                            <th>IP</th>
                            <th>MAC</th>
                            <th>Ignored</th>
                            <th>Logsource</th>
                            <th>created</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="mbl in mbl_entries" ng-class="{true: 'warning', false: ''}[mbl.ignore]">
                            <td>{{ mbl.device_name }}</td>
                            <td>{{ mbl.entry_type }}</td>
                            <td>{{ mbl.ip_action }}</td>
                            <td>{{ mbl.macaddr }}</td>
                            <td>{{ get_mac_ignored(mbl) }}</td>
                            <td style="white-space:nowrap;">{{ mbl.log_source | follow_fk:this:'log_source_lut':'name' }}</td>
                            <td>{{ get_mbl_created(mbl) }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="col-md-6">
                <h4>Showing {{ mbi_list.length }} unique MACaddresses</h4>
                <table class="table table-condensed table-hover table-striped" style="width:auto;">
                    <thead>
                        <tr>
                            <th>MAC</th>
                            <th>ignored</th>
                            <th>usecount</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="mbl in mbi_list" ng-class="{true: 'warning', false: ''}[mbl.ignore]">
                            <td>{{ mbl.macaddr }}</td>
                            <td>{{ mbl.ignore && 'yes' || 'no' }}</td>
                            <td>{{ mbl.usecount }}</td>
                            <td>
                                <span ng-if="!mbl.ignore">
                                    <icsw-tools-button type="delete" size="xs" value="Ignore Macaddr" ng-click="modify_mbl(mbl, 'ignore')"></icsw-tools-button>
                                </span>
                                <span ng-if="mbl.ignore">
                                    <icsw-tools-button type="create" size="xs" value="Unignore Macaddr" ng-click="modify_mbl(mbl, 'unignore')"></icsw-tools-button>
                                </span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</script>


<script type="text/ng-template" id="icsw.device.boot.row">
    <td>{{ dev.device_group_name }}</td>
    <td ng-class="get_device_name_class(dev)">{{ dev.full_name }}{{ get_bootserver_info(dev) }}</td>
    <td class="center"><input type="button" ng-class="get_dev_sel_class(dev)" ng-click="toggle_dev_sel(dev, 0)" value="sel"></button></td>
    <td ng-class="dev.recvreq_state">{{ dev.recvreq_str }}</td>
    <td ng-class="dev.network_state">{{ dev.network }}</td>
    <td ng-repeat="entry in type_1_options()" ng-show="bo_enabled[entry[0]]" ng-class="get_td_class(entry)" ng-bind-html="show_boot_option(entry)">
    </td>
    <td ng-show="bo_enabled['s']">
        <div class="btn-group" ng-show="valid_net_state()">
            <button type="button" class="btn btn-warning btn-xs dropdown-toggle" data-toggle="dropdown">
                action <span class="caret"></span>
            </button>
            <ul class="dropdown-menu">
                <li ng-click="soft_control(dev, 'reboot')"><a href="#">reboot</a></li>
                <li ng-click="soft_control(dev, 'halt')"><a href="#">halt</a></li>
                <li ng-click="soft_control(dev, 'poweroff')"><a href="#">poweroff</a></li>
            </ul>
        </div>
        <span class='label label-danger' ng-show="!valid_net_state()"><span class='glyphicon glyphicon-ban-circle'></span></span>
    </td>
    <td ng-show="bo_enabled['h']">
        <div class="btn-group" ng-repeat="cd_con in dev.slave_connections">
            <button type="button" ng-class="get_hc_class(cd_con)" ng-disabled="get_hc_disabled(cd_con)" data-toggle="dropdown">
                {{ get_hc_info(cd_con) }} <span class="caret"></span>
            </button>
            <ul class="dropdown-menu">
                <li ng-click="hard_control(cd_con, 'cycle')"><a href="#">cycle</a></li>
                <li ng-click="hard_control(cd_con, 'on')"><a href="#">on</a></li>
                <li ng-click="hard_control(cd_con, 'off')"><a href="#">off</a></li>
            </ul>
            <span ng-show="!$last">,</span>
        </div>
        <span ng-show="!dev.slave_connections">
            waiting...
        </span>
        <span ng-show="dev.slave_connections && dev.slave_connections.length == 0">
            ---
        </span>
    </td>
    <td ng-show="any_type_1_selected">
        <icsw-tools-button type="modify" size="xs" ng-click="modify_device(dev, $event)"></icsw-tools-button>
    </td>
    <td ng-show="any_type_3_selected">
        <input type="button" ng-class="get_devlog_class(dev)" ng-value="get_devlog_value(dev)" ng-click="change_devlog_flag(dev)"/>
    </td>
</script>

<script type="text/ng-template" id="icsw.device.boot.log.table">
    <table ng-show="devices.length" class="table table-condensed table-hover table-striped" style="width:auto;">
        <tr>
            <th>Source</th>
            <th>User</th>
            <th>Status</th>
            <th>
                <form class="form-inline">
                    Number of log lines: {{ dev.num_logs }}, show
                    <select ng-model="num_show" class="form-control input-sm" ng-options="value as value for value in [5, 20, 50, 100]">
                    </select>
                </form>
            </th>
            <th>when</th>
        </tr>
        <tr ng-repeat="line in get_log_lines()">
            <td style="white-space:nowrap;">{{ line[2] | follow_fk:this:'log_source_lut':'name' }}</td>
            <td style="white-space:nowrap;">{{ line[3] | follow_fk:this:'user_lut':'login':'---' }}</td>
            <td style="white-space:nowrap;">{{ line[4] | follow_fk:this:'log_level_lut':'name' }}</td>
            <td>{{ line[5] }}</td>
            <td style="white-space:nowrap;">{{ get_date(line[6]) }}</td>
        </tr>
    </table>
</script>
