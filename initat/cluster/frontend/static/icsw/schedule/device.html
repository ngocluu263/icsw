
<script type="text/ng-template" id="icsw.schedule.overview">
    <uib-alert type="warning" ng-show="struct.loading">Fetching data from server...</uib-alert>
    <h3>
        Dispatch settings ({{ struct.dispatch_tree.list.length }} entries)
        <icsw-tools-button type="create" size="xs" ng-click="create_or_edit($event, null, true)"></icsw-tools-button>
    </h3>
    <table
        st-table="entries_displayed"
        st-safe-src="struct.dispatch_tree.list"
        class="table table-condensed table-hover"
        style="width:auto;"
        ng-if="struct.dispatch_tree.list.length"
    >
        <thead>
            <tr>
                <td colspan="99" class="form-inline">
                    <icsw-tools-pagination st-items-by-page="10" st-displayed-pages="11"
                         possible-items-by-page="10,20,50,100,200,500,1000"></icsw-tools-pagination>
                    <input st-search="" class="form-control" placeholder="filter ..." type="text"/>
                </td>
            </tr>
            <tr>
                <th st-sort="name" st-sort-default="true">Name</th>
                <th st-sort="description">Description</th>
                <th>Created</th>
                <th>ComCaps</th>
                <th>Schedule</th>
                <th>Startoffset</th>
                <th colspan="1" class="text-center">Action</th>
            </tr>
        </thead>
        <tbody>
            <tr ng-repeat="obj in entries_displayed">
                <td>{{ obj.name }}</td>
                <td>{{ obj.description }}</td>
                <td class="text-center">
                    <span ng-show="obj.is_system" class="label label-success">system</span>
                    <span ng-show="!obj.is_system">{{ struct.user_group_tree.user_lut[obj.user].login }}</span>
                </td>
                <td>
                    {{ obj.$$com_caps }}
                </td>
                <td>
                    {{ obj.mult }} {{ struct.dispatch_tree.schedule_lut[obj.run_schedule].name }}
                </td>
                <td class="text-right">
                    {{ obj.$$start_offset }}
                </td>
                <td>
                    <icsw-tools-button ng-if="!obj.is_system" type="modify" size="xs" ng-click="create_or_edit($event, obj, false)"></icsw-tools-button>
                    <icsw-tools-button ng-if="!obj.is_system" type="delete" size="xs" ng-click="delete($event, obj)"></icsw-tools-button>
                </td>
            </tr>
        </tbody>
    </table>

</script>

<script type="text/ng-template" id="icsw.schedule.dispatch.setting.form">
    <form class="form-horizontal" name="form_data">
        <fieldset>
            <legend>Base settings</legend>
            <div class="form-group">
                <label class="control-label col-xs-3 requiredField">
                    Name<span class="asteriskField">*</span>
                </label>
                <div class="controls col-xs-7">
                    <input class="form-control" ng-model="edit_obj.name"/>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-xs-3 requiredField">
                    Description
                </label>
                <div class="controls col-xs-7">
                    <input class="form-control" ng-model="edit_obj.description"/>
                </div>
            </div>
        </fieldset>
        <fieldset>
            <legend>Schedule</legend>
            <div class="form-group">
                <label class="control-label col-sm-3 requiredField">
                    Baseline<span class="asteriskField">*</span>
                </label>
                <div class="controls col-sm-7">
                    <ui-select ng-model="edit_obj.run_schedule" style="max-width:400px; min-width:240px;">
                        <ui-select-match class="ui-select-match" placeholder="please select a baseline">
                            {{ $select.selected.name }}
                        </ui-select-match>
                        <ui-select-choices class="ui-select-choices" repeat="value.idx as value in dispatch_tree.schedule_list | props_filter:{name:$select.search}">
                            <div ng-bind-html="value.name | highlight: $select.search"></div>
                        </ui-select-choices>
                    </ui-select>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-3">
                    Multiplicator
                </label>
                <div class="controls col-sm-7">
                    <input class="form-control" type="number" min="1" max="365" ng-model="edit_obj.mult"/>
                </div>
            </div>
        </fieldset>
        <fieldset>
            <legend>ComCapabilities</legend>
            <div class="form-group">
                <label class="control-label col-sm-3">
                    ComCaps
                </label>
                <div class="controls col-sm-7">
                    <ui-select multiple="multiple" ng-model="edit_obj.com_capabilities" style="max-width:400px; min-width:240px;">
                        <ui-select-match class="ui-select-match" placeholder="Select ComCapabilities">
                            {{ $item.name }}
                        </ui-select-match>
                        <ui-select-choices class="ui-select-choices" repeat="value.idx as value in com_cap_tree.list | props_filter:{name:$select.search}">
                            <div ng-bind-html="value.name | highlight: $select.search"></div>
                        </ui-select-choices>
                    </ui-select>
                </div>
            </div>
        </fieldset>
        <fieldset>
            <legend>Start parameters</legend>
            <div class="form-group" ng-show="dispatch_tree.schedule_lut[edit_obj.run_schedule].$$filter_second">
                <label class="control-label col-xs-3 requiredField">
                    Startsecond
                </label>
                <div class="controls col-xs-7">
                    <input class="form-control" ng-model="edit_obj.sched_start_second"/>
                </div>
            </div>
            <div class="form-group" ng-show="dispatch_tree.schedule_lut[edit_obj.run_schedule].$$filter_minute">
                <label class="control-label col-xs-3 requiredField">
                    Startminute
                </label>
                <div class="controls col-xs-7">
                    <input class="form-control" ng-model="edit_obj.sched_start_minute"/>
                </div>
            </div>
            <div class="form-group" ng-show="dispatch_tree.schedule_lut[edit_obj.run_schedule].$$filter_hour">
                <label class="control-label col-xs-3 requiredField">
                    Starthour
                </label>
                <div class="controls col-xs-7">
                    <input class="form-control" ng-model="edit_obj.sched_start_hour"/>
                </div>
            </div>
            <div class="form-group" ng-show="dispatch_tree.schedule_lut[edit_obj.run_schedule].$$filter_day">
                <label class="control-label col-xs-3 requiredField">
                    Startday
                </label>
                <div class="controls col-xs-7">
                    <input class="form-control" ng-model="edit_obj.sched_start_day"/>
                </div>
            </div>
            <div class="form-group" ng-show="dispatch_tree.schedule_lut[edit_obj.run_schedule].$$filter_week">
                <label class="control-label col-xs-3 requiredField">
                    Startweek
                </label>
                <div class="controls col-xs-7">
                    <input class="form-control" ng-model="edit_obj.sched_start_week"/>
                </div>
            </div>
            <div class="form-group" ng-show="dispatch_tree.schedule_lut[edit_obj.run_schedule].$$filter_month">
                <label class="control-label col-xs-3 requiredField">
                    Startmonth
                </label>
                <div class="controls col-xs-7">
                    <input class="form-control" ng-model="edit_obj.sched_start_month"/>
                </div>
            </div>

        </fieldset>
    </form>
</script>

<script type="text/ng-template" id="icsw.schedule.device">

    <uib-alert type="warning" ng-show="struct.loading">Fetching data from server...</uib-alert>
    <h3>
        Device schedules ({{ struct.devices.length }} entries)
        <icsw-tools-button type="modify" size="xs" ng-click="edit($event, null)" value="modify selected"></icsw-tools-button>
        <span class="text-warning" ng-show="struct.updating">Updating...</span>
    </h3>
    <table
        st-table="entries_displayed"
        st-safe-src="struct.devices"
        class="table table-condensed table-hover"
        style="width:auto;"
        ng-if="struct.devices.length"
    >
        <thead>
            <tr>
                <td colspan="99" class="form-inline">
                    <icsw-tools-pagination
                        st-items-by-page="10"
                        st-displayed-pages="11"
                        possible-items-by-page="10,20,50,100,200,500,1000"
                    ></icsw-tools-pagination>
                    <input st-search="" class="form-control" placeholder="filter ..." type="text"/>
                </td>
            </tr>
            <tr>
                <th st-sort="full_name" st-sort-default="true">Name</th>
                <th>Selected</th>
                <th>Dispatchers</th>
                <th colspan="2">Planned Schedules</th>
                <th>Runs</th>
                <th colspan="1" class="text-center">Action</th>
            </tr>
        </thead>
        <tbody>
            <tr
                st-select-row="obj"
                st-select-mode="multiple"
                ng-repeat="obj in entries_displayed"
                ng-class="{'success': obj.isSelected}"
            >
                <td>{{ obj.full_name }}</td>
                <td>
                    <span ng-class="{'label label-success': obj.isSelected, 'label label-default':!obj.isSelected}">sel</span>
                </td>
                <td>
                    <span ng-show="!obj.$$dispatcher_list.length">---</span>
                    <span ng-show="obj.$$dispatcher_list.length">
                        <span ng-repeat="disp in obj.$$dispatcher_list" class="label label-primary">{{ disp.name }}</span>
                    </span>
                </td>
                <td class="text-center" ng-class="{'warning': obj.$$sched_item_list.length == 0}">
                    {{ obj.$$sched_item_list.length }}
                </td>
                <td>
                    <span ng-repeat="si in obj.$$sched_item_list">
                        {{ si.$$planned_date }} ({{ si.$$source }}),
                    </span>
                </td>
                <td class="text-center" title="in the past 7 days">
                    {{ obj.past_assetrun_set.length }}
                </td>
                <td>
                    <icsw-tools-button type="modify" size="xs" ng-click="edit($event, obj)" value="modify"/>
                    <icsw-tools-button data-style="slide-left" ladda="obj.loading" type="reload" size="xs" ng-click="run_now($event, obj)" value="run_now"/>
                </td>
            </tr>
        </tbody>
    </table>
</script>

<script type="text/ng-template" id="icsw.schedule.device.form">
    <form class="form-horizontal" name="form_data">
        <fieldset>
            <legend>Dispatcher</legend>
            <div class="form-group">
                <label class="control-label col-sm-3">
                    Dispatcher
                </label>
                <div class="controls col-sm-7">
                    <ui-select multiple="multiple" ng-model="edit_obj.$$dispatchers" style="max-width:400px; min-width:240px;">
                        <ui-select-match class="ui-select-match" placeholder="Select Dispatchers">
                            {{ $item.name }}
                        </ui-select-match>
                        <ui-select-choices class="ui-select-choices" repeat="value.idx as value in dispatcher_tree.list | props_filter:{name:$select.search}">
                            <div ng-bind-html="value.name | highlight: $select.search"></div>
                        </ui-select-choices>
                    </ui-select>
                </div>
            </div>
        </fieldset>
    </form>
</script>

<script type="text/ng-template" id="icsw.static.asset.template.overview">
    <uib-alert type="warning" ng-show="struct.loading">Fetching data from server...</uib-alert>
    <h3>
        StaticAsset Templates ({{ struct.template_tree.list.length }} entries)
        <icsw-tools-button type="create" size="xs" ng-click="create_or_edit($event, null, true)"></icsw-tools-button>
    </h3>
    <table
        st-table="entries_displayed"
        st-safe-src="struct.template_tree.list"
        class="table table-condensed table-hover"
        style="width:auto;"
        ng-if="struct.template_tree.list.length"
    >
        <thead>
            <tr>
                <td colspan="99" class="form-inline">
                    <icsw-tools-pagination st-items-by-page="10" st-displayed-pages="11"
                         possible-items-by-page="10,20,50,100,200,500,1000"></icsw-tools-pagination>
                    <input st-search="" class="form-control" placeholder="filter ..." type="text"/>
                </td>
            </tr>
            <tr>
                <th st-sort="name" st-sort-default="true">Name</th>
                <th>Parent</th>
                <th st-sort="description">Description</th>
                <th>Type</th>
                <th>User</th>
                <th>Enabled</th>
                <th>#refs</th>
                <th>#Fields</th>
                <th>Created</th>
                <th colspan="3" class="text-center">Action</th>
            </tr>
        </thead>
        <tbody>
            <tr ng-repeat="obj in entries_displayed">
                <td>{{ obj.name }}</td>
                <td>
                    <span ng-show="obj.parent_template">
                        {{ struct.template_tree.lut[obj.parent_template].name }}
                    </span>
                </td>
                <td>{{ obj.description }}</td>
                <td class="text-center">
                    {{ obj.$$asset_type }}
                </td>
                <td class="text-center">
                    <span ng-show="obj.system_template" class="label label-success">system</span>
                    <span ng-show="!obj.system_template">{{ struct.user_group_tree.user_lut[obj.user].login }}</span>
                </td>
                <td class="text-center">
                    {{ obj.enabled | yesno1 }}
                </td>
                <td class="text-center">
                    {{ obj.num_refs }}
                </td>
                <td class="text-center">
                    {{ obj.$$num_fields }}
                </td>
                <td class="text-center">
                    {{ obj.$$created }}
                </td>
                <td>
                    <icsw-tools-button ng-if="!obj.system_template" type="modify" size="xs" ng-click="create_or_edit($event, obj, false)"></icsw-tools-button>
                </td><td>
                    <icsw-tools-button ng-if="!obj.system_template && !obj.num_refs" type="delete" size="xs" ng-click="delete($event, obj)"></icsw-tools-button>
                </td><td>
                    <icsw-tools-button type="copy" size="xs" ng-click="copy($event, obj)"></icsw-tools-button>
                </td>
            </tr>
        </tbody>
    </table>

</script>

<script type="text/ng-template" id="icsw.static.asset.template.form">
    <form class="form-horizontal" name="form_data">
        <fieldset>
            <legend>Base settings</legend>
            <div class="form-group">
                <label class="control-label col-xs-3 requiredField">
                    Name<span class="asteriskField">*</span>
                </label>
                <div class="controls col-xs-7">
                    <input class="form-control" ng-model="edit_obj.name"/>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-xs-3 requiredField">
                    Description
                </label>
                <div class="controls col-xs-7">
                    <input class="form-control" ng-model="edit_obj.description"/>
                </div>
            </div>
        </fieldset>
        <fieldset>
            <legend>Type</legend>
            <div class="form-group">
                <label class="control-label col-sm-3 requiredField">
                    Type<span class="asteriskField">*</span>
                </label>
                <div class="controls col-sm-7">
                    <ui-select ng-model="edit_obj.type" style="max-width:400px; min-width:240px;" ng-disabled="edit_obj.$$num_fields">
                        <ui-select-match class="ui-select-match" placeholder="please select a Type">
                            {{ $select.selected.name }}
                        </ui-select-match>
                        <ui-select-choices class="ui-select-choices" repeat="value.idx as value in asset_type_list">
                            <div ng-bind-html="value.name | highlight: $select.search"></div>
                        </ui-select-choices>
                    </ui-select>
                </div>
            </div>
        </fieldset>
        <div class="row" ng-if="!edit_obj.num_refs">
            <div class="form-group">
                <label class="col-sm-3 control-label" title="Template is enabled">
                    Enabled
                </label>
                <div class="col-sm-7 controls">
                    <icsw-tools-yes-no flag="edit_obj.enabled"></icsw-tools-yes-no>
                </div>
            </div>
        </div>
        <fieldset ng-if="!create">
            <legend>
                Fields
            </legend>
            <table class="table table-condensed table-hover table-striped" style="width:auto;">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Description</th>
                        <th>Type</th>
                        <th>Default</th>
                        <th>Optional</th>
                        <th>Consumable</th>
                        <th>Bounds</th>
                        <th>Monitor</th>
                        <th>Overview</th>
                        <th>Fixed</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="field in edit_obj.staticassettemplatefield_set">
                        <td>{{ field.name }}</td>
                        <td>{{ field.field_description }}</td>
                        <td class="text-center">{{ field.$$field_type }}</td>
                        <td>{{ field.$$default_value }}</td>
                        <td class="text-center">{{ field.optional | yesno1 }}</td>
                        <td class="text-center">{{ field.consumable | yesno1 }}</td>
                        <td class="text-center">{{ field.has_bounds | yesno1 }}</td>
                        <td class="text-center">{{ field.monitor | yesno1 }}</td>
                        <td class="text-center">{{ field.show_in_overview | yesno1 }}</td>
                        <td class="text-center">{{ field.fixed | yesno1 }}</td>
                        <td>
                            <icsw-tools-button type="modify" size="xs" ng-click="modify_or_create_field($event, edit_obj, field, false)"></icsw-tools-button>
                            <icsw-tools-button type="delete" size="xs" ng-click="delete_field($event, edit_obj, field)"></icsw-tools-button>
                        </td>
                    </tr>
                </tbody>
            </table>
            <div class="form-group row">
                <div class="controls col-xs-12">
                    <icsw-tools-button type="create" size="xs" ng-click="modify_or_create_field($event, edit_obj, null, true)"></icsw-tools-button>
                </div>
            </div>
        </fieldset>
    </form>
</script>

<script type="text/ng-template" id="icsw.static.asset.field.form">
    <form class="form-horizontal" name="form_data">
        <fieldset>
            <legend>Base settings</legend>
            <div class="form-group">
                <label class="control-label col-xs-3 requiredField">
                    Name<span class="asteriskField">*</span>
                </label>
                <div class="controls col-xs-7">
                    <input class="form-control" ng-model="edit_obj.name"/>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-xs-3 requiredField">
                    Description
                </label>
                <div class="controls col-xs-7">
                    <input class="form-control" ng-model="edit_obj.field_description"/>
                </div>
            </div>
        </fieldset>
        <fieldset>
            <legend>Type</legend>
            <div class="form-group">
                <label class="control-label col-sm-3 requiredField">
                    Type<span class="asteriskField">*</span>
                </label>
                <div class="controls col-sm-7">
                    <ui-select ng-model="edit_obj.field_type" style="max-width:400px; min-width:240px;" ng-change="field_changed()">
                        <ui-select-match class="ui-select-match" placeholder="please select a FieldType">
                            {{ $select.selected.name }}
                        </ui-select-match>
                        <ui-select-choices class="ui-select-choices" repeat="value.idx as value in field_type_list">
                            <div ng-bind-html="value.name | highlight: $select.search"></div>
                        </ui-select-choices>
                    </ui-select>
                </div>
            </div>
        </fieldset>
        <fieldset>
            <legend>Default value</legend>
            <div class="form-group" ng-show="edit_obj.field_type == 1">
                <label class="control-label col-xs-3">
                    DefaultInteger
                </label>
                <div class="controls col-xs-7">
                    <input class="form-control" type="number" ng-model="edit_obj.default_value_int"/>
                </div>
            </div>
            <div class="form-group" ng-show="edit_obj.field_type == 2">
                <label class="control-label col-xs-3">
                    DefaultString
                </label>
                <div class="controls col-xs-7">
                    <input class="form-control" type="text" ng-model="edit_obj.default_value_str"/>
                </div>
            </div>
            <div class="form-group" ng-show="edit_obj.field_type == 3">
                <label class="control-label col-xs-3">
                    DefaultDate
                </label>
                <div class="controls col-xs-7">
                    <span class="input-group">
                        <input
                            class="form-control"
                            uib-datepicker-popup="dd.MM.yyyy"
                            datepicker-options="datepicker_options.date_options"
                            type="text"
                            ng-model="edit_obj.$$default_date"
                            is-open="datepicker_options.open"
                            button-bar="button_bar"
                        />
                        <span class="input-group-btn">
                            <button type="button" class="btn btn-default" ng-click="open_picker()">
                                <i class="glyphicon glyphicon-calendar"></i>
                            </button>
                        </span>
                    </span>
                </div>
            </div>
        </fieldset>
        <div class="row">
            <div class="col-md-4">
                <div class="form-group">
                    <label class="col-sm-7 control-label" title="Field is optional">
                        Optional
                    </label>
                    <div class="col-sm-3 controls">
                        <icsw-tools-yes-no flag="edit_obj.optional" icsw-callback="field_changed"></icsw-tools-yes-no>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-7 control-label" title="Field is show in overview">
                        Show in Overview
                    </label>
                    <div class="col-sm-3 controls">
                        <icsw-tools-yes-no flag="edit_obj.show_in_overview" icsw-callback="field_changed"></icsw-tools-yes-no>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label class="col-sm-7 control-label" title="Create monitoring entry">
                        Monitor
                    </label>
                    <div class="col-sm-3 controls">
                        <icsw-tools-yes-no flag="edit_obj.monitor" icsw-callback="field_changed"></icsw-tools-yes-no>
                    </div>
                </div>
                <div class="form-group" ng-show="edit_obj.field_type == 1">
                    <label class="col-sm-7 control-label" title="Field has bounds">
                        Bounds
                    </label>
                    <div class="col-sm-3 controls">
                        <icsw-tools-yes-no flag="edit_obj.has_bounds" icsw-callback="field_changed"></icsw-tools-yes-no>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label class="col-sm-7 control-label" title="Value cannot be altered by device">
                        fixed
                    </label>
                    <div class="col-sm-3 controls">
                        <icsw-tools-yes-no flag="edit_obj.fixed" icsw-callback="field_changed"></icsw-tools-yes-no>
                    </div>
                </div>
                <div class="form-group" ng-show="edit_obj.field_type == 1">
                    <label class="col-sm-7 control-label" title="Field is consumable">
                        consumable
                    </label>
                    <div class="col-sm-3 controls">
                        <icsw-tools-yes-no flag="edit_obj.consumable" icsw-callback="field_changed"></icsw-tools-yes-no>
                    </div>
                </div>
            </div>
        </div>
        <fieldset ng-show="edit_obj.field_type == 1 && edit_obj.has_bounds">
            <legend>Bounds</legend>
            <div class="form-group">
                <label class="control-label col-xs-3">
                    Bounds
                </label>
                <div class="controls col-xs-4">
                    <input class="form-control" type="number" ng-model="edit_obj.value_int_lower_bound"/>
                </div>
                <div class="controls col-xs-4">
                    <input class="form-control" type="number" ng-model="edit_obj.value_int_upper_bound"/>
                </div>
            </div>
        </fieldset>
        <fieldset ng-show="edit_obj.field_type == 1 && edit_obj.consumable">
            <legend>Bounds</legend>
            <div class="form-group">
                <label class="control-label col-xs-3">
                    Consumable start / warn / crit
                </label>
                <div class="controls col-xs-9 form-inline">
                    <input class="form-control" type="number" size="8" style="width:140px;" ng-model="edit_obj.consumable_start_value"/>
                    &nbsp;&gt;&nbsp;
                    <input class="form-control" type="number" size="8" style="width:140px;" ng-model="edit_obj.consumable_warn_value"/>
                    &nbsp;&gt;&nbsp;
                    <input class="form-control" type="number" size="8" style="width:140px;" ng-model="edit_obj.consumable_critical_value"/>
                </div>
            </div>
        </fieldset>
    </form>
</script>

<script type="text/ng-template" id="icsw.static.asset.template.copy.form">
    <form class="form-horizontal" name="form_data">
        <fieldset>
            <legend>Base settings</legend>
            <div class="form-group">
                <label class="control-label col-xs-3 requiredField">
                    Name<span class="asteriskField">*</span>
                </label>
                <div class="controls col-xs-7">
                    <input class="form-control" ng-model="new_obj.name">
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-xs-3 requiredField">
                    Description
                </label>
                <div class="controls col-xs-7">
                    <input class="form-control" ng-model="new_obj.description"/>
                </div>
            </div>
        </fieldset>
    </form>
</script>
