
<script type="text/ng-template" id="icsw.history.overview">
    <h2>System history</h2>


    <div class="form-inline">
        <label for="id_sel_mod" class="control-label">
            Model:
        </label>
        <select id="id_sel_mod" class="select form-control" ng-model="selected_model"
                ng-options="v[1] as v[0] for v in models_with_history_sorted" style="width: auto"></select>
    </div>

    <!--
    -->
    <icsw-history-model-history model="selected_model"></icsw-history-model-history>
</script>

<script type="text/ng-template" id="icsw.history.model_history">
    <h3 ng-show="style != 'config'">{{models_with_history[model()]}}</h3>
    <table class="table table-condensed table-hover table-striped" style="width: auto"
            st-table="entries_display" st-safe-src="entries">
        <thead>
            <tr>
                <td colspan="99">
                    <div icsw-tools-pagination st-items-by-page="10" st-displayed-pages="11"
                         possible-items-by-page="10,20,50,100,200,500,1000"></div>
                </td>
            </tr>
            <tr>
                <th st-sort="meta.date" st-sort-default="reverse">Date</th>
                <th>User</th>
                <th>Type</th>
                <th>Object</th>
                <th>Object ID</th>
                <th></th>
                <th>Change</th>
                <!--
                <th ng-repeat="(k, v) in entries[0].data" ng-show="column_visible[k]">{{k}}</th>
                -->
            </tr>
        </thead>
        <tbody>
            <tr ng-repeat="entry in entries_display">
                <td>{{entry.meta.date | datetime_concise}}</td>
                <td>{{get_user_by_idx(entry.meta.user).login}}</td>
                <td>{{entry.meta.type}}
                <td>{{entry.meta.object_repr}}</td>
                <td>{{entry.meta.object_id}}</td>
                <td></td>
                <!--
                <td ng-repeat="(k, v) in entry.data" ng-class="last_entry_different(entry.data['pk'], $parent.$index, k) && 'danger'">
                    {{v}}
                </td>
                -->
                <td>
                    <div ng-repeat="(k, v) in entry.changes" ng-if="entry.meta.type == 'modified'">
                        Change <strong>{{k}}</strong><span ng-if="v[2]">:</span>
                        <span ng-if="v[2]">
                            <pre ng-bind-html="v[2]"></pre>
                        </span>
                        <span ng-if="!v[2]">
                            from
                            <strong>
                                {{format_value(v[0])}}
                            </strong>
                            to
                            <strong>
                                {{format_value(v[1])}}
                            </strong>
                        </span>
                    </div>


                    <div ng-if="entry.meta.type != 'modified'">

                        <table class="table table-condensed" style="width: auto">
                            <tr>
                                <th ng-repeat="(k, v) in entry.changes">
                                    {{k}}
                                </th>
                            </tr>
                            <tr>
                                <td ng-repeat="(k, v) in entry.changes">
                                    {{format_value(v)}}
                                </td>
                            </tr>

                            <!--
                        <tr ng-repeat="(k, v) in entry.changes">
                            <th>
                                {{k}}
                            </th>
                            <td >
                                {{format_value(v)}}
                            </td>
                        </tr>
                        -->


                        </table>
                    </div>
                </td>


                <!--
                <td ng-repeat="(k, v) in entry.data" ng-show="column_visible[k]">
                        <div ng-show="last_entry_different(entry.data['pk'], $parent.$index, k)">
                            {{get_last_entry_before(entry.data['pk'], $parent.$index).data[k]}}
                            TO
                            {{v}}
                        </div>
                    </td>
                -->
            </tr>
        </tbody>
    </table>
</script>
