<script type="text/ng-template" id="icsw.layout.selection.modify">
    <div ng-controller="icswLayoutSelectionController">
        <uib-tabset ng-if="struct.selection_valid">
            <uib-tab>
                <uib-tab-heading>
                    <span ng-class="struct.synced && 'fa fa-lock' || 'fa fa-unlock'"></span>
                    current selection
                </uib-tab-heading>
                <form class="input-group" ng-submit="call_devsel_func()">
                    <div ng-class="struct.search_ok && 'form-group' || 'form-group has-error'">
                        <input
                            type="text"
                            class="form-control"
                            ng-disabled="struct.is_loading"
                            ng-model="struct.search_str"
                            placeholder="search by name, IP or MAC"
                            ng-change="update_search()"
                            icsw-auto-focus
                        />
                    </div>
                    <span class="input-group-btn">
                        <button class="btn btn-success" title="Use selection (with resolve)" type="button" ng-click="call_devsel_func()" ng-show="devsel_receivers">
                            <span class="fa fa-chevron-right"></span>
                             Apply
                        </button>
                        <button class="btn btn-warning" title="Clear selection" type="button" ng-click="clear_search()">
                            <span class="fa fa-remove"></span>
                             Clear
                        </button>
                    </span>
                </form>
                <span>
                    <button
                        class="btn btn-primary btn-xs"
                        ng-disabled="!struct.selection.any_selected()"
                        ng-click="show_current_selection_in_overlay()"
                    >
                        <span class="bootstrap-dialog-button-icon glyphicon glyphicon-menu-hamburger"></span>
                        show in overlay
                    </button>
                    <icsw-tools-button
                        type="select_parent"
                        value="select parents"
                        size="xs"
                        disabled="!struct.selection.any_selected()"
                        ng-click="select_parents()"
                    ></icsw-tools-button>
                    <icsw-tools-button type="display" size="xs" value="show selection" ng-show="struct.selection.any_selected()" ng-click="toggle_show_selection()"></icsw-tools-button>
                    <icsw-tools-button type="modify" size="xs" value="resolve lazy selection" ng-show="struct.selection.any_lazy_selected()" ng-click="resolve_lazy_selection()"></icsw-tools-button>
                    <icsw-tools-button type="modify" size="xs" icsw-value="struct.class_filter_name" ng-click="show_class_filter($event)"></icsw-tools-button>
                </span>
                <small>
                    <ul class="list-group" ng-show="show_selection && struct.selection.any_selected()">
                        <li class="list-group-item" ng-show="struct.selection.devg_sel.length">
                            <strong>{{ struct.selection.devg_sel.length }} lazy Device Groups:</strong> {{ resolve_device_groups(struct.selection) }}
                        </li>
                        <li class="list-group-item" ng-show="struct.selection.cat_sel.length">
                            <strong>{{ struct.selection.cat_sel.length }} lazy Categories:</strong> {{ resolve_categories(struct.selection) }}
                        </li>
                        <li class="list-group-item" ng-show="struct.selection.dev_sel.length">
                            <strong>{{ struct.selection.dev_sel.length }} direct Devices:</strong> {{ resolve_devices(struct.selection) }}
                        </li>
                        <li class="list-group-item text-success" ng-show="struct.selection.tot_dev_sel.length">
                            <strong>{{ struct.selection.tot_dev_sel.length }} total Devices:</strong> {{ resolve_total_devices(struct.selection) }}
                        </li>
                    </ul>
                </small>
                <form class="form-horizontal">
                    <div class="form-group" ng-show="struct.synced">
                        <label class="col-md-2 control-label">Selected:</label>
                        <div class="col-md-10 form-control-static">
                            {{ struct.selection.db_obj.info }}
                            <span class="pull-right">
                                <icsw-tools-button type="save" size="sm" ng-show="struct.selection.changed" ng-click="update_selection()"></icsw-tools-button>
                            </span>
                        </div>
                    </div>
                </form>
                <uib-tabset active="struct.active_tab_idx">
                    <uib-tab select="activate_tab('d')">
                        <uib-tab-heading>
                            Device
                            <span ng-show="struct.selection_dict['d']">
                                ({{ struct.selection_dict['d'] }})
                                <button class="btn btn-warning btn-xs fa fa-remove" title="Clear selection" type="button" ng-click="clear_selection('d')">
                                     Clear
                                </button>
                            </span>
                        </uib-tab-heading>
                        <!-- use tree for production or ntree for testing -->
                        <!-- add attribute max-heigth to limit used height -->
                        <icsw-react-tree icsw-tree-config="tc_devices" single="true"></icsw-react-tree>
                    </uib-tab>
                    <uib-tab select="activate_tab('g')">
                        <uib-tab-heading>
                            Group
                            <span ng-show="struct.selection_dict['g']">
                                ({{ struct.selection_dict['g'] }})
                                <button class="btn btn-warning btn-xs fa fa-remove" title="Clear selection" type="button" ng-click="clear_selection('g')">
                                     Clear
                                </button>
                            </span>
                        </uib-tab-heading>
                        <icsw-react-tree icsw-tree-config="tc_groups"></icsw-react-tree>
                    </uib-tab>
                    <uib-tab select="activate_tab('c')">
                        <uib-tab-heading>
                            Category
                            <span ng-show="struct.selection_dict['c']">
                                ({{ struct.selection_dict['c'] }})
                                <button class="btn btn-warning btn-xs fa fa-remove" title="Clear selection" type="button" ng-click="clear_selection('c')">
                                     Clear
                                </button>
                            </span>
                        </uib-tab-heading>
                        <icsw-react-tree icsw-tree-config="tc_categories"></icsw-react-tree>
                    </uib-tab>
                </uib-tabset>
            </uib-tab>
            <uib-tab heading="saved selections" select="enable_saved_selections()">
                <form class="form-horizontal">
                    <h3 ng-show="!saved_selections.length" class="text-warning">No saved selections found</h3>
                    <div ng-show="saved_selections.length">
                        <h3 class="text-success">{{ saved_selections.length }} saved selections found</h3>
                        <div class="col-md-12 controls form-control-static">
                            {{  selection_for_dropdown }}
                            <div class="input-group">
                                <ui-select ng-model="struct.selection_for_dropdown" on-select="use_selection($item, $model)">
                                    <ui-select-match class="ui-select-match" placeholder="Choose a selection...">
                                        {{ $select.selected.info }}
                                    </ui-select-match>
                                    <ui-select-choices class="ui-select-choices" repeat="sel in saved_selections">
                                        <div ng-bind-html="sel.info | highlight: $select.search"></div>
                                    </ui-select-choices>
                                </ui-select>
                                <span class="input-group-btn">
                                    <button type="button" ng-click="unselect()" class="btn btn-default">
                                        <span class="glyphicon glyphicon-trash"></span>
                                    </button>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group" ng-show="struct.synced">
                        <label class="col-md-2 control-label">Selected:</label>
                        <div class="col-md-10 form-control-static">
                            {{ struct.selection.db_obj.info }}
                            <span class="pull-right">
                                <icsw-tools-button type="save" size="sm" ng-show="struct.selection.changed" ng-click="update_selection()"></icsw-tools-button>
                                <button class="btn btn-success btn-sm fa fa-chevron-right" title="Use selection (with resolve)" type="button" ng-click="call_devsel_func()" ng-show="devsel_receivers">
                                     Apply
                                </button>
                                <icsw-tools-button type="delete" size="sm" ng-click="delete_selection()"></icsw-tools-button>
                            </span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-2 control-label">
                            <span ng-show="struct.synced">or </span>
                            create:
                        </label>
                        <div class="col-md-8 controls">
                            <input class="form-control" ng-model="struct.selection.db_obj.name" type="text"/>
                        </div>
                        <div class="col-md-2 controls">
                            <icsw-tools-button type="create" size="" ng-click="create_selection()"></icsw-tools-button>
                        </div>
                    </div>
                </form>
            </uib-tab>
        </uib-tabset>
    </div>
</script>

<script type="text/ng-template" id="icsw.layout.class.filter">
    <ng-form class="form-horizontal" name="form_data">
        <fieldset>
            <legend>Defined DeviceClasses ({{ device_class_tree.list.length }})</legend>
            <div class="form-group"  ng-repeat="entry in device_class_tree.list">
                <label class="control-label col-sm-3">
                    {{ entry.name }}
                </label>
                <div class="controls col-sm-2">
                    <icsw-tools-yes-no flag="entry.$$enabled" icsw-callback="selection_changed"></icsw-tools-yes-no>
                </div>
                <label class="col-sm-7">
                    {{ entry.description }}
                </label>
            </div>
        </fieldset>
    </ng-form>
</script>
