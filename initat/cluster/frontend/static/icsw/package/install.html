<script type="text/ng-template" id="icsw.package.install.package.repo.head">
    <tr>
        <th>Name</th>
        <th>Alias</th>
        <th>Enabled</th>
        <th>AutoRefresh</th>
        <th>GPGcheck</th>
        <th>publish</th>
        <th>URL</th>
        <th>Pri</th>
        <th>Service</th>
        <th colspan="2" class="text-center">action</th>   
    </tr>
</script>

<script type="text/ng-template" id="icsw.package.install.pdc.state">
    <div>
        <span ng-show="show_pdc()" tooltip-placement="bottom" tooltip-html-unsafe="{{ get_tooltip() }}">
            <span ng-class="get_glyph_class(pdc.target_state)"></span>
            <div class="btn-group btn-group-xs">
                <input type="button" class="btn disabled" ng-class="get_btn_class()" value="{{ pdc.installed }}"/>
                <input type="button" class="btn disabled" ng-class="pdc.force_flag && 'btn-primary' || 'btn-default'" value="F"/>
                <input type="button" class="btn disabled" ng-class="pdc.nodeps_flag && 'btn-primary' || 'btn-default'" value="N"/>
                <input type="button" ng-class="pdc.selected && 'btn btn-primary' || 'btn'" value="S" title="select" ng-model="pdc.selected" ng-click="change_sel(pdc)"/>
            </div>
        </span>
        <span ng-show="!show_pdc()">
            <div class="btn-group btn-group-xs">
                <input type="button" ng-class="pdc.selected && 'btn btn-primary' || 'btn'" value="S" title="select" ng-model="pdc.selected" ng-click="change_sel(pdc)"/>
            </div>
        </span>
    </div>
</script>

<script type="text/ng-template" id="icsw.package.install.pdc.version">
    <div>
        <span ng-show="show_pdc()" tooltip-placement="bottom" tooltip-html-unsafe="{{ get_tooltip() }}">
            {{ get_installed_version() }}
        </span>
    </div>
</script>

<script type="text/ng-template" id="icsw.package.install.package.repo.row">
    <td>{{ obj.name }}</td>
    <td>{{ obj.alias }}</td>
    <td>{{ obj.enabled | yesno1 }}</td>
    <td>{{ obj.autorefresh | yesno1 }}</td>
    <td>{{ obj.gpg_check | yesno1 }}</td>
    <td>{{ obj.publish_to_nodes | yesno1 }}</td>
    <td>{{ obj.url }}</td>
    <td>{{ obj.priority }}</td>
    <td>{{ fn.get_service_name(this, obj) }}</td>
    <td><input type="button" class="btn btn-xs btn-primary" ng-click="config_service.toggle(obj)" value="toggle publish"/></td>
    <td><input type="button" class="btn btn-xs btn-danger" ng-click="delete(obj)" value="delete"/></td>
</script>

<script type="text/ng-template" id="icsw.package.install.package.search.head">
    <tr>
        <th>Search string</th>
        <th>User</th>
        <th>repeat</th>
        <th>State</th>
        <th>results</th>
        <th>search</th>
        <th>last search</th>   
        <th colspan="4" class="text-center">action</th>   
    </tr>
</script>

<script type="text/ng-template" id="icsw.package.install.package.search.row">
    <td>{{ obj.search_string }}</td>
    <td>{{ obj.user | array_lookup:config_service.user_rest | show_user }}</td>
    <td>{{ obj.num_searches }}</td>
    <td>{{ obj.current_state }}</td>
    <td>{{ obj.results }}</td>
    <td>{{ obj.last_search_string }}</td>
    <td class="text-right">{{ obj.last_search | datetime1 }}</td>
    <td><input type="button" class="btn btn-success btn-xs" ng-show="obj.results > 0" ng-click="show_search_result(obj)" value="show"/></td>
    <td><input type="button" class="btn btn-primary btn-xs" ng-show="obj.current_state == 'done'" ng-click="retry_search(obj, reload)" value="retry"/></td>
    <td><input type="button" class="btn btn-warning btn-xs" ng-show="obj.current_state == 'done'" ng-click="edit($event, obj)" value="modify"/></td>
    <td><input type="button" class="btn btn-danger btn-xs" ng-click="delete(obj)" value="delete"/></td>
</script>

<script type="text/ng-template" id="icsw.package.install.search.result.head">
    <tr>
        <th>name</th>
        <th>version</th>
        <th>kind</th>
        <th>repo</th>
        <th>arch</th>
        <th colspan="3" class="text-center">action</th>   
    </tr>
</script>

<script type="text/ng-template" id="icsw.package.install.search.result.row">
    <td>{{ obj.name }}</td>
    <td>{{ obj.version }}</td>
    <td>{{ obj.kind }}</td>
    <td>{{ obj.package_repo | array_lookup:entries.repos:"name" }}</td>
    <td>{{ obj.arch }}</td>
    <td><input type="button" ng-show="obj.copied == 0" class="btn btn-xs btn-primary" ng-click="take_search_result(obj, true)" value="take exact"/></td>
    <td>
        <div ng-show="!obj.copied">
            <input type="button" class="btn btn-xs btn-primary" ng-click="take_search_result(obj, false)" value="take latest"/>
        <div class="btn-group">
            <button type="button" class="btn btn-warning btn-xs dropdown-toggle" data-toggle="dropdown">
                from repo <span class="caret"></span>
            </button>
            <ul class="dropdown-menu">
                <li><a href="#" ng-click="obj.target_repo=0">ignore</a></li>
                <li ng-repeat="repo in entries.repos"><a href="#" ng-click="obj.target_repo=repo.idx"><span ng-show="repo.idx == obj.package_repo">(*) </span>{{ repo.name }}</a></li>
            </ul>
        </div>
        {{ show_repo(obj) }}
        </div>
    </td>
    <td><input type="button" class="btn btn-xs btn-danger" ng-click="delete(obj)" value="delete"/></td>
</script>

<script type="text/ng-template" id="icsw.package.install.package.list.head">
    <tr>
        <th>name</th>
        <th>version</th>
        <th>Repository</th>
        <th>forced</th>
        <th>kind</th>
        <th>arch</th>
        <th colspan="3" class="text-center">action</th>   
    </tr>
</script>

<script type="text/ng-template" id="icsw.package.install.package.list.row">
    <td>{{ obj.name }}</td>
    <td ng-show="obj.always_latest == false">{{ obj.version }}</td>
    <td ng-show="obj.always_latest == true">&lt;latest&gt;</td>
    <td>{{ obj.package_repo | array_lookup:entries.repos:"name" }}</td>
    <td>{{ obj.target_repo | array_lookup:entries.repos:"name":"---" }}</td>
    <td>{{ obj.kind }}</td>
    <td>{{ obj.arch }}</td>
    <td><input type="button" class="btn btn-primary btn-xs" ng-click="attach(obj)" value="attach" title="attach to selected devices"/></td>
    <td><input type="button" class="btn btn-warning btn-xs" ng-click="remove(obj)" value="remove" title="remove from selected devices"/></td>
    <td><input type="button" class="btn btn-danger btn-xs" ng-click="delete(obj)" value="delete"/></td>
    <td>{{ get_pdc_list(obj) }}</td>
</script>

<script type="text/ng-template" id="icsw.package.install.overview">
    <tabset>
        <tab heading="Package repositories">
            <icsw-tools-rest-table target-list="entries.repos" config-service="icswPackageInstallRepositoryService">
                <h3>Repositories ({{ entries.repos.length }} entries, {{ rest_data.service.length }} services),
                    <input type="button" class="btn btn-primary" value="Rescan" ng-click="rescan_repos(reload)"/>,
                    <input type="button" class="btn btn-warning" value="Sync to clients" ng-click="sync_repos()"/>,
                    <input type="button" class="btn btn-warning" value="Clear caches" ng-click="clear_caches()"/>
                </h3>
                <table st-table="repos_displayed" st-safe-src="entries.repos" class="table table-condensed table-hover" style="width:auto;">
                    <thead icsw-package-install-repository-head></thead>
                    <tbody>
                        <tr>
                            <td colspan="5" icsw-tools-pagination paginator-filter="func" paginator-filter-func="fn.filter_repo" st-items-by-page="10" possible-items-by-page="10,20,50,100">
                            </td>
                            <td>
                                show:
                                <input type="button" ng-class="show_enabled_repos && 'btn btn-sm btn-success' || 'btn btn-sm'" value="enabled" ng-click="show_enabled_repos =! show_enabled_repos"/>
                                <input type="button" ng-class="show_published_repos && 'btn btn-sm btn-success' || 'btn btn-sm'" value="published" ng-click="show_published_repos =! show_published_repos"/>
                            </td>
                        </tr>
                        <tr icsw-package-install-repository-row ng-repeat="obj in repos_displayed"></tr><!--entries | orderBy:'-name':true | paginator:this"></tr>-->
                    </tbody>
                </table>
            </icsw-tools-rest-table>
        </tab>
        <tab heading="Package search">
            <icsw-tools-rest-table target-list="entries.searches" config-service="icswPackageInstallSearchService">
                <h3>Searches ({{ entries.searches.length }} entries)</h3>
                <div class="row">
                    <div class="form-inline col-md-8">
                        <form class="form-inline" ng-submit="create_search()">
                            New search :
                            <input class="form-control input-ms" placeholder="search string ..." type="text" ng-model="search_string" />
                            <input type="submit" class="btn btn-sm btn-warning" value="create"/>
                        </form>
                    </div>
                </div>
                <table st-table="searches_displayed" st-safe-src="entries.searches" class="table table-condensed table-hover" style="width:auto;">
                    <thead icsw-package-install-search-head></thead>
                    <tbody>
                        <tr><td colspan="9" icsw-tools-pagination  st-items-by-page="10" possible-items-by-page="10,20,50,100"></td></tr>
                        <tr icsw-package-install-search-row ng-repeat="obj in searches_displayed"></tr>
                    </tbody>
                </table>
            </icsw-tools-rest-table>
            <icsw-tools-rest-table target-list="entries.searchresults" config-service="icswPackageInstallSearchResultService" ng-show="active_search">
                <h3>Search results for '{{ active_search.last_search_string }}' ({{ entries.searchresults.length }} entries)</h3>
                <table st-table="searchresults_displayed" st-safe-src="entries.searchresults" class="table table-condensed table-hover" style="width:auto;">
                    <thead icsw-package-install-search-result-head></thead>
                    <tbody>
                        <tr><td colspan="9" icsw-tools-pagination  st-items-by-page="10" possible-items-by-page="10,20,50,100"></td></tr>
                        <tr icsw-package-install-search-result-row ng-repeat="obj in searchresults_displayed"></tr>
                    </tbody>
                </table>
            </icsw-tools-rest-table>
        </tab>
        <tab heading="Install">
            <h3>
                <div class="form-inline">
                    ({{ devices.length }} devices, {{ entries.packages.length }} packages), {{ selected_pdcs_length() }} selected, package filter:
                    <div class="form-group">
                        <input ng-model="package_filter" class="form-control input-sm"/>
                    </div>,
                    <input ng-show="selected_pdcs_length()" type="button" class="btn btn-success btm-sm" value="action" ng-click="action($event)"/>&nbsp;
                    <input type="button" class="btn btn-warning btm-sm" value="sync" ng-click="send_sync()"/>,
                    <input type="button" class="btn btn-warning btn-sm" value="Clear caches" ng-click="send_clear_caches()"/>,
                    <div class="btn-group btn-group-sm">
                        <input type="button" ng-class="is_mode == 'a' && 'btn btn-success' || 'btn'" ng-click="is_mode = 'a'" value="action"/>
                        <input type="button" ng-class="is_mode == 'v' && 'btn btn-success' || 'btn'" ng-click="is_mode = 'v'" value="version"/>
                    </div>
                </div>
            </h3>
            <table class="table table-condensed" style="width:auto;">
                <thead>
                    <tr>
                        <th>&nbsp;</th>
                        <th>Device</th>
                        <th ng-repeat="dev in devices" class="text-center">{{ dev.name }}</th>
                    </tr>
                    <tr>
                        <th>&nbsp;</th>
                        <th>contact (Vers)</th>
                        <td ng-repeat="dev in devices">{{ latest_contact(dev) }} ({{ dev.client_version }})</td>
                    </tr>
                    <tr>
                        <th>Package</th>
                        <th>action</th>
                        <th ng-repeat="dev in devices" class="text-center">
                            <div class="btn-group btn-group-xs">
                                <input type="button" class="btn btn-primary" ng-click="change_device_sel(dev, 1)" value="S"/>
                                <input type="button" class="btn btn-success" ng-click="change_device_sel(dev, 0)" value="T"/>
                                <input type="button" class="btn btn-warning" ng-click="change_device_sel(dev, -1)" value="C"/>
                            </div>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="pack in entries.packages | filter:{'name' : package_filter}">
                        <td>
                            {{ pack.name }}
                            <span ng-show="pack.always_latest == false">{{ pack.version }}</span>
                            <span ng-show="pack.always_latest == true">&lt;latest&gt;</span>
                            <span ng-show="pack.target_repo"> from {{ pack.target_repo | array_lookup:entries.repos:"name" }}</span>
                        </td>
                        <td>
                            <div class="btn-group btn-group-xs">
                                <input type="button" class="btn btn-primary" ng-click="change_package_sel(pack, 1)" value="S"/>
                                <input type="button" class="btn btn-success" ng-click="change_package_sel(pack, 0)" value="T"/>
                                <input type="button" class="btn btn-warning" ng-click="change_package_sel(pack, -1)" value="C"/>
                            </div>
                        </td>
                        <td ng-repeat="device in devices" istate mode="is_mode" pdc="state_dict[device.idx][pack.idx]" parent="$parent.$parent" pdcs="$parent.selected_pdcs" ng-class="get_td_class(device.idx, pack.idx)"></td>
                    </tr>
                </tbody>
            </table>
            <icsw-tools-rest-table target-list="entries.packages" config-service="icswPackageInstallPackageListService">
                <h3>Packages ({{ entries.packages.length }} entries)</h3>
                <table st-table="packages_displayed" st-safe-src="entries.packages" class="table table-condensed table-hover" style="width:auto;">
                    <thead icsw-package-install-package-head></thead>
                    <tbody>
                        <tr><td colspan="9" icsw-tools-pagination  st-items-by-page="10" possible-items-by-page="10,20,50,100"></td></tr>
                        <tr icsw-package-install-package-row ng-repeat="obj in packages_displayed"></tr>
                    </tbody>
                </table>
            </icsw-tools-rest-table>
        </tab>
    </tabset>
</script>
