<script type="text/ng-template" id="icsw.rms.job.running.table">
    <table class="table table-condensed table-hover table-striped" style="width:auto;">
        <thead>
            <tr>
                <td colspan="20" paginator entries="run_list" pag_settings="pagRun" per_page="20" paginator_filter="simple" paginator-epp="10,20,50,100,1000"></td>
            </tr>
            <tr icsw-rms-table-headers struct="running_struct" class="info"></tr>
        </thead>
        <tbody>
            <tr icsw-rms-job-run-line ng-repeat-start="data in run_list | paginator2:pagRun" ></tr>
            <tr ng-repeat-end ng-show="data.files.value != '0' && running_struct.toggle['files']">
                <td colspan="99"><icsw-rms-file-info job="data" files="files" fis="fis"></icsw-rms-file-info></td>
            </tr>
        </tbody>
        <tfoot>
            <tr icsw-rms-table-header-toggle ng-show="header_filter_set" struct="running_struct"></tr>
        </tfoot>
    </table>
</script>

<script type="text/ng-template" id="icsw.rms.job.waiting.table">
    <table class="table table-condensed table-hover table-striped" style="width:auto;">
        <thead>
            <tr>
                <td colspan="20" paginator entries="wait_list" pag_settings="pagWait" per_page="20" paginator_filter="simple" paginator-epp="10,20,50,100,1000"></td>
            </tr>
            <tr icsw-rms-table-headers struct="waiting_struct" class="info"></tr>
        </thead>
        <tbody>
            <tr icsw-rms-job-wait-line ng-repeat="data in wait_list | paginator2:pagWait"></tr>
        </tbody>
        <tfoot>
            <tr icsw-rms-table-header-toggle ng-show="header_filter_set" struct="waiting_struct"></tr>
        </tfoot>
    </table>
</script>

<script type="text/ng-template" id="icsw.rms.job.done.table">
    <table class="table table-condensed table-hover" style="width:auto;">
        <thead>
            <tr>
                <td colspan="20" paginator entries="done_list" pag_settings="pagDone" per_page="20" paginator_filter="simple" paginator-epp="10,20,50,100,1000"></td>
            </tr>
            <tr icsw-rms-table-headers struct="done_struct" class="info"></tr>
        </thead>
        <tbody>
            <tr icsw-rms-job-done-line ng-repeat="data in done_list | paginator2:pagDone"></tr>
        </tbody>
        <tfoot>
            <tr icsw-rms-table-header-toggle ng-show="header_filter_set" struct="done_struct"></tr>
        </tfoot>
    </table>
</script>

<script type="text/ng-template" id="icsw.rms.queue.table">
    <table class="table table-condensed table-hover" style="width:auto;">
        <thead>
            <tr>
                <td colspan="20" paginator entries="queue_list" pag_settings="pagNode" per_page="20" paginator_filter="simple" paginator-epp="10,20,50,100,1000"></td>
            </tr>
            <tr icsw-rms-table-headers struct="node_struct" class="info"></tr>
        </thead>
        <tbody>
            <tr icsw-rms-queue-line ng-repeat="data in queue_list | paginator2:pagNode" ng-class="get_class(data)"></tr>
        </tbody>
        <tfoot>
            <tr icsw-rms-table-header-toggle ng-show="header_filter_set" struct="node_struct"></tr>
        </tfoot>
    </table>
</script>

<script type="text/ng-template" id="icsw.rms.iostruct">
    <h4>
        {{ io_struct.get_file_info() }}, 
        <input type="button" class="btn btn-sm btn-warning" value="close" ng-click="close_io(io_struct)"/>
        <input type="button" ng-class="io_struct.update && 'btn btn-sm btn-success' || 'btn btn-sm'" value="update" ng_click="io_struct.update = !io_struct.update"/>
    </h4>
    <div>
        <tt>
            <textarea ui-codemirror="editorOptions" ng-model="io_struct.text">
            </textarea>
        </tt>
    </div>
</script>

<script type="text/ng-template" id="icsw.rms.table.headers">
    <th ng-repeat="entry in struct.display_headers()" colspan="{{ struct.get_span(entry) }}">{{ struct.get_header(entry) }}</th>
</script>

<script type="text/ng-template" id="icsw.rms.table.header.toggle">
    <th colspan="{{ struct.headers.length }}">
        <form class="inline">
            <input
                ng-repeat="entry in struct.headers"
                type="button"
                ng-class="struct.get_btn_class(entry)"
                value="{{ struct.get_header(entry) }}"
                ng-click="struct.change_entry(entry)"
                ng-show="struct.header_not_hidden(entry)"
            />
        </form>
    </th>
</script>

<script type="text/ng-template" id="icsw.rms.file.info">
    <div ng-repeat="file in jfiles">
        <div>
            <input
                type="button"
                ng-class="fis[file[0]].show && 'btn btn-xs btn-success' || 'btn btn-xs'"
                ng-click="change_display(file[0])"
                ng-value="fis[file[0]].show && 'hide' || 'show'"/>
            {{ file[0] }}, {{ file[2] }} Bytes
        </div>
        <div ng-show="fis[file[0]].show">
            <textarea rows="{{ file[4] }}" cols="120" readonly="readonly">{{ file[1] }}</textarea>
        </div>
    </div>
</script>

<script type="text/ng-template" id="icsw.rms.queue.line">
    <td ng-show="node_struct.toggle['host']">
        {{ data.host.host.value }}&nbsp;<button type="button" class="pull-right btn btn-xs btn-primary" ng-show="has_rrd(data.host)" ng-click="show_node_rrd($event, data)">
            <span class="glyphicon glyphicon-pencil"></span>
        </button>
    </td>
    <td ng-show="node_struct.toggle['queues']">
        <icsw-rms-queue-state operator="rms_operator" queue="data"></icsw-rms-queue-state>
    </td>
    <td ng-show="node_struct.toggle['type']">
        {{ data.type.value }}
    </td>
    <td ng-show="node_struct.toggle['complex']">
        {{ data.complex.value }}
    </td>
    <td ng-show="node_struct.toggle['pe_list']">
        {{ data.pe_list.value }}
    </td>
    <td ng-show="node_struct.toggle['load']">
        <span ng-switch on="valid_load(data.load)">
            <span ng-switch-when="1">
                <div class="row">
                    <div class="col-sm-3"><b>{{ data.load.value }}</b>&nbsp;</div>
                    <div class="col-sm-9" style="width:140px; height:20px;">
                        <progressbar value="get_load(data.load)" animate="false"></progressbar>
                    </div>
                </div>
            </span>
            <span ng-switch-when="0">
                <b>{{ data.load.value }}</b>
            </span>
        </span>
    </td>
    <td ng-show="node_struct.toggle['slots_used']">
        <div ng-repeat="entry in data.load_vector" class="row">
             <div class="col-sm-12" style="width:140px; height:20px;">
                 <progressbar max="entry[0]" value="entry[1]" animate="false" type="info"><span style="color:black;">{{ entry[1] }} / {{ entry[0] }}</span></progressbar>
             </div>
        </div>
    </td>
    <td ng-show="node_struct.toggle['slots_used']">
        {{ data.slots_used.value }}
    </td>
    <td ng-show="node_struct.toggle['slots_reserved']">
        {{ data.slots_reserved.value }}
    </td>
    <td ng-show="node_struct.toggle['slots_total']">
        {{ data.slots_total.value }}
    </td>
    <td ng-show="node_struct.toggle['jobs']">
        {{ data.jobs.value }}
    </td>
</script>

<script type="text/ng-template" id="icsw.rms.queue.state.oper">
    <div class="row">
        <div class="col-sm-12 btn-group">
            <button type="button" class="btn btn-xs dropdown-toggle" ng-class="get_queue_class(queue.state.value, 'btn')" data-toggle="dropdown">
                {{ queue.name }} : {{ queue.state.value }} <span class="caret"></span>
            </button>
            <ul class="dropdown-menu">
                <li ng-show="enable_ok(queue.state.value)" ng-click="queue_control('enable', queue)">
                    <a href="#">Enable {{ queue.name }}@{{ queue.host.host.value }}</a>
                </li>
                <li ng-show="disable_ok(queue.state.value)" ng-click="queue_control('disable', queue)">
                    <a href="#">Disable {{ queue.name }}@{{ queue.host.host.value }}</a>
                </li>
                <li ng-show="clear_error_ok(queue.state.value)" ng-click="queue_control('clear_error', queue)">
                    <a href="#">Clear error on {{ queue.name }}@{{ queue.host.host.value }}</a>
                </li>
            </ul>
        </div>
    </div>
    <span ng-show="!queues_defined()">
        N/A
    </span>
</script>

<script type="text/ng-template" id="icsw.rms.queue.state">
    <div>
        <span class="label" ng-class="get_queue_class(queue.state.value, 'label')">
            {{ queue.name }} : {{ queue.state.value }}
        </span>
    </div>
</script>

<script type="text/ng-template" id="icsw.rms.job.action.oper">
    <div>
        <div class="btn-group">
            <button type="button" class="btn btn-xs dropdown-toggle btn-primary" data-toggle="dropdown">
                Action <span class="caret"></span>
            </button>
            <ul class="dropdown-menu">
                <li ng-click="job_control('delete', false)">
                    <a href="#">Delete</a>
                </li>
                <li ng-click="job_control('delete', true)">
                    <a href="#">force Delete</a>
                </li>
                <li ng-show="mode=='w'" ng-click="change_priority()">
                    <a href="#">change priority</a>
                </li>
            </ul>
        </div>
    </div>
</script>

<script type="text/ng-template" id="icsw.rms.job.action">
    <div>
---
    </div>
</script>

<script type="text/ng-template" id="icsw.rms.job.done.line">
    <td ng-show="done_struct.toggle['job_id']">
        {{ data.rms_job.jobid }}&nbsp;<button type="button" class="pull-right btn btn-xs btn-primary" ng-show="has_rrd(data)" ng-click="show_done_rrd($event, data)">
            <span class="glyphicon glyphicon-pencil"></span>
        </button>
    </td>
    <td ng-show="done_struct.toggle['task_id']">
        {{ data.rms_job.taskid }}
    </td>
    <td ng-show="done_struct.toggle['name']">
        {{ data.rms_job.name }}
    </td>
    <td ng-show="done_struct.toggle['granted_pe']">
        {{ data.granted_pe }}<span ng-show="data.granted_pe">({{ data.slots }})</span>
    </td>
    <td ng-show="done_struct.toggle['owner']">
        {{ data.rms_job.owner }}
    </td>
    <td ng-show="done_struct.toggle['queue_time']">
        {{ get_datetime(data.queue_time) }}
    </td>
    <td ng-show="done_struct.toggle['start_time']">
        {{ get_datetime(data.start_time) }}
    </td>
    <td ng-show="done_struct.toggle['end_time']">
        {{ get_datetime(data.end_time) }}
    </td>
    <td ng-show="done_struct.toggle['wait_time']">
        {{ get_waittime(data) }}
    </td>
    <td ng-show="done_struct.toggle['run_time']">
        {{ get_runtime(data) }}
    </td>
    <td ng-show="done_struct.toggle['queue']">
        {{ data.rms_queue.name }}
    </td>
    <td ng-show="done_struct.toggle['exit_status']" ng-class="exit_status_wrapper_class(data)">
        {{ get_exit_status_str(data) }} {{ data.exit_status_str }}
        <div class="pull-right" ng-show="exit_status_class(data)">
            <span ng-class="exit_status_class(data)"></span>
        </div>
    </td>
    <td ng-show="done_struct.toggle['failed']" title="{{ get_failed_title(data) }}">
        <span class="label" ng-class="get_failed_class(data)"><span ng-class="get_failed_glyphicon(data)"></span></span>&nbsp;{{ get_failed_str(data) }} {{ data.failed_str }}
    </td>
    <td ng-show="done_struct.toggle['failed']" class="text-center">
        {{ data.failed }}
    </td>
    <td ng-show="done_struct.toggle['nodelist']">
        {{ show_pe_info(data) }}
    </td>
</script>

<script type="text/ng-template" id="icsw.rms.job.wait.line">
    <td ng-show="waiting_struct.toggle['job_id']">
        {{ data.job_id.value }}
    </td>
    <td ng-show="waiting_struct.toggle['task_id']">
        {{ data.task_id.value }}
    </td>
    <td ng-show="waiting_struct.toggle['name']">
        {{ data.name.value }}
    </td>
    <td ng-show="waiting_struct.toggle['requested_pe']">
        {{ data.requested_pe.value }}
    </td>
    <td ng-show="waiting_struct.toggle['owner']">
        {{ data.owner.value }}
    </td>
    <td ng-show="waiting_struct.toggle['state']">
        <b>{{ data.state.value }}</b>
    </td>
    <td ng-show="waiting_struct.toggle['complex']">
        {{ data.complex.value }}
    </td>
    <td ng-show="waiting_struct.toggle['queue']">
        {{ data.queue.value }}
    </td>
    <td ng-show="waiting_struct.toggle['queue_time']">
        {{ data.queue_time.value }}
    </td>
    <td ng-show="waiting_struct.toggle['wait_time']">
        {{ data.wait_time.value }}
    </td>
    <td ng-show="waiting_struct.toggle['left_time']">
        {{ data.left_time.value }}
    </td>
    <td ng-show="waiting_struct.toggle['exec_time']">
        {{ data.exec_time.value }}
    </td>
    <td ng-show="waiting_struct.toggle['prio']">
        {{ data.prio.value }}
    </td>
    <td ng-show="waiting_struct.toggle['priority']">
        {{ data.priority.value }}
    </td>
    <td ng-show="waiting_struct.toggle['depends']">
        {{ data.depends.value || '---' }}
    </td>
    <td ng-show="waiting_struct.toggle['action']">
        <icsw-rms-job-action job="data" operator="rms_operator" mode="'w'"></icsw-rms-job-action>
    </td>
</script>

<script type="text/ng-template" id="icsw.rms.job.run.line">
    <td ng-show="running_struct.toggle['job_id']">
        {{ data.job_id.value }}&nbsp;<button type="button" class="btn btn-xs btn-primary" ng-show="has_rrd(data.nodelist)" ng-click="show_job_rrd($event, data)">
            <span class="glyphicon glyphicon-pencil"></span>
        </button>
    </td>
    <td ng-show="running_struct.toggle['task_id']">
        {{ data.task_id.value }}
    </td>
    <td ng-show="running_struct.toggle['name']">
        {{ data.name.value }}
    </td>
    <td ng-show="running_struct.toggle['real_user']">
        {{ data.real_user.value }}
    </td>
    <td ng-show="running_struct.toggle['granted_pe']">
        {{ data.granted_pe.value }}
    </td>
    <td ng-show="running_struct.toggle['owner']">
        {{ data.owner.value }}
    </td>
    <td ng-show="running_struct.toggle['state']">
        <b>{{ data.state.value }}</b>
    </td>
    <td ng-show="running_struct.toggle['complex']">
        {{ data.complex.value }}
    </td>
    <td ng-show="running_struct.toggle['queue_name']">
        {{ data.queue_name.value }}
    </td>
    <td ng-show="running_struct.toggle['start_time']">
        {{ data.start_time.value }}
    </td>
    <td ng-show="running_struct.toggle['run_time']">
        {{ data.run_time.value }}
    </td>
    <td ng-show="running_struct.toggle['left_time']">
        {{ data.left_time.value }}
    </td>
    <td ng-show="running_struct.toggle['load']">
        {{ data.load.value }}
    </td>
    <td ng-show="running_struct.toggle['stdout']">
        <span ng-switch on="valid_file(data.stdout.value)">
            <input type="button" ng-class="get_io_link_class(data, 'stdout')" ng-value="data.stdout.value" ng-click="activate_io(data, 'stdout')"/>
        </span>
    </td>
    <td ng-show="running_struct.toggle['stderr']">
        <span ng-switch on="valid_file(data.stderr.value)">
            <input type="button" ng-class="get_io_link_class(data, 'stderr')" ng-value="data.stderr.value" ng-click="activate_io(data, 'stderr')"/>
        </span>
    </td>
    <td ng-show="running_struct.toggle['files']">
        {{ data.files.value }}
    </td>
    <td ng-show="running_struct.toggle['nodelist']">
        {{ get_nodelist(data) }}
    </td>
    <td ng-show="running_struct.toggle['action']">
        <icsw-rms-job-action job="data" operator="rms_operator" mode="'r'"></icsw-rms-job-action>
    </td>
</script>

<script type="text/ng-template" id="icsw.rms.change.priority">
    <div class="modal-header"><h3>Change priority of job {{ get_job_id() }}</h3></div>
    <div class="modal-body">
        <h4>Allowed priority range:</h4>
        <ul class="list-group">
            <li class="list-group-item">lowest priority: <tt>-1023</tt></li>
            <li class="list-group-item">highest priority: <tt>{{ get_max_priority() }}</tt></li>
        </ul>
        <form name="priform" class="form-horizontal">
        <div class="row form-group">
            <div class="col-md-4">
                <label class="control-label pull-right">Priority (actual: {{ job.priority.value }}):</label>
            </div>
            <div class="controls col-md-8">
                <input class="form-control input-sm" type="number" ng-model="cur_priority" min="-1023" max="{{ get_max_priority() }}" required/>
            </div>
        </div>
        </form>
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary" ng-click="ok()" ng-show="priform.$valid">Modify</button>
        <button class="btn btn-warning" ng-click="cancel()">Cancel</button>
    </div>
</script>

<script type="text/ng-template" id="icsw.rms.license.graph">
    <progress max="1000">
        <bar ng-repeat="stack in lic.license_stack track by $index" value="stack.value" title="{{ stack.title }}" type="{{ stack.type }}">{{ stack.out }}</bar>
    </progress>
</script>
