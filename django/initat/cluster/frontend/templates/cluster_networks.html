{% extends "main.html" %}

{% load i18n extra_tags coffeescript %}

{% block title %}Cluster networks{% endblock %}

{% block content %}

{% verbatim %}

<div ng-app="icsw.network">

<script type="text/ng-template" id="network.html">
    <div class="form-horizontal">
        <form ng-submit="modify()" name="form">
            <div class="form-group ng-class: form_error('identifier')">
                <label for="identifier" class="control-label col-sm-4">Identifier</label>
                <div class="col-sm-8">
                    <input id="identifier" class="form-control" name="identifier" ng-model="edit_obj.identifier" type="text" size="16" placeholder="Identifier" required/>
                </div>
            </div>
            <div class="form-group ng-class: form_error('network')">
                <label for="network" class="control-label col-sm-4">Network</label>
                <div class="col-sm-8">
                    <input id="network" class="form-control" type="text" name="network" ng-pattern="/^\d+\.\d+\.\d+\.\d+$/" ng-model="edit_obj.network" size="30" placeholder="Network" required/>
                </div>
            </div>
            <div class="form-group ng-class: form_error('netmask')">
                <label for="netmask" class="control-label col-sm-4">Netmask</label>
                <div class="col-sm-8">
                    <input id="netmask" class="form-control" type="text" name="netmask" ng-pattern="/^\d+\.\d+\.\d+\.\d+$/" ng-model="edit_obj.netmask" size="30" placeholder="Netmask" required/>
                </div>
            </div>
            <div class="form-group ng-class: form_error('broadcast')">
                <label for="broadcast" class="control-label col-sm-4">Broadcast</label>
                <div class="col-sm-8">
                    <input id="broadcast" class="form-control" type="text" name="broadcast" ng-pattern="/^\d+\.\d+\.\d+\.\d+$/" ng-model="edit_obj.broadcast" size="30" placeholder="Broadcast" required/>
                </div>
            </div>
            <div class="form-group ng-class: form_error('gateway')">
                <label for="gateway" class="control-label col-sm-4">Gateway</label>
                <div class="col-sm-8">
                    <input id="gateway" class="form-control" type="text" name="gateway" ng-pattern="/^\d+\.\d+\.\d+\.\d+$/" ng-model="edit_obj.gateway" size="30" placeholder="Gateway" required/>
                </div>
            </div>
            <div class="form-group">
                <label for="network_type" class="control-label col-sm-4">Network Type</label>
                <div class="col-sm-8">
                    <select id="network_type" class="form-control" ng-model="edit_obj.network_type" ng-options="value.idx as value.description for (key, value) in network_types" />
                </div>
            </div>
            <div class="form-group" ng-show="is_slave_network(edit_obj.network_type)">
                <label for="master_network" class="control-label col-sm-4">Master Network</label>
                <div class="col-sm-8">
                    <select id="master_network" class="form-control" ng-model="edit_obj.master_network" ng-options="value.idx as value.identifier for (key, value) in get_production_networks()">
                        <option value="">No master network</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label for="network_device_type" class="control-label col-sm-4">Network device types</label>
                <div class="col-sm-8">
                    <select id="network_device_type" class="form-control" chosen multiple ng-model="edit_obj.network_device_type" ng-options="value.idx as value.identifier for (key, value) in network_device_types">
                    </select>
                </div>
            </div>
            <div class="form-group">
                <div class="col-sm-offset-4 col-sm-8">
                    <button type="submit" class="btn btn-primary">{{ create_mode && 'Create' || 'Modify' }}</button>
                </div>
            </div>
        </form>
    </div>
</script>

<div ng-controller="network">

<h2>Networks ({{entries.length}} entries), <input type="button" value="create new" ng-click="create($event)"/></h2>

<table class="table table-condensed table-condensed table-hover" style="width:auto;">
    <thead>
        <tr>
            <th>Id</th>   
            <th>Network definition</th>   
            <th>Gateway</th>
            <th>Pri</th>
            <th>Type</th>
            <th>Master</th>
            <th>devtype(s)</th>   
            <th colspan="2" class="text-center">action</th>   
        </tr>
    </thead>
    <tbody>
    <tr ng-repeat="obj in entries | orderBy:'-identifier':true">
        <td>{{ obj.identifier }}</td>
        <td style="font-family:monospace;">
            <span ng-bind-html="ip_fill_up(obj.network)"></span> / <span ng-bind-html="ip_fill_up(obj.netmask)"></span> / <span ng-bind-html="ip_fill_up(obj.broadcast)"></span>
        </td>
        <td>
            <span ng-bind-html="ip_fill_up(obj.gateway)"></span>
        </td>
        <td>{{ obj.penalty }}</td>
        <td>{{ network_types[obj.network_type].description }}</td>
        <td>{{ obj.master_network | array_lookup:this:'entries':'identifier':'---' }}</td>
        <td>{{ obj.network_device_type | resolve_n2m:this:'network_device_types':'identifier' }}</td>
        <td><input type="button" class="btn btn-primary" ng-click="edit($event, obj)" value="modify"/></td>
        <td><input type="button" class="btn btn-danger" ng-click="delete(obj)" value="delete"/></td>
    </tr>
    </tbody>
</table>

</div>

</div>

{% endverbatim %}

{% endblock %}
