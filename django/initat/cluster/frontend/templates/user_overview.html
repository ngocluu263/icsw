{% extends "main.html" %}

{% load i18n compress %}

{% block title %}{% trans "User Overview" %}{% endblock %}


{% block content %}

<h1 class="center">Users and Groups / Tableview</h1>

<div id="ug_tables"></div>

<input type="button" value="Sync Users" onClick="sync_users();"/>

<script type="text/javascript">

// monitoring XML
UG_XML = undefined;

function sync_users() {
    $.ajax({
        url     : "{% url user:sync_users %}",
        error   : handle_ajax_error,
        success : function(xml) {
            if (parse_xml_response(xml)) {
            }
        }
    });
};

var master_array = {
    "group" : new draw_setup("Group", "group", "group",
        "{% url base:create_object 'group' %}",
        "{% url base:delete_object 'group' %}",
        [
            new draw_info("groupname"), 
            new draw_info("active", {boolean : true, default : true}),
            new draw_info("gid", {min : 100, max : 65535, number : 1, default : 100}),
            new draw_info("homestart"),
            new draw_info("first_name", {newline : true, default : "first_name", cspan : 4, show_label : true, label : "First / Last / Title"}),
            new draw_info("last_name", {default : "last_name", keep_td : true}),
            new draw_info("title", {default : "title", keep_td : true}),
            new draw_info("email", {default : "email", newline : true, cspan : 4, show_label : true, label : "Email / Pager"}),
            new draw_info("pager", {default : "pager", keep_td : true})
        ], {
            lock_div : "ug_tables"
        }
    ),
    "user" : new draw_setup("User", "user", "user",
        "{% url base:create_object 'user' %}",
        "{% url base:delete_object 'user' %}",
        [
            new draw_info("login"),
            new draw_info("active", {boolean : true, default : 1}),
            new draw_info("uid", {min : 100, max : 65535, number : true, default : 100}),
            new draw_info("group", {select_source : "groups group"}),
            new draw_info("aliases"),
            new draw_info("password", {password : true}),
            new draw_info("first_name", {newline : true, default : "first_name", cspan : 7, show_label : true, label : "First / Last / Title"}),
            new draw_info("last_name", {default : "last_name", keep_td : true}),
            new draw_info("title", {default : "title", keep_td : true}),
            new draw_info("email", {default : "email", newline : true, cspan : 7, show_label : true, label : "Email / Pager"}),
            new draw_info("pager", {default : "pager", keep_td : true}),
            new draw_info("shell", {default : "/bin/sh", select_source : "shells shell", keep_td : true}),
            new draw_info("export", {select_source : "homedir_exports homedir_export", keep_td : true})
        ], {
            "required_xml" : ["group"],
            "lock_div"     : "ug_tables"
        }
    )
};

function draw_tables() {
    var t_div = $("div#ug_tables");
    t_div.children().remove();
    for (var key in master_array) {
        t_div.append(master_array[key].draw_table());
    };
};

function load_users_groups() {
    $.ajax({
        url     : "{% url user:overview 'table' %}",
        error   : handle_ajax_error,
        success : function(xml) {
            if (parse_xml_response(xml)) {
                UG_XML = $(xml).find("value[name='response']");
                init_xml_change(UG_XML);
                draw_tables();
            }
        }
    });
}

function add_config_handlers() {
    load_users_groups();
};

$(document).ready(add_config_handlers);

</script>

{% endblock %}
